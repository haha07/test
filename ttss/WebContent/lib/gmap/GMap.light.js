GUtil={fn_deactive_rightClick:function(){document.oncontextmenu=function(){return!1}},fn_redirect_page:function(a){document.location.href=a},fn_enc_base64:function(a){return Base64.encode(a)},fn_dec_base64:function(a){return Base64.decode(a)},fn_pop_win:function(a,b,c){if(a){b||(b="_blank");var d={width:"300px",height:"300px",scrollbars:"yes",toolbar:"no",menubars:"no",locationbar:"no",statusbar:"no",resizable:"no",titlebar:"no",left:"0px",top:"0px",message:"\ud31d\uc5c5\ucc28\ub2e8\uc744 \ud574\uc81c\ud574\uc8fc\uc138\uc694."};
$.extend(d,c);if(d.width=this.fn_convert_pixel(d.width))if(d.height=this.fn_convert_pixel(d.height))if(d.left=this.fn_convert_pixel(d.left))if(d.top=this.fn_convert_pixel(d.top))if(c=this.fn_convert_objToStr(d,","),a=window.open(a,b,c))a.focus();else return alert(d.message),!1}else alert("Url(\uc8fc\uc18c)\ub294 \ud544\uc218 \uc785\ub825 \ub300\uc0c1 \uc785\ub2c8\ub2e4.")},addControlButton:function(a,b,c){var d="",d=(d=gMap.getControl(a))?d:a,e="",f="default",g="",e="object"===typeof d?d.id:d;c&&
c.imgURL?(g=g+('<a href="#" id="btn'+e+'">')+('<img src="'+c.imgURL+'" alt="'+e+'" />'),g+="</a>"):g+='<button id="btn'+e+'">'+e+"</button>";c&&c.cursorStyle&&(f=c.cursorStyle);$("#"+b).append(g);switch(a){case "maxExtent":$("#btn"+e).click(function(){gMap.zoomToMaxExtent()});break;case "prev":$("#btn"+e).click(function(){gMap.movePrev()});break;case "next":$("#btn"+e).click(function(){gMap.moveNext()});break;case "redraw":$("#btn"+e).click(function(){for(var a in gMap.layers)gMap.layers[a].redraw()});
break;case "clean":$("#btn"+e).click(function(){gMap.cleanMap()});break;case "upFeature":$("#btn"+e).click(function(){gMap.drawTool.upFeature();$(gMap.div).css("cursor","default")});break;case "downFeature":$("#btn"+e).click(function(){gMap.drawTool.downFeature();$(gMap.div).css("cursor","default")});break;case "topFeature":$("#btn"+e).click(function(){gMap.drawTool.topFeature();$(gMap.div).css("cursor","default")});break;case "bottomFeature":$("#btn"+e).click(function(){gMap.drawTool.bottomFeature();
$(gMap.div).css("cursor","default")});break;case "deleteFeature":$("#btn"+e).click(function(){gMap.drawTool.deleteFeature();$(gMap.div).css("cursor","default")});break;default:$("#btn"+e).click(function(){gMap.activeControls(e);$(gMap.div).css("cursor",f);return!1})}return!1},fn_convert_pixel:function(a){if(this.fn_chk_pixel(a))return a;if(this.fn_chk_num(a))return a+"px";alert("\uc22b\uc790\ud615 \ub610\ub294 pixel \ud615\uc774 \uc544\ub2d9\ub2c8\ub2e4. ex)123  or  123px");return!1},fn_convert_objToStr:function(a,
b){var c="";b||(b="&");for(var d in a)c+=b,c+=d,c+="=",c+=a[d];return c.substr(1)},fn_convert_xmlToJson:function(a){var b={};if(1==a.nodeType){if(0<a.attributes.length){b["@attributes"]={};for(var c=0;c<a.attributes.length;c++){var d=a.attributes.item(c);b["@attributes"][d.nodeName]=d.nodeValue}}}else 3==a.nodeType&&(b=a.nodeValue);if(a.hasChildNodes())for(c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c),e=d.nodeName;if("undefined"==typeof b[e])b[e]=this.fn_convert_xmlToJson(d);else{if("undefined"==
typeof b[e].push){var f=b[e];b[e]=[];b[e].push(f)}b[e].push(this.fn_convert_xmlToJson(d))}}return b},fn_set_lpad:function(a,b,c){for(var d="",e=a.length;e<b;e++)d=c?d+c:d+"0";return d+a},fn_set_rpad:function(a,b,c){var d;d=""+a;for(a=a.length;a<b;a++)d=c?d+c:d+"0";return d},fn_replaceAll:function(a,b,c){return a.replace(new RegExp(b,"g"),c)},fn_ltrim:function(a){return a.replace(/^\s\s*/,"")},fn_rtrim:function(a){return a.replace(/\s\s*$/,"")},fn_trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,
"")},fn_remove_space:function(a){return a.replace(/\s/g,"")},fn_get_now:function(a){var b=new Date;switch(a){case "y":return b.getYear();case "m":return b.getMonth()+1;case "d":return b.getDate();case "h":return b.getHours();case "M":return b.getMinutes();case "s":return b.getSeconds()}return b},fn_fmt_cur:function(a){this.fn_chk_num(a)&&(a+="");return a.replace(/(\d)(?=(?:\d{3})+(?!\d))/g,"$1,")},fn_fmt_fix:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},fn_convert_color:function(a){if("string"==
typeof a){var b=[];b.push(Math.round(100*parseInt(a.substring(1,3),16)/255));b.push("#"+a.substring(3,a.length))}else{var b="#",c=Math.round(255*a[0]/100).toString(16);2>c.length&&(c="0"+c);b=b+c+a[1].substring(1,a[1].length)}return b},fn_chk_length:function(a,b){return a.length==b},fn_chk_num:function(a){return/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/.test(a)},fn_chk_tel:function(a){return/^\d{2,3}-\d{3,4}-\d{4}$/.test(a)},fn_chk_ema:function(a){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(a)},
fn_chk_pixel:function(a){return/^\d+px/.test(a)},fn_chk_url:function(a){return/(\w+):\/\/([^\/:]+)(:\d*)?([^# ]*)/.test(a)},fn_chk_ip:function(a){return/^(1|2)?\d?\d([.](1|2)?\d?\d){3}$/.test(a)}};
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",c,d,e,f,g,h,k=0;for(a=Base64._utf8_encode(a);k<a.length;)c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=c>>2,c=(c&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),b=b+this._keyStr.charAt(f)+this._keyStr.charAt(c)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return b},decode:function(a){var b="",c,d,e,f,g,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<
a.length;)c=this._keyStr.indexOf(a.charAt(h++)),d=this._keyStr.indexOf(a.charAt(h++)),f=this._keyStr.indexOf(a.charAt(h++)),g=this._keyStr.indexOf(a.charAt(h++)),c=c<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|g,b+=String.fromCharCode(c),64!=f&&(b+=String.fromCharCode(d)),64!=g&&(b+=String.fromCharCode(e));return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>
6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),c+=3);return b}};
GUtil.Array={fn_contain:function(a,b){for(var c in a)if(a[c]==b)return!0;return!1},fn_swap_element:function(a,b,c){var d=a[b];a[b]=a[c];a[c]=d},fn_isArray:function(a){return a instanceof Array?!0:!1}};GUtil.BROWSER_NAME=function(){var a="",a=navigator.userAgent.toLowerCase();return a=-1!=a.indexOf("opera")?"opera":-1!=a.indexOf("msie")||-1!=a.indexOf("rv:11.0")?"msie":-1!=a.indexOf("safari")?"safari":-1!=a.indexOf("mozilla")?-1!=a.indexOf("firefox")?"firefox":"mozilla":"chrome"}();
GUtil.getBrowserName=function(){return GUtil.BROWSER_NAME};var GError={debug:!1,create_obj:function(a,b){this.debug&&alert(a.CLASS_NAME+" \uac1d\uccb4 \uc0dd\uc131 \uc624\ub958 : "+b+"\uc740(\ub294) \ud544\uc218 \ud504\ub85c\ud37c\ud2f0 \uc785\ub2c8\ub2e4.")},call_function:function(a,b,c){}};OpenLayers.Util.getImagesLocation=function(){return""};OpenLayers.DOTS_PER_INCH=96;var GMapUtil={sendProxyGet:function(a,b,c){$.get("/gmap/proxyGet.do",{url:encodeURIComponent(a),params:encodeURIComponent(b)},function(a){c(a)})},sendProxyPost:function(a,b,c){$.post("/gmap/proxyPost.do",{url:encodeURIComponent(a),params:encodeURIComponent(b)},function(a){c(a)})}};GMap=OpenLayers.Class(OpenLayers.Map,{units:"m",numZoomLevels:11,projection:"EPSG:4326",displayProjection:"EPSG:4326",fractionalZoom:!0,allOverlays:!1,initialize:function(a,b){GError.debug&&this.chkParams(a,b);1===arguments.length&&"object"===typeof a&&(a=(b=a)&&b.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,
b);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));
!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(a);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var c=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width=
"100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this));c=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(c);
this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var c=!0,d=document.getElementsByTagName("link"),
e=0,f=d.length;e<f;++e)if(OpenLayers.Util.isEquivalentUrl(d.item(e).href,this.theme)){c=!1;break}c&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(c))}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(GDrag&&this.controls.push(new GDrag({id:"drag"})),GZoomIn&&this.controls.push(new GZoomIn({id:"zoomIn"})),GZoomOut&&this.controls.push(new GZoomOut({id:"zoomOut"})),
GNavigationHistory&&this.controls.push(new GNavigationHistory({id:"naivgationHistory"})),GMeasure&&(GPathMeasure&&this.controls.push(new GMeasure(GPathMeasure,{id:"measurePath"})),GPathMeasure&&this.controls.push(new GMeasure(GPolygonMeasure,{id:"measurePolygon"}))),GPanZoomBar&&(c={id:"panZoomBar"},apiServerHost&&(c.apiServerHost=apiServerHost),this.controls.push(new GPanZoomBar(c)))));e=0;for(f=this.controls.length;e<f;e++)this.addControlToMap(this.controls[e]);this.popups=[];this.unloadDestroy=
OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom));this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},chkParams:function(a,b){OpenLayers.Util.getElement(a)||GError.create_obj(this,"id (\uc9c0\ub3c4\ub97c \ud45c\uc2dc\ud560 DIV ID)");
b&&"object"===typeof b?(b.maxExtent||GError.create_obj(this,"options maxExtent (\ucd5c\ub300 \uc601\uc5ed)"),b.maxResolution||GError.create_obj(this,"options maxResolution (\ucd5c\ub300 \ud574\uc0c1\ub3c4)")):GError.create_obj(this,"options")},getLayerByName:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.name==a){b=e;break}}return b},removeLayerByName:function(a){for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];if(d.name==a){this.removeLayer(d);
break}}},activeControls:function(a){for(var b in this.controls)this.controls[b].type!=OpenLayers.Control.TYPE_TOGGLE&&this.controls[b].deactivate();if("object"===typeof a){if(a.length&&0<a.length)for(b=0;b<a.length;b++)this.getControl(a[b]).activate()}else this.getControl(a).activate()},removeAllPopups:function(){for(var a=this.popups.length-1;0<=a;a--)this.removePopup(this.popups[a])},getResolutions:function(){return this.resolutions},movePrev:function(){this.getControl("naivgationHistory").previousTrigger()},
moveNext:function(){this.getControl("naivgationHistory").nextTrigger()},isPrevStack:function(){return 1<this.getControl("naivgationHistory").previousStack.length?!0:!1},isNextStack:function(){return 0<this.getControl("naivgationHistory").nextStack.length?!0:!1},cleanMap:function(){var a=[],b;for(b in this.controls)this.controls[b].active&&a.push(this.controls[b]),this.controls[b].deactivate();for(b=0;b<a.length;b++)a[b].activate();for(b in this.layers)"GVector"!=this.layers[b].CLASS_NAME&&"OpenLayers.Layer.Vector"!=
this.layers[b].CLASS_NAME||this.layers[b].removeFeatures(this.layers[b].features);this.removeAllPopups()},getPopup:function(a){for(var b in this.popups)if(this.popups[b].id==a)return this.popups[b];return!1},setCenterScale:function(a,b){b?(this.center=a,this.zoomToScale(b)):this.setCetner(a)},zoomToFeature:function(a,b){b?this.setCenter(new GLonLat(a.geometry.getCentroid().x,a.geometry.getCentroid().y),b):"OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME?this.setCenter(new GLonLat(a.geometry.getCentroid().x,
a.geometry.getCentroid().y),this.getNumZoomLevels()-1):this.zoomToExtent(a.geometry.getBounds())},setDrawSymbolImg:function(a){gMap.getControl("drawSymbol").handler.attributes.externalGraphic=a},getDrawToolLayer:function(){return gMap.getLayerByName("GDrawToolLayer")},CLASS_NAME:"GMap"});var GRequest={WMS:{service:"WMS",version:"1.3.0",request:null,getCapability:function(a,b){var c=this;GMapUtil.sendProxyGet(a,GUtil.fn_convert_objToStr({service:this.service,version:this.version,request:"GetCapabilities"}),function(a){c.parseGetCapability(a,b)})},parseGetCapability:function(a,b){for(var c=[],d=a.getElementsByTagName("Layer"),e=0,f=d.length;e<f;e++){var g=d[e].getElementsByTagName("Layer");if(0<g.length&&"BASIC"!=$(d[e].getElementsByTagName("Title")[0]).text()){for(var h={title:$(d[e].getElementsByTagName("Title")[0]).text(),
layers:[]},k=0,l=g.length;k<l;k++){var m={name:$(g[k].getElementsByTagName("Name")[0]).text(),style:$(g[k].getElementsByTagName("Style")[0]).text(),title:$(g[k].getElementsByTagName("Title")[0]).text(),left:$(g[k].getElementsByTagName("westBoundLongitude")[0]).text(),bottom:$(g[k].getElementsByTagName("southBoundLatitude")[0]).text(),right:$(g[k].getElementsByTagName("eastBoundLongitude")[0]).text(),top:$(g[k].getElementsByTagName("northBoundLatitude")[0]).text()};h.layers.push(m)}c.push(h)}}b(c)},
getLegendGraphic:function(a,b){var c={service:this.service,version:this.version,request:"GetLegendGraphic",layer:"",style:"",rule:"",sld_version:"1.1.0",format:"image/png",width:16,height:16};$.extend(c,b);return a+GUtil.fn_convert_objToStr(c)},getStyles:function(a,b,c){GMapUtil.sendProxyPost(a,GUtil.fn_convert_objToStr({service:this.service,version:this.version,request:"GetStyles",layers:b}),function(a){c(new GSLDTool(a,"xml"))})},parseGetStyles:function(a,b){var c={xml:a,name:"",namedLayers:[]},
d=a.getElementsByTagName("se:Name");0<d.length&&(c.name=$(a.getElementsByTagName("se:Name")[0]).text());for(var e=a.getElementsByTagName("sld:NamedLayer"),f=0,g=e.length;f<g;f++){var h={name:"",title:"",featureTypeName:"",userStyle:[]},d=e[f].getElementsByTagName("se:Name");0<d.length&&(h.name=$(d[0]).text());d=e[f].getElementsByTagName("se:Description");0<d.length&&(d=d[0].getElementsByTagName("se:Title"),0<d.length&&(h.title=$(d[0]).text()));d=e[f].getElementsByTagName("sld:LayerFeatureConstraints");
0<d.length&&(d=d[0].getElementsByTagName("se:FeatureTypeName"),0<d.length&&(h.featureTypeName=$(d[0]).text()));for(var k=e[f].getElementsByTagName("sld:UserStyle"),l=0,m=k.length;l<m;l++){var n={name:"",title:"",rules:[]},d=k[l].getElementsByTagName("se:Name");0<d.length&&(n.name=$(d[0]).text());d=k[l].getElementsByTagName("se:Description");0<d.length&&(d=d[0].getElementsByTagName("se:Title"),0<d.length&&(n.title=$(d[0]).text()));d=k[l].getElementsByTagName("se:FeatureTypeStyle");0<d.length&&(d=d[0].getElementsByTagName("se:FeatureTypeName"),
0<d.length&&(n.title=$(d[0]).text()));for(var q=k[l].getElementsByTagName("se:Rule"),r=0,y=q.length;r<y;r++){var v={name:"",minScale:"",maxScale:"",symbolizer:{}},d=q[r].getElementsByTagName("se:Name");0<d.length&&(v.name=$(d[0]).text());d=q[r].getElementsByTagName("se:MinScaleDenominator");0<d.length&&(v.minScale=$(d[0]).text());d=q[r].getElementsByTagName("se:MaxScaleDenominator");0<d.length&&(v.maxScale=$(d[0]).text());var t=q[r].getElementsByTagName("se:PointSymbolizer"),p=q[r].getElementsByTagName("se:LineSymbolizer"),
u=q[r].getElementsByTagName("se:PolygonSymbolizer"),w=q[r].getElementsByTagName("se:TextSymbolizer");if(0<t.length){var s={},d=t[0].getElementsByTagName("se:Size");0<d.length&&(s.size=$(d[0]).text());d=t[0].getElementsByTagName("se:ExternalGraphic");0<d.length&&(d=d[0].getElementsByTagName("se:InlineContent"),0<d.length&&(s.externalGraphic=$(d[0]).text()));v.symbolizer.point=s}if(0<p.length){t={};d=p[0].getElementsByTagName("se:SvgParameter");p=0;for(s=d.length;p<s;p++)if("stroke"==d[p].getAttribute("name"))t.stroke=
$(d[p]).text();else if("stroke-width"==d[p].getAttribute("name"))t.strokeWidth=$(d[p]).text();else if("stroke-opacity"==d[p].getAttribute("name"))t.strokeOpacity=$(d[p]).text();else if("stroke-linecap"==d[p].getAttribute("name"))t.strokeLinecap=$(d[p]).text();else if("stroke-dasharray"==d[p].getAttribute("name")){var x=0,x=$(d[p]).text().split(","),x=2==parseInt(x[0])?"dot":7==parseInt(x[0])?"dash":10==parseInt(x[0])?"dashdot":"solid";t.strokeDashArray=x}t.strokeDashArray||(t.strokeDashArray="solid");
v.symbolizer.line=t}if(0<u.length){t={};d=u[0].getElementsByTagName("se:SvgParameter");p=0;for(s=d.length;p<s;p++)"fill"==d[p].getAttribute("name")?t.fillColor=$(d[p]).text():"fill-opacity"==d[p].getAttribute("name")&&(t.fillOpacity=$(d[p]).text());v.symbolizer.polygon=t}if(0<w.length){u={};d=w[0].getElementsByTagName("se:Label");0<d.length&&(d=d[0].getElementsByTagName("PropertyName"),0<d.length&&(u.label=$(d[0]).text()));d=w[0].getElementsByTagName("se:Font");if(0<d.length)for(d=d[0].getElementsByTagName("se:SvgParameter"),
p=0,s=d.length;p<s;p++)"font-family"==d[p].getAttribute("name")?u.fontFamily=$(d[p]).text():"font-size"==d[p].getAttribute("name")?u.fontSize=$(d[p]).text():"font-style"==d[p].getAttribute("name")?u.fontStyle=$(d[p]).text():"font-weight"==d[p].getAttribute("name")&&(u.fontWeight=$(d[p]).text());w=w[0].getElementsByTagName("se:Fill");for(p=0;p<w.length;p++)if(d=w[p].getElementsByTagName("se:SvgParameter"),"se:Halo"==w[p].previousSibling.nodeName)for(s=0,t=d.length;s<t;s++)"fill"==d[p].getAttribute("name")?
u.haloColor=$(d[s]).text():"fill-opacity"==d[p].getAttribute("name")&&(u.haloOpacity=$(d[s]).text());else for(s=0,t=d.length;s<t;s++)"fill"==d[s].getAttribute("name")?u.fillColor=$(d[s]).text():"fill-opacity"==d[s].getAttribute("name")&&(u.fillOpacity=$(d[s]).text());v.symbolizer.text=u}n.rules.push(v)}h.userStyle.push(n)}c.namedLayers.push(h)}return b?(b(c),!0):c},getFeatureInfo:function(a,b,c,d,e){b={service:this.service,version:this.version,request:"GetFeatureInfo",layers:"",styles:"",query_layers:"",
crs:"EPSG:4326",info_format:"text/xml",format:"image/jpeg",feature_count:9999,bbox:b.getExtent().toBBOX(),i:parseInt(b.getSize().w/2),j:parseInt(b.getSize().h/2),height:b.getSize().h,width:b.getSize().w};c.layers&&!c.styles&&(c.styles=c.layers);c.layers&&!c.query_layers&&(c.query_layers=c.layers);$.extend(b,c);var f=this;GMapUtil.sendProxyGet(a,GUtil.fn_convert_objToStr(b),function(a){f.parseGetFeatureInfo(a,d,e)})},parseGetFeatureInfo:function(a,b,c){var d=[];a=a.getElementsByTagName("Layer");for(var e=
0,f=a.length;e<f;e++){var g={};g.name=a[e].getAttribute("name");g.fields={};fields=a[e].getElementsByTagName("Field");for(var h=0,k=fields.length;h<k;h++)g.fields[fields[h].getAttribute("name")]=$(fields[h]).text();d.push(g)}b(d,c)}}};
GRequest.WFS={SERVICES:"WFS",VERSION:"1.1.0",REQUEST:null,format:{gml:new OpenLayers.Format.GML,filter:new OpenLayers.Format.Filter({version:"1.1.0",stringifyOutput:!0}),xml:new OpenLayers.Format.XML},getCapability:function(a,b){var c=GUtil.fn_convert_objToStr({SERVICE:this.SERVICES,VERSION:this.VERSION,REQUEST:"GetCapabilities"});GMapUtil.sendProxyGet(a,c,function(a){var c=new OpenLayers.Format.WFSCapabilities({version:"1.1.0"});b(c.read(a.xml))})},extendParams:function(a,b){OpenLayers.Util.extend(a,
b);!b.tables||b.tables instanceof Array||(a.tables=[b.tables]);!b.fields||b.values instanceof Array||(a.fields=[b.fields]);!b.values||b.values instanceof Array||(a.values=[b.values]);!b.sortFields||b.sortFields instanceof Array||(a.sortFields=[b.sortFields]);!b.sortOrders||b.sortOrders instanceof Array||(a.sortOrders=[b.sortOrders])},getSortBy:function(a,b){var c;c="<ogc:SortBy>";for(var d=0,e=a.length;d<e;d++)c+="<ogc:SortProperty>",c+="<ogc:PropertyName>",c+=a[d],c+="</ogc:PropertyName>",c+="<ogc:SortOrder>",
c+=b[d]?b[d]:"ASC",c+="</ogc:SortOrder>",c+="</ogc:SortProperty>";return c+"</ogc:SortBy>"},getFeatureById:function(a,b,c,d){var e={maxFeatures:9999,prefix:"",tables:[],values:[],sortFields:[],sortOrders:[],useDomain:!1};this.extendParams(e,b);b="";for(var f=0,g=e.tables.length;f<g;f++)b+='<wfs:Query typeName="'+e.prefix+":"+e.tables[f]+'" '+(e.useDomain?'useDomain="true"':"")+"  >",f<e.values.length&&(b+='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:FeatureId fid="'+e.tables[f]+"."+e.values[f]+
'"/></ogc:Filter>'),0<e.sortFields.length&&(b+=this.getSortBy(e.sortFields,e.sortOrders)),b+="</wfs:Query>";this.getFeature(a,e,b,c,d)},getFeatureByComparison:function(a,b,c,d){var e={maxFeatures:9999,prefix:"",type:"==",tables:[],fields:[],values:[],sortFields:[],sortOrders:[],useDomain:!1};this.extendParams(e,b);b="";for(var f=0,g=e.tables.length;f<g;f++){b+='<wfs:Query typeName="'+e.prefix+":"+e.tables[f]+'" '+(e.useDomain?'useDomain="true"':"")+"  >";var h=new OpenLayers.Filter.Comparison({type:e.type,
property:e.fields[f],value:e.values[f]});b+=this.format.filter.write(h);0<e.sortFields.length&&(b+=this.getSortBy(e.sortFields,e.sortOrders));b+="</wfs:Query>"}this.getFeature(a,e,b,c,d)},getFeatureByDWithin:function(a,b,c,d){var e={maxFeatures:9999,prefix:"",type:OpenLayers.Filter.Spatial.DWITHIN,tables:[],distance:100,values:[],sortFields:[],sortOrders:[],useDomain:!1};this.extendParams(e,b);b="";for(var f=0,g=e.tables.length;f<g;f++){b+='<wfs:Query typeName="'+e.prefix+":"+e.tables[f]+'" '+(e.useDomain?
'useDomain="true"':"")+"  >";var h=new OpenLayers.Filter.Spatial({type:e.type,property:"G2_SPATIAL",value:e.values[0],distance:e.distance,distanceUnits:"m"});b+=this.format.filter.write(h);0<e.sortFields.length&&(b+=this.getSortBy(e.sortFields,e.sortOrders));b+="</wfs:Query>"}this.getFeature(a,e,b,c,d)},getFeatureByGeometry:function(a,b,c,d){var e={maxFeatures:9999,prefix:"",type:OpenLayers.Filter.Spatial.INTERSECTS,tables:[],values:[],sortFields:[],sortOrders:[],useDomain:!1};this.extendParams(e,
b);b="";for(var f=0,g=e.tables.length;f<g;f++){b+='<wfs:Query typeName="'+e.prefix+":"+e.tables[f]+'" '+(e.useDomain?'useDomain="true"':"")+"  >";var h=new OpenLayers.Filter.Spatial({type:e.type,property:"G2_SPATIAL",value:e.values[0]});b+=this.format.filter.write(h);0<e.sortFields.length&&(b+=this.getSortBy(e.sortFields,e.sortOrders));b+="</wfs:Query>"}this.getFeature(a,e,b,c,d)},getFeature:function(a,b,c,d,e){if(e.getRequestFilter)a=b.values[0].id.split("_")[2],c=c.substring(c.lastIndexOf("<gml:"+
a),c.lastIndexOf("</gml:"+a+">")+7+a.length),d({request:c,success:function(){return!0}});else{b=""+('<wfs:GetFeature service="WFS" version="1.1.0" maxFeatures="'+b.maxFeatures+'" xmlns:ehmp="http://health-e-waterways.org" xmlns:wfs="http://www.opengis.net/wfs" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd">');b=b+c+"</wfs:GetFeature>";
var f=this;GMapUtil.sendProxyPost(a,b,function(a){f.parseGetFeature(a,d,e)})}},parseGetFeature:function(a,b,c){a.responseXML&&(a=a.responseXML);var d=[],e=!0,f=GUtil.getBrowserName();if((a="msie"==f||"firefox"==f?a.getElementsByTagName("wfs:FeatureCollection"):a.getElementsByTagName("FeatureCollection"))&&a[0]){if(0!=a[0].getAttribute("numberOfFeatures")){f="msie"==f||"firefox"==f?a[0].getElementsByTagName("gml:featureMember"):a[0].getElementsByTagName("featureMember");a=0;for(var g=f.length;a<g;a++){var h=
f[a].firstChild.getAttribute("fid").split("."),k=h[0],l=null,m;for(m in d)if(d[m].table==k){l=m;break}l?k=d[l]:(k={table:k,results:[]},d.push(k));h={g2id:h[1],feature:null,title:h[1],fields:{}};for(l=f[a].firstChild.firstChild;l;)"g2_spatial"==l.tagName.replace(l.prefix+":","").toLowerCase()?h.feature=this.format.gml.parseFeature(l):(c&&c.titles&&c.titles[k.table]&&l.tagName.replace(l.prefix+":","").toLowerCase()==c.titles[k.table].toLowerCase()&&(h.title=$(l).text()),"boundedby"!=l.tagName.replace(l.prefix+
":","").toLowerCase()&&($(l).text(),h.fields[l.tagName.replace(l.prefix+":","").toLowerCase()]=$(l).text())),l=l.nextSibling;k.results.push(h)}}}else e=!1;c&&c.alias?this.getRequestAlias(d,e,b,c):b({data:d,success:function(){return e}})},insert:function(a,b,c,d,e,f,g){!b||b instanceof Array||(b=[b]);var h;h='<wfs:Transaction xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ogc="http://www.opengis.net/ogc" xmlns:sf="http://cite.opengeospatial.org/gmlsf"><wfs:Insert srsName="EPSG:4326">';
h+="<"+c+":"+d+" xmlns:"+c+'="http://geogate.g-inno.com/dataserver/'+c+'">';h+="<"+c+":G2_SPATIAL>";h+=this.createGmlXml(b);h+="</"+c+":G2_SPATIAL>";e&&0<e.length&&(h+=this.createAttrXml(c,e,f));h+="</"+c+":"+d+">";h+="</wfs:Insert>";h+="</wfs:Transaction>";$("#txtTest").val(h);GMapUtil.sendProxyPost(a,h,function(a){var b=a.getElementsByTagName("wfs:TransactionResponse");if(0<b.length){a=[];for(var c=b[0].getElementsByTagName("wfs:totalInserted"),b=b[0].getElementsByTagName("ogc:FeatureId"),d=0,e=
b.length;d<e;d++)a.push(b[d].getAttribute("fid"));g&&g({count:$(c[0]).text(),ids:a})}})},update:function(a,b,c,d,e,f,g,h){!b||b instanceof Array||(b=[b]);c='<wfs:Transaction xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ogc="http://www.opengis.net/ogc" xmlns:sf="http://cite.opengeospatial.org/gmlsf">'+('<wfs:Update typeName="'+c+":"+d+'" xmlns:'+c+'="http://geogate.g-inno.com/dataserver/'+
c+'">');c+="<wfs:Property>";c+="<wfs:Name>G2_SPATIAL</wfs:Name>";c+="<wfs:Value>";c+=this.createGmlXml(b);c+="</wfs:Value>";c+="</wfs:Property>";e&&0<e.length&&(c+=this.updateAttrXml(e,f));c+="<ogc:Filter>";c+='<ogc:PropertyIsEqualTo matchCase="true">';c+="<ogc:PropertyName>"+d+".G2_ID</ogc:PropertyName> ";c+="<ogc:Literal>"+g+"</ogc:Literal> ";c+="</ogc:PropertyIsEqualTo>";c+="</ogc:Filter>";c+="</wfs:Update>";c+="</wfs:Transaction>";GMapUtil.sendProxyPost(a,c,function(a){a=a.getElementsByTagName("wfs:TransactionResponse");
0<a.length&&(a=a[0].getElementsByTagName("wfs:totalUpdated"),h&&h({count:$(a[0]).text()}))})},del:function(a,b,c,d){a='<wfs:Transaction xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ogc="http://www.opengis.net/ogc" xmlns:sf="http://cite.opengeospatial.org/gmlsf" releaseAction="ALL">'+('<wfs:Delete typeName="'+a+":"+b+'">');a+='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:FeatureId fid="'+
b+"."+c+'"/></ogc:Filter>';a+="</wfs:Delete>";a+="</wfs:Transaction>";GMapUtil.sendProxyPost(serviceUrl,a,function(a){a=a.getElementsByTagName("wfs:TransactionResponse");0<a.length&&(a=a[0].getElementsByTagName("wfs:totalDeleted"),d&&d({count:$(a[0]).text()}))})},createGmlXml:function(a){var b=0,c;for(c in a)"OpenLayers.Geometry.LineString"==a[c].geometry.CLASS_NAME&&b++;var d="";"OpenLayers.Geometry.Point"==a[0].geometry.CLASS_NAME&&(d+=this.createPointXml(a[0].geometry));if(1==b)d=d+'<gml:LineString xmlns:gml="http://www.opengis.net/gml">'+
this.createLineStringXml(a[0].geometry),d+="</gml:LineString>";else if(1<b){d+='<gml:MultiLineString xmlns:gml="http://www.opengis.net/gml" srsName="EPSG:4326">';for(c in a)"OpenLayers.Geometry.LineString"==a[c].geometry.CLASS_NAME&&(d+="<gml:lineStringMember><gml:LineString>",d+=this.createLineStringXml(a[c].geometry),d+="</gml:LineString></gml:lineStringMember>");d+="</gml:MultiLineString>"}return d},createPointXml:function(a){var b;b='<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>'+
(a.x+" ");b+=a.y;return b+="</gml:pos></gml:Point>"},createLineStringXml:function(a){var b;b="<gml:posList>";for(var c in a.components)b+=a.components[c].x+" ",b+=a.components[c].y+" ";return b+"</gml:posList>"},createAttrXml:function(a,b,c){for(var d="",e=0,f=b.length;e<f;e++)d+="<"+a+":"+b[e]+">"+c[e]+"</"+a+":"+b[e]+">";return d},updateAttrXml:function(a,b){for(var c="",d=0,e=a.length;d<e;d++)c+="<wfs:Property>",c+="<wfs:Name>"+a[d]+"</wfs:Name>",c+="<wfs:Value>"+b[d]+"</wfs:Value>",c+="</wfs:Property>";
return c},getRequestAlias:function(a,b,c,d){d=[];for(var e=[],f=0,g=a.length;f<g;f++)for(var h in a[f].results[0].fields)d.push(a[f].table),e.push(h);$.post("/gmap/attr/getAlias.do",{tables:d.join(),fields:e.join()},function(d){for(var e=0,f=a.length;e<f;e++)a[e].alias=d.data[e];c({data:a,success:function(){return b}})},"json")},orderGetFeatureArr:function(a,b,c){for(var d=a.length-1;0<d;d--)for(var e=0;e<d;e++)"desc"==c.toLowerCase()?a[e].fields[b]<a[e+1].fields[b]&&GUtil.Array.fn_swap_element(a,
e,e+1):a[e].fields[b]>a[e+1].fields[b]&&GUtil.Array.fn_swap_element(a,e,e+1)}};
GRequest.WPS={SERVICES:"WPS",VERSION:"1.0.0",format:{gml:new OpenLayers.Format.GML,filter:new OpenLayers.Format.Filter({version:"1.0.0"})},getNearFeature:function(a,b,c){var d={Service:this.SERVICES,Version:this.VERSION,Request:"Execute",Identifier:"NearFeature",DataInputs:"",Responsedocument:"NEARFEATURE_OUTPUT",DataInputs:"["};d.DataInputs+=GUtil.fn_convert_objToStr(b,";");d.DataInputs+="]";var e=this;GMapUtil.sendProxyPost(a,GUtil.fn_convert_objToStr(d),function(a){e.parseGetFeature(a,c)})},parseGetFeature:function(a,
b){var c=[],d=!0,e=a.getElementsByTagName("wfs:FeatureCollection");if(e&&e[0])for(var e=e[0].getElementsByTagName("gml:featureMember"),f=0,g=e.length;f<g;f++)for(f=0,g=e.length;f<g;f++){var h=e[f].firstChild.tagName,k=null,l;for(l in c)if(c[l].table==h){k=l;break}k?h=c[k]:(h={table:h,results:[]},c.push(h));for(var k={feature:null,fields:{}},m=e[f].firstChild.firstChild;m;)"geometry"==m.tagName.toLowerCase()?k.feature=this.format.gml.parseFeature(m):k.fields[m.tagName.toLowerCase()]=$(m).text(),m=
m.nextSibling;h.results.push(k)}else d=!1;b({data:c,success:function(){return d}})},getHoldWaterInfo:function(a,b,c){var d={Service:this.SERVICES,Version:this.VERSION,Request:"Execute",Identifier:"HoldWater",DataInputs:"",Responsedocument:"HOLDWATER_OUTPUT",DataInputs:"["};d.DataInputs+=GUtil.fn_convert_objToStr(b,";");d.DataInputs+="]";var e=this;GMapUtil.sendProxyPost(a,GUtil.fn_convert_objToStr(d),function(a){e.parseHoldWaterInfo(a,c)})},parseHoldWaterInfo:function(a,b){var c=[],d=!0,e=a.getElementsByTagName("prof:HoldWater"),
f={results:[]};c.push(f);var g={pipes:[],valves:[],fires:[]};if(e&&e[0]){for(e=e[0].firstChild;e;)"pipes"==e.tagName.toLowerCase().split(":")[1]?g.pipes.push($(e).text()):"valves"==e.tagName.toLowerCase().split(":")[1]?g.valves.push($(e).text()):"fires"==e.tagName.toLowerCase().split(":")[1]&&g.fires.push($(e).text()),e=e.nextSibling;f.results.push(g)}else d=!1;b({data:c,success:function(){return d}})}};GMarker=OpenLayers.Class(OpenLayers.Marker,{addToGMap:function(){gMap.getLayersByName("markersLayer")[0].addMarker(this)},CLASS_NAME:"GMarker"});GIcon=OpenLayers.Class(OpenLayers.Icon,{CLASS_NAME:"GIcon"});GIndexMap=OpenLayers.Class({map:null,div:null,gindexMap:null,maxResolution:null,initialize:function(a,b){this.div=document.createElement("div");$(this.div).addClass("olIndexMap");$(".olMapViewport").append(this.div);var c;this.maxResolution=b&&b.maxResolution?b.maxResolution:Math.min(a.getMaxExtent().getWidth(),a.getMaxExtent().getHeight())/Math.min($(this.div).css("width").replace("px",""),$(this.div).css("height").replace("px",""));this.gindexMap=new GMap(this.div,{maxExtent:a.maxExtent,maxResolution:this.maxResolution,
projection:b.projection,controls:[]});c=new GWMSPost("GIndexLayer",b.serviceUrl,{layers:b.layers,styles:b.styles,crs:b.projection},{isBaseLayer:!0,singleTile:!0,ratio:1,projection:"SR-ORG:6640"});this.gindexMap.addLayer(c);this.gindexMap.setBaseLayer(c);this.gindexMap.addControl(new GZoomBoxIndex(a,{id:"indexMap"}));this.gindexMap.activeControls("indexMap");b&&b.offsetPixel&&"GPixel"==b.offsetPixel.CLASS_NAME&&(c=this.gindexMap.getLonLatFromPixel(this.gindexMap.getPixelFromLonLat(this.gindexMap.getMaxExtent().getCenterLonLat()).add(b.offsetPixel.x,
b.offsetPixel.y)),this.gindexMap.setCenterScale(c));a.events.register("moveend",this,function(){this.gindexMap.getControl("indexMap").handler.applyBox(a.getExtent())});this.gindexMap.zoomToMaxExtent();$(this.div).hide()},show:function(){$(".olIndexMap").show()},hide:function(){$(".olIndexMap").hide()},toggle:function(){"none"==$(".olIndexMap").css("display")?this.show():this.hide()},isShow:function(){return"none"==$(".olIndexMap").css("display")?!1:!0},getHeight:function(){return parseInt($(".olIndexMap").css("height").replace("px",
""))},getWidth:function(){return parseInt($(".olIndexMap").css("width").replace("px",""))},getPosition:function(){return{left:parseInt($(".olIndexMap").css("left").replace("px","")),bottom:parseInt($(".olIndexMap").css("bottom").replace("px","")),right:parseInt($(".olIndexMap").css("right").replace("px","")),top:parseInt($(".olIndexMap").css("top").replace("px",""))}},setPosition:function(a,b,c,d){a&&$(".olIndexMap").css("left",a);c&&$(".olIndexMap").css("right",c);b&&$(".olIndexMap").css("bottom",
b);d&&$(".olIndexMap").css("top",d)},setHeight:function(a){$(".olIndexMap").css("height",a)},setWidht:function(a){$(".olIndexMap").css("widht",a)},changeLayer:function(a,b){this.gindexMap.baseLayer.mergeNewParams({layers:a,styles:b})},setPositionIndexMap:function(a){"LEFTTOP"==a.toUpperCase()?($(".olIndexMap").css("top","0%"),$(".olIndexMap").css("left","0%"),$(".olIndexMap").css("bottom",""),$(".olIndexMap").css("right","")):"LEFTBOTTOM"==a.toUpperCase()?($(".olIndexMap").css("top",""),$(".olIndexMap").css("left",
"0%"),$(".olIndexMap").css("bottom","0%"),$(".olIndexMap").css("right","")):"RIGHTTOP"==a.toUpperCase()?($(".olIndexMap").css("top","0%"),$(".olIndexMap").css("left",""),$(".olIndexMap").css("bottom",""),$(".olIndexMap").css("right","0%")):"RIGHTBOTTOM"==a.toUpperCase()&&($(".olIndexMap").css("top",""),$(".olIndexMap").css("left",""),$(".olIndexMap").css("bottom","0%"),$(".olIndexMap").css("right","0%"))},CLASS_NAME:"GIndexMap"});GBounds=OpenLayers.Class(OpenLayers.Bounds,{CLASS_NAME:"GBounds"});GBounds.fromString=function(a,b){b||(b=",");var c=a.split(b);return GBounds.fromArray(c)};GBounds.fromArray=function(a){return new GBounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};GSize=OpenLayers.Class(OpenLayers.Size,{CLASS_NAME:"GSize"});GLonLat=OpenLayers.Class(OpenLayers.LonLat,{CLASS_NAME:"GLonLat"});GPixel=OpenLayers.Class(OpenLayers.Pixel,{CLASS_NAME:"GPixel"});GAcss=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["callback"],serviceUrl:null,persist:!0,layers:[],styles:[],alias:[],types:[],width:400,height:300,format:"image/png",crs:"EPSG:4326",version:"1.0.0",bgcolor:"0xffffff",resultType:"XML",callbacks:null,imgPath:null,feature:null,handlerOptions:{multiLine:!0,persistControl:!0,layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"circle",fillColor:"#ffffff",
fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:2,strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000",fillColor:"#ee9900",fillOpacity:0}}})]})})}},res:{dist:0,width:0,height:0,maxDep:0,searchPoint:{start:{x:0,y:0},end:{x:0,y:0},dist:{x:0,y:0,signX:0,signY:0}},facilities:[],roads:[],offset:{left:10,bottom:20,right:10,top:40},baseLine:{top:0,left:0,bottom:0,right:0,width:0,height:0},eventDist:{move:!1,startDist:0,startDep:0,
endDist:0,endDep:0,startPos:{x:0,y:0},drawOffset:{x:0,y:0}},clear:function(){this.maxDep=this.height=this.width=this.dist=0;this.searchPoint={start:{x:0,y:0},end:{x:0,y:0},dist:{x:0,y:0,signX:0,signY:0}};this.facilities=[];this.roads=[];this.distList=[];this.baseLine={top:0,left:0,bottom:0,right:0,width:0,height:0}},setInitParam:function(a,b,c){this.setSize(a,b);this.setBaseLine();this.dist=parseFloat(c)},setSize:function(a,b){this.width=a;this.height=b},setBaseLine:function(){this.baseLine.left=
parseFloat(this.offset.left);this.baseLine.bottom=parseFloat(this.height-this.offset.bottom);this.baseLine.right=parseFloat(this.width-this.offset.right);this.baseLine.top=parseFloat(this.offset.top);this.baseLine.width=parseFloat(this.width-(this.offset.left+this.offset.right));this.baseLine.height=parseFloat(this.height-(this.offset.bottom+this.offset.top))},setResInit:function(){this.setMaxDep()},setMaxDep:function(){for(var a=0,b=this.facilities.length;a<b;a++)this.facilities[a].dep>this.maxDep&&
(this.maxDep=parseFloat(this.facilities[a].dep))},draw:function(a,b){var c;c=""+this.drawBase();c+=this.drawRoads();c+=this.drawFacilities();c+=this.drawDistList();c+=this.drawEvent();$(a).html(c);$("#eventDistLine",a).hide()},drawBase:function(){var a;a=""+('<v:line id="leftLine" from="'+this.baseLine.left+","+this.baseLine.top+'" to="'+this.baseLine.left+","+(this.baseLine.bottom+5)+'" strokecolor="black" strokeweight="1pt" />');a+='<v:line id="startText" from="'+(this.baseLine.left-5)+","+this.baseLine.top/
2+'" to="'+(this.baseLine.left+5)+","+(this.baseLine.top/2+.1)+'">';a+='<v:fill on="true" color="black" /><v:path textpathok="true" />';a+='<v:textpath on="true" fitpath="false" string="A" style="font-size:12pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';a+="</v:line>";a+='<v:line id="bottomLine" from="'+this.baseLine.left+","+this.baseLine.bottom+'" to="'+this.baseLine.right+","+this.baseLine.bottom+'" strokecolor="black" strokeweight="1pt" />';a+='<v:line id="bottomLine" from="'+this.baseLine.left+
","+this.baseLine.top+'" to="'+this.baseLine.right+","+this.baseLine.top+'" strokecolor="black" strokeweight="1pt">';a+='<v:stroke dashstyle="dash" />';a+="</v:line>";a+='<v:line id="rightLine" from="'+this.baseLine.right+","+this.baseLine.top+'" to="'+this.baseLine.right+","+(this.baseLine.bottom+5)+'" strokecolor="black" strokeweight="1pt" />';a+='<v:line id="endText" from="'+(this.baseLine.right-5)+","+this.baseLine.top/2+'" to="'+(this.baseLine.right+5)+","+(this.baseLine.top/2+.1)+'">';a+='<v:fill on="true" color="black" />';
a+='<v:path textpathok="true" />';a+='<v:textpath on="true" fitpath="false" string="B" style="font-size:12pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';return a+="</v:line>"},drawFacilities:function(){for(var a="",b=0,c=this.facilities.length;b<c;b++)a+=this.drawFacility(this.facilities[b],b);return a},drawFacility:function(a,b){var c="",d=GUtil.fn_fmt_fix(a.dist*this.baseLine.width/this.dist,2)+this.baseLine.left,e=d-3,f=this.baseLine.top+30,g=this.baseLine.bottom-20,h=f;this.maxDep&&
0!=a.dep&&(h=a.dep*(g-f)/Math.ceil(this.maxDep));var g=f="",k;0<=a.dip&&50>=a.dip?(f=e,g=h,k=6):50<a.dip&&100>=a.dip?(f=e-1,g=h-1,k=8):100<a.dip&&200>=a.dip?(f=e-2,g=h-2,k=10):200<a.dip&&300>=a.dip?(f=e-3,g=h-3,k=12):300<a.dip&&400>=a.dip?(f=e-4,g=h-4,k=14):400<a.dip&&(f=e-5,g=h-5,k=16);c+='<v:oval id="underPoi'+b+'" class="underPoi" strokecolor="'+a.color+'" fillcolor="'+a.color+'" style="position:absolute; left:'+f+"px; top:"+g+"px; width:"+k+"px; height:"+k+'px;" />';c+='<v:line id="underFac'+
b+'" table="'+a.table+'" class="underFac" from="'+d+","+this.baseLine.top+'" to="'+d+","+this.baseLine.bottom+'" strokeweight="1pt">';c+='<v:stroke color="'+a.color+'" />';c=c+"</v:line>"+('<v:line from="'+(e-3)+","+h+'" to="'+(e-3+.1)+","+(h-20)+'">');c+='<v:fill on="true" color="black" />';c+='<v:path textpathok="true" />';c+='<v:textpath on="true" fitpath="false" string="'+a.dep+'" style="font-size:6pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';return c+="</v:line>"},drawRoads:function(){for(var a=
"",b=0,c=this.roads.length;b<c;b++)a+=this.drawRoad(this.roads[b],b);return a},drawRoad:function(a,b){var c="",d=GUtil.fn_fmt_fix(a.dist*this.baseLine.width/this.dist,2)+this.baseLine.left,e=GUtil.fn_fmt_fix(a.distEnd*this.baseLine.width/this.dist,2)+this.baseLine.left;d<=this.baseLine.left&&(d=this.baseLine.left);e>this.baseLine.width+this.baseLine.left&&(e=this.baseLine.width+this.baseLine.left);c+='<v:rect strokecolor="#ffffff" fillcolor="'+a.color+'" style="position:absolute;top:'+(this.baseLine.top+
-15)+"px; left:"+d+"px; width:"+(e-d)+'px; height:15px" />';d!=this.baseLine.left&&(c+='<v:line from="'+d+","+this.baseLine.top+'" to="'+d+","+this.baseLine.bottom+'" strokeweight="1pt" >',c+='<v:stroke dashstyle="dot" color="'+a.color+'" />',c+="</v:line>");c+='<v:line from="'+e+","+this.baseLine.top+'" to="'+e+","+this.baseLine.bottom+'" strokeweight="1pt" >';c+='<v:stroke dashstyle="dot" color="'+a.color+'" />';return c+"</v:line>"},drawDistList:function(){var a=[];a.push(0);for(var b=0,c=this.facilities.length;b<
c;b++)a.push(parseFloat(this.facilities[b].dist));b=0;for(c=this.roads.length;b<c;b++){0<this.roads[b].dist&&a.push(parseFloat(this.roads[b].dist));var d=parseFloat(parseFloat(this.roads[b].distEnd));d<this.dist&&a.push(d)}a.push(this.dist);for(b=a.length-1;0<b;b--)for(c=0;c<b;c++)a[c]>a[c+1]&&(d=a[c],a[c]=a[c+1],a[c+1]=d);d="";b=0;for(c=a.length-1;b<c;b++)d+=this.drawFacDist(a[b],a[b+1],b);return d},drawFacDist:function(a,b,c){if(a==this.baseLine.left)return"";c=0==c%2?8:-8;b=GUtil.fn_fmt_fix(b-
a,2);a=GUtil.fn_fmt_fix((a+b/2)*this.baseLine.width/this.dist,2)+this.offset.left;if(0==b)return"";a=""+('<v:line from="'+(a-5)+","+(this.baseLine.bottom-c)+'" to="'+(a+5)+","+(this.baseLine.bottom-c-.1)+'">');a+='<v:fill on="true" color="black" /><v:path textpathok="true" />';a+='<v:textpath on="true" fitpath="false" string="'+b+'" style="font-size:6pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';return a+="</v:line>"},drawEvent:function(){var a;a='<v:line id="eventDistLine" from="0,0" to="0,0" strokecolor="red" strokeweight="1pt" /><v:line id="eventDistStr" from="0,0" to="0,0">';
a+='<v:fill on="true" color="red" />';a+='<v:stroke color="red" />';a+='<v:path textpathok="true" />';a+='<v:textpath on="true" string="" style="font-size:6pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal;" />';a+="</v:line>";a+="<div class='acssAttr'>";a+="<div style='margin-bottom:5px;'><span class='titLyr'></span></div>";a+="<div><span class='tit'>\uad6c\uacbd</span> : <span class='dip'></span></div>";a+="<div><span class='tit'>\uc2ec\ub3c4</span> : <span class='dep'></span></div>";return a+=
"</div>"}},initEvent:function(a){$(a).unbind("mousemove");$(".underPoi",a).unbind("click");$(".underFac",a).unbind("mouseover");$(".underFac",a).unbind("mouseout");$(".underFac",a).unbind("click")},positionEvent:function(a){$(a).bind("mousemove",this,function(a){var c=a.data;if(10<=a.offsetX&&590>=a.offsetX){var d=c.res.searchPoint.dist.x*(a.offsetX-10)/580;a=c.res.searchPoint.dist.y*(a.offsetX-10)/580;d=parseFloat(c.res.searchPoint.start.x)+parseFloat(d*c.res.searchPoint.dist.signX);a=parseFloat(c.res.searchPoint.start.y)+
parseFloat(a*c.res.searchPoint.dist.signY);d=new OpenLayers.LonLat(d,a);c.feature.move(d)}})},attrEvent:function(a,b){$(".underFac",a).bind("mouseover",this.res,function(b){var d=$(this).attr("id").replace("underFac","");$(".acssAttr span.dip",a).text(b.data.facilities[d].dip);$(".acssAttr span.dep",a).text(b.data.facilities[d].dep);$(".acssAttr span.titLyr",a).text(b.data.facilities[d].layer);$(".acssAttr",a).css("left",$(this).offset().left);$(".acssAttr",a).css("top",b.clientY-$(a).position().top);
$(".acssAttr",a).show()});$(".underFac",a).bind("mouseout",this.res,function(b){$(".acssAttr",a).hide()});$(".underFac",a).bind("click",this.res,function(a){var d=$(this).attr("id").replace("underFac","");b&&b(a.data.facilities[d].table,a.data.facilities[d].id)})},distEvent:function(a){this.res.eventDist.drawOffset.x=$(a).position().left+10;this.res.eventDist.drawOffset.y=$(a).position().top+10;$(".underPoi",a).bind("click",this.res,function(b){var c=$(this).attr("id").replace("underPoi","");if(b.data.eventDist.move){b.data.eventDist.move=
!1;b.data.eventDist.endDist=b.data.facilities[c].dist;b.data.eventDist.endDep=b.data.facilities[c].dep;var c=Math.abs(b.data.eventDist.endDist-b.data.eventDist.startDist),d=Math.abs(b.data.eventDist.endDep-b.data.eventDist.startDep),e=b.clientX-b.data.eventDist.drawOffset.x+15,f=b.clientY-b.data.eventDist.drawOffset.y;$("#eventDistStr",a).attr("from",e+","+f);$("#eventDistStr",a).attr("to",parseFloat(e)+10+","+(parseFloat(f)+.1));$("#eventDistStr textpath",a).attr("string",GUtil.fn_fmt_fix(Math.sqrt(c*
c+d*d),2));$(a).unbind("mousemove")}else b.data.eventDist.move=!0,b.data.eventDist.startDist=b.data.facilities[c].dist,b.data.eventDist.startDep=b.data.facilities[c].dep,e=$(this).css("left").replace("px",""),f=$(this).css("top").replace("px",""),$("#eventDistLine",a).attr("from",parseFloat(e)+4+","+(parseFloat(f)+3)),$("#eventDistLine",a).attr("to",parseFloat(e)+4+","+(parseFloat(f)+3)),$("#eventDistLine",a).show(),$(a).bind("mousemove",b.data,function(b){var c=b.clientX-b.data.eventDist.drawOffset.x;
b=b.clientY-b.data.eventDist.drawOffset.y;$("#eventDistLine",a).attr("to",c+","+b)})})},activeEvent:function(a,b,c){this.initEvent(a);"p"==b?this.positionEvent(a):"d"==b?this.distEvent(a):"a"==b&&this.attrEvent(a,c)},initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.EVENT_TYPES=GAcss.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);this.callbacks=OpenLayers.Util.extend({mouseup:this.getFeature},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},
this.handlerOptions);this.handler=new GPath(this,this.callbacks,this.handlerOptions)},setStyle:function(a){for(var b in a)for(var c in a[b])this.handlerOptions.layerOptions.styleMap.styles["default"].rules[0].symbolizer[b][c]=a[b][c];this.handler.handlerOptions=this.handlerOptions},getFeature:function(a,b){this.res.clear();var c="";if(3==b.components.length){c=b.getVertices()[0].x+","+b.getVertices()[0].y+",";c+=b.getVertices()[1].x+","+b.getVertices()[1].y;this.handler.finish();a=new OpenLayers.Geometry.Point(b.getVertices()[1].x,
b.getVertices()[1].y);this.feature=new OpenLayers.Feature.Vector(a);this.handler.layer.addFeatures(this.feature);this.res.setInitParam(this.width,this.height,b.getLength());this.insertLabel(b);var c=GUtil.fn_convert_objToStr({SERVICE:"ACSS",VERSION:this.version,REQUEST:"GetCSView",LAYERS:this.layers.join(),STYLES:this.styles.join(),TYPES:this.types.join(),SEARCHPOINT:c,CRS:this.crs,WIDTH:this.width,HEIGHT:this.height,FORMAT:this.format,BGCOLOR:this.bgcolor,RESULTTYPE:this.resultType}),d=this;"VIEW"==
this.resultType?(this.imgPath=this.serviceUrl+c,this.events.triggerEvent(this.EVENT_TYPES[0])):GMapUtil.sendProxyGet(this.serviceUrl,c,function(a){d.parseRes(a,d)});$("*").css("cursor","default")}},insertLabel:function(a){var b,c;b=0>a.getVertices()[0].x-a.getVertices()[1].x?-2:2;c=0>a.getVertices()[0].y-a.getVertices()[1].y?-2:2;var d=new OpenLayers.Geometry.Point(a.getVertices()[0].x+b,a.getVertices()[0].y+c);b=0>a.getVertices()[a.getVertices().length-1].x-a.getVertices()[a.getVertices().length-
2].x?-2:2;c=0>a.getVertices()[a.getVertices().length-1].y-a.getVertices()[a.getVertices().length-2].y?-2:2;a=new OpenLayers.Geometry.Point(a.getVertices()[a.getVertices().length-1].x+b,a.getVertices()[a.getVertices().length-1].y+c);d=new OpenLayers.Feature.Vector(d,null,{label:"A",fontSize:20,fontWeight:"bold"});a=new OpenLayers.Feature.Vector(a,null,{label:"B",fontSize:20,fontWeight:"bold"});this.handler.layer.addFeatures(d);this.handler.layer.addFeatures(a)},parseRes:function(a,b){var c=a.getElementsByTagName("CrossSectionResult");
b.res.distList.push(0);var d,e;if(0<c.length){var f=c[0].getElementsByTagName("SearchPoint");d=c[0].getElementsByTagName("UnderFacility");e=c[0].getElementsByTagName("Road");if(0<f.length){var g=f[0].getElementsByTagName("StartPoint"),c=f[0].getElementsByTagName("EndPoint"),f=f[0].getElementsByTagName("Length"),h;0<g.length&&(h=g[0].getElementsByTagName("X"),g=g[0].getElementsByTagName("Y"),0<=h.length&&(b.res.searchPoint.start.x=$(h[0]).text()),0<=g.length&&(b.res.searchPoint.start.y=$(g[0]).text()));
0<c.length&&(h=c[0].getElementsByTagName("X"),g=c[0].getElementsByTagName("Y"),0<=h.length&&(b.res.searchPoint.end.x=$(h[0]).text()),0<=g.length&&(b.res.searchPoint.end.y=$(g[0]).text()));0<f.length&&(b.res.dist=$(f[0]).text());b.res.searchPoint.dist.signX=0<b.res.searchPoint.start.x-b.res.searchPoint.end.x?-1:1;b.res.searchPoint.dist.signY=0<b.res.searchPoint.start.y-b.res.searchPoint.end.y?-1:1;b.res.searchPoint.dist.x=Math.abs(b.res.searchPoint.start.x-b.res.searchPoint.end.x);b.res.searchPoint.dist.y=
Math.abs(b.res.searchPoint.start.y-b.res.searchPoint.end.y)}}if(0<d.length&&(d=d[0].getElementsByTagName("Feature"),0<d.length))for(c=0,f=d.length;c<f;c++){g={dist:0,table:"",layer:"",id:0,dep:0,dip:0,color:"",type:"fac"};h=d[c].getElementsByTagName("Distance");var k=d[c].getElementsByTagName("DataSetName"),l=d[c].getElementsByTagName("LayerName"),m=d[c].getElementsByTagName("FeatureID"),n=d[c].getElementsByTagName("Depth"),q=d[c].getElementsByTagName("Diameter"),r=d[c].getElementsByTagName("Color");
0<h.length&&(g.dist=parseFloat($(h[0]).text()));0<k.length&&(g.table=$(k[0]).text());0<l.length&&(g.layer=$(l[0]).text());0<m.length&&(g.id=$(m[0]).text());0<n.length&&(g.dep=parseFloat($(n[0]).text()));0<q.length&&(g.dip=parseFloat($(q[0]).text()));0<r.length&&(g.color="#"+$(r[0]).text().substring(3));b.res.facilities.push(g)}if(0<e.length&&(d=e[0].getElementsByTagName("Feature"),0<d.length))for(c=0,f=d.length;c<f;c++)g={dist:0,table:"",layer:"",id:0,color:"",type:"road"},h=d[c].getElementsByTagName("Distance1"),
e=d[c].getElementsByTagName("Distance2"),k=d[c].getElementsByTagName("DataSetName"),l=d[c].getElementsByTagName("LayerName"),m=d[c].getElementsByTagName("FeatureID"),r=d[c].getElementsByTagName("Color"),0<h.length&&(g.dist=parseFloat($(h[0]).text())),0<e.length&&(g.distEnd=parseFloat($(e[0]).text())),0<k.length&&(g.table=$(k[0]).text()),0<l.length&&(g.layer=$(l[0]).text()),0<m.length&&(g.id=$(m[0]).text()),0<r.length&&(g.color="#"+$(r[0]).text().substring(3)),b.res.roads.push(g);b.res.setResInit();
b.events.triggerEvent(b.EVENT_TYPES[0])},orderBySeq:function(a,b,c){for(var d=a.length-1;0<d;d--)for(var e=0;e<d;e++)"desc"==c.toLowerCase()?a[e][b]<a[e+1][b]&&GUtil.Array.fn_swap_element(a,e,e+1):a[e][b]>a[e+1][b]&&GUtil.Array.fn_swap_element(a,e,e+1)},getAlias:function(){return this.alias},getLayers:function(){return this.layers},getStyles:function(){return this.styles},getImgPath:function(){return this.imgPath},CLASS_NAME:"GAcss"});GAlis=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["callback"],serviceUrl:null,persist:!0,alias:!1,service:"ALIS",version:"1.1.0",request:"GetLeakIsolation",layers:[],types:[],pipeDistance:.5,pipeJoinDistance:.5,valveDistance:.5,format:"text/xml",exceptions:"Xml",requesttype:"TOTAL",crs:"EPSG:4326",where:"",callbacks:null,handlerOptions:{persistLayer:!0,layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:4,graphicName:"circle",fillColor:"#ffffff",fillOpacity:1,
strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"})})}},initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.EVENT_TYPES=GAlis.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);this.callbacks=OpenLayers.Util.extend({done:this.getFeature},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new GPoint(this,this.callbacks,this.handlerOptions)},getFeature:function(a){var b=this;a=a.getCentroid().x+
","+a.getCentroid().y;a=GUtil.fn_convert_objToStr({SERVICE:this.service,VERSION:this.version,REQUEST:this.request,LAYERS:this.layers.join(),TYPES:this.types.join(),LEAKPOINT:a,PIPEDISTANCE:this.pipeDistance,PIPEJOINDISTANCE:this.pipeJoinDistance,VALVEDISTANCE:this.valveDistance,FORMAT:this.format,EXCEPTIONS:this.exceptions,REQUESTTYPE:this.requesttype,CRS:this.crs,WHERES:this.where});GMapUtil.sendProxyPost(this.serviceUrl,a,function(a){b.parseResponse(a)})},parseResponse:function(a){var b={pipes:[],
valves:[]},c=!0;(a=a.getElementsByTagName("LeakIsolationResult"))&&0<a.length?(this.parseTable(a[0],b,"Pipes"),this.parseTable(a[0],b,"Valves"),0>=b.pipes.length&&0>=b.valves.length&&(c=!1)):c=!1;this.alias?this.events.triggerEvent(this.EVENT_TYPES[0],{data:b,success:function(){return c}}):this.getRequestAlias(b,c)},parseTable:function(a,b,c){var d=c.toLowerCase();if((a=a.getElementsByTagName(c))&&0<a.length&&""!=$(a[0]).text()){a=$(a[0]).text().split(",");c=0;for(var e=a.length;c<e;c++){var f=a[c].split("."),
g=f[0],h=!1,k;for(k in b[d])b[d][k].table==g&&(h=k);h?g=b[d][h]:(g={table:g,alias:null,ids:[]},b[d].push(g));g.ids.push(f[1])}}else return!1},getRequestAlias:function(a,b){if(b){for(var c=this,d="",e=0,f=a.pipes.length;e<f;e++)d+=a.pipes[e].table+":";e=0;for(f=a.valves.length;e<f;e++)d+=a.valves[e].table+":";$.post("/gmap/attr/getAlias.do",{data:d},function(d){for(var e=0,f=0,l=a.pipes.length;f<l;f++)a.pipes[f].alias=d.data[e][a.pipes[f].table],e++;f=0;for(l=a.valves.length;f<l;f++)a.valves[f].alias=
d.data[e][a.valves[f].table],e++;c.events.triggerEvent(c.EVENT_TYPES[0],{data:a,success:function(){return b}})},"json")}else this.events.triggerEvent(this.EVENT_TYPES[0],{data:null,success:function(){return b}})},CLASS_NAME:"GAlis"});GDrag=OpenLayers.Class(OpenLayers.Control.Navigation,{CLASS_NAME:"GDrag"});GDrawFeature=OpenLayers.Class(OpenLayers.Control.DrawFeature,{inputTextPopup:null,seq:0,drawFeature:function(a,b){b&&b.featureType&&"Text"==b.featureType&&this.removeInputTextPopup();b.seq=this.seq;this.seq++;var c=new OpenLayers.Feature.Vector(a,b);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:c})&&(c.state=OpenLayers.State.INSERT,this.layer.addFeatures([c]),this.featureAdded(c),this.events.triggerEvent("featureadded",{feature:c}));b&&b.featureType&&"Text"==b.featureType&&this.addInputTextPopup(c)},
addInputTextPopup:function(a){var b;b="<div class='olControlDrawInputText'><textarea class='olControlDrawInputTextArea'></textarea>";apiServerHost?(b+="<img class='olControlDrawInputTextConfirm' src='"+apiServerHost+"/images/GMap/DrawText/btn_submit.gif' alt='\ud655\uc778' title='\ud655\uc778' />",b+="<img class='olControlDrawInputTextCancel' src='"+apiServerHost+"/images/GMap/DrawText/btn_close.gif' alt='\ub2eb\uae30' title='\ub2eb\uae30' />"):(b+="<img class='olControlDrawInputTextConfirm' src='/images/GMap/DrawText/btn_submit.gif' alt='\ud655\uc778' title='\ud655\uc778' />",
b+="<img class='olControlDrawInputTextCancel' src='/images/GMap/DrawText/btn_close.gif' alt='\ub2eb\uae30' title='\ub2eb\uae30' />");b+="</div>";a=new GLonLat(a.geometry.x,a.geometry.y);this.inputTextPopup=new GPopup("drawInputText",a,null,b,new OpenLayers.Pixel(0,0));this.map.addPopup(this.inputTextPopup);this.inputTextPopup.updateSize();this.inputTextPopup.type="draw";$(".olControlDrawInputTextArea").focus();$(".olControlDrawInputTextConfirm").click(this,function(a){a.data.addTextPopup()});$(".olControlDrawInputTextCancel").click(this,
function(a){a.data.removeInputTextPopup()})},removeInputTextPopup:function(){this.inputTextPopup&&(this.map.removePopup(this.inputTextPopup),this.inputTextPopup=null);for(var a=this.layer.features.length-1;0<=a;a--)"Text"==this.layer.features[a].attributes.featureType&&this.layer.removeFeatures(this.layer.features[a])},addTextPopup:function(){var a=$(".olControlDrawInputTextArea").val();if(""!=GUtil.fn_trim(a)){var a=a.replace(/\x20/gi,"&nbsp;"),a=a.replace(/\x0D\x0A/gi,"<br/>"),a=a.replace(/\x0D/gi,
"<br/>"),a=a.replace(/\n/gi,"<br/>"),a=""+("<div class='olControlDrawText off' id='drawText"+this.seq+"'>"+a+"</div>"),b=this.inputTextPopup.getLonLat(),a=new GPopup("drawPopup"+this.seq,b,null,a,new OpenLayers.Pixel(0,0));this.map.addPopup(a);a.updateSize();a.type="draw";b="#000000";if(1<$("#drawText"+this.seq).css("color").split("rgb").length){var c=GUtil.fn_replaceAll($("#drawText"+this.seq).css("color").replace("rgb(","").replace(")","")," ","").split(","),b="#",d;for(d in c){var e=c[d].toString(16);
2>e.length&&(e="0"+e);b+=e}}a.attributes={featureType:"Text",fontFamily:$("#drawText"+this.seq).css("font-family"),fontSize:$("#drawText"+this.seq).css("font-size").replace("px",""),fontColor:b,seq:this.seq,text:$(".olControlDrawInputTextArea").val(),print:!0};this.seq++;$(".olControlDrawText").unbind();$(".olControlDrawText").click(this.map,function(a){a=a.data;a.getControl("drawSelect")&&a.getControl("drawSelect").active?a.getControl("drawSelect").selectTextPopup(this):a.getControl("drawEdit")&&
a.getControl("drawEdit").active&&a.getControl("drawEdit").selectTextPopup(this)});this.removeInputTextPopup()}},removeTextPopup:function(){var a;$(".olControlDrawText").each(function(){$(this).hasClass("on");a=$(this).attr("id")});for(var b in this.map.popups)this.map.popups[b].id==a&&this.map.removePopup(this.map.popups[b])},CLASS_NAME:"GDrawFeature"});GGetFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["callback","click"],serviceUrl:null,prefix:null,maxFeatures:9999,tables:[],titles:{},persist:!0,distance:10,callbacks:null,current:!1,alias:!1,useDomain:!1,layerTool:null,gml:new OpenLayers.Format.GML,result:null,sortFields:[],sortOrders:[],handlerOptions:{multiLine:!0,persistControl:!0,layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"circle",
fillColor:"#ffffff",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Polygon:{strokeWidth:1,strokeOpacity:1,strokeColor:"#333333",fillColor:"#ffffff",fillOpacity:.3}}})]})})}},initialize:function(a,b){b.handlerOptions&&OpenLayers.Util.extend(this.handlerOptions,b.handlerOptions);OpenLayers.Control.prototype.initialize.apply(this,[b]);this.EVENT_TYPES=GGetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
this.callbacks=OpenLayers.Util.extend({done:this.getFeature},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)},setTables:function(a){a instanceof Object?this.tables=a:(this.tables=[],this.tables.push(a))},setDistance:function(a){this.distance=a},setCallbacks:function(a){this.events.un(this.eventListeners);this.events.on(a)},setGetRequestFilter:function(a){this.getRequestFilter=a},getFeature:function(a){for(var b in this.map.layers){var c=
this.map.layers[b];c.projection&&(c.projection.equals(this.map.getProjectionObject())||a.transform(this.map.projection,c.projection))}this.events.triggerEvent(this.EVENT_TYPES[1],a);if(this.handler.radiusDist&&(0==this.handler.radiusDist||500<this.handler.radiusDist))alert("\uac80\uc0c9\ubc18\uacbd\uc740 0m \uc640 500m \uc774\ub0b4\ub85c \uc124\uc815\ud574\uc8fc\uc138\uc694");else{if(this.layerTool){this.tables=[];b=this.layerTool.getLayers({con:"attr",conVal:1,order:"asc"});var c=this.layerTool.getSld().namedLayers,
d;for(d in c){var e=c[d].userStyle,f;for(f in e){var g=e[f].rules,h;for(h in g)if(!g[h].symbolizer.text){var k=parseInt(this.map.getScale()),l=g[h].maxScale;0==l&&(l=parseInt(OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(0),this.map.units)));if(l>=k&&k>=g[h].minScale){for(var m in b)if(c[d].name==b[m].theme&&1==b[m].show){var g=!1,n;for(n in this.tables)if(this.tables[n]==b[m].table){g=!0;break}g||this.tables.push(b[m].table)}break}}}}if(1>this.tables.length){alert("\uc870\uac74\uc5d0 \ub9de\ub294 \ub808\uc774\uc5b4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");
return}}var q=this;"GPoint"==this.handler.CLASS_NAME?GRequest.WFS.getFeatureByDWithin(this.serviceUrl,{prefix:this.prefix,tables:this.tables,distance:this.distance,values:[a],sortFields:this.sortFields,sortOrders:this.sortOrders,useDomain:this.useDomain},function(a){q.result=a;q.events.triggerEvent(q.EVENT_TYPES[0],a)},{alias:this.alias,titles:this.titles,getRequestFilter:this.getRequestFilter}):GRequest.WFS.getFeatureByGeometry(this.serviceUrl,{prefix:this.prefix,tables:this.tables,values:[a],sortFields:this.sortFields,
sortOrders:this.sortOrders,useDomain:this.useDomain},function(a){q.result=a;q.events.triggerEvent(q.EVENT_TYPES[0],a)},{alias:this.alias,titles:this.titles,getRequestFilter:this.getRequestFilter})}},getResult:function(){return this.result},CLASS_NAME:"GGetFeature"});GMeasure=OpenLayers.Class(OpenLayers.Control.Measure,{persist:!0,handlerOptions:{multiLine:!0,persistControl:!0,layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"#ffffff",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#ff8000"},Line:{strokeWidth:3,strokeOpacity:.7,strokeColor:"#ff8000"},Polygon:{strokeWidth:3,strokeOpacity:.7,strokeColor:"#ff8000",fillColor:"#ee9900",
fillOpacity:0}}})]})})}},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.callbacks=OpenLayers.Util.extend({done:this.measureComplete},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new a(this,this.callbacks,this.handlerOptions)},measureComplete:function(a){this.cancelDelay();this.measure(a,"measure")},setStyle:function(a){for(var b in a)for(var c in a[b])this.handlerOptions.layerOptions.styleMap.styles["default"].rules[0].symbolizer[b][c]=
a[b][c];this.handler.handlerOptions=this.handlerOptions},CLASS_NAME:"GMeasure"});GModifyFeature=OpenLayers.Class(OpenLayers.Control.ModifyFeature,{onDeactivate:function(){},virtualStyle:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:.5,strokeWidth:1,strokeOpacity:.8,strokeColor:"#333333"},vertexStyle:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},dragStyle:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},resizeStyle:{pointRadius:4,
graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},rotateStyle:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},initialize:function(a,b){b=b||{};this.layer=a;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent));this.virtualStyle.fillOpacity=.3;this.virtualStyle.strokeOpacity=
.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[b]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={documentDrag:this.documentDrag,stopDown:!1};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress}),drag:new OpenLayers.Handler.Drag(this,{down:function(a){this.vertex=null;(a=this.layer.getFeatureFromEvent(this.handlers.drag.evt))?this.dragStart(a):
this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect;this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1;this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(a){this.vertex&&this.dragComplete(this.vertex)}},c)}},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){!1!==this.beforeSelectFeature(a)&&(this.feature&&
this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},selectTextPopup:function(a){var b=$(a).hasClass("on");this.selectControl.unselectAll();if(!b){$(a).removeClass("off");$(a).addClass("on");var c,d;for(d in this.map.popups)this.map.popups[d].attributes.seq==$(a).attr("id").replace("drawText",
"")&&(c=this.map.popups[d]);c.attributes.fontFamily=$(a).css("font-family");c.attributes.fontSize=$(a).css("font-size");c.attributes.fontColor=$(a).css("color");this.onModificationStart(c)}},unSelectTextPopup:function(){$(".olControlDrawText").each(function(){$(this).removeClass("on");$(this).addClass("off")})},collectVertices:function(){function a(c){var d,e,f;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,b.vertices.push(e);else{f=c.components.length;
"OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(f-=1);for(d=0;d<f;++d)e=c.components[d],"OpenLayers.Geometry.Point"==e.CLASS_NAME?(e=new OpenLayers.Feature.Vector(e,null,b.vertexStyle),e._sketch=!0,b.vertices.push(e)):a(e);if("OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,f=c.components.length;d<f-1;++d){e=c.components[d];var g=c.components[d+1];"OpenLayers.Geometry.Point"==e.CLASS_NAME&&"OpenLayers.Geometry.Point"==g.CLASS_NAME&&(e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((e.x+
g.x)/2,(e.y+g.y)/2),null,b.virtualStyle),e.geometry.parent=c,e._index=d+1,e._sketch=!0,b.virtualVertices.push(e))}}}this.vertices=[];this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),c=new OpenLayers.Feature.Vector(b,null,this.dragStyle);
b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);a.move(b,c)};c._sketch=!0;this.dragHandle=c;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),b=new OpenLayers.Geometry.Point(b.right,b.bottom),c=this.mode&OpenLayers.Control.ModifyFeature.ROTATE?new OpenLayers.Feature.Vector(b,
null,this.rotateStyle):new OpenLayers.Feature.Vector(b,null,this.resizeStyle),e=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,f=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,g=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var l=this.x-d.x,m=this.y-d.y,n=l-b,q=m-c;if(g){var r=Math.atan2(q,n),r=Math.atan2(m,l)-r,r=180/Math.PI*r;a.rotate(r,d)}if(e){var y;f?(m/=q,y=l/n/m):(n=Math.sqrt(n*n+q*q),m=Math.sqrt(l*l+m*
m)/n);a.resize(m,d,y)}};c._sketch=!0;this.radiusHandle=c;this.layer.addFeatures([this.radiusHandle],{silent:!0})},deactivate:function(){var a=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate(),
(a=this.feature)&&a.geometry&&a.layer&&this.unselectFeature(a),this.unSelectTextPopup(),a=!0);return a},CLASS_NAME:"GModifyFeature"});GNavigationHistory=OpenLayers.Class(OpenLayers.Control.NavigationHistory,{CLASS_NAME:"GNavigationHistory"});GProfile=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["callback"],serviceUrl:null,persist:!0,width:400,height:300,version:"1.0.0",layer:"DEM",interval:1,callbacks:null,feature:null,handlerOptions:{multiLine:!0,persistControl:!0,layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"circle",fillColor:"#ffffff",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:2,
strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000",fillColor:"#ee9900",fillOpacity:0}}})]})})}},res:{dist:0,width:0,height:0,maxZ:0,posWidth:0,posHeight:0,posList:[],offset:{left:30,bottom:20,right:10,top:40},baseLine:{top:0,left:0,bottom:0,right:0,width:0,height:0},eventDist:{move:!1,startDist:0,startZ:0,endDist:0,endDep:0,startPos:{x:0,y:0},drawOffset:{x:0,y:0}},clear:function(){this.maxZ=this.height=this.width=this.dist=0;this.posList=[];this.baseLine=
{top:0,left:0,bottom:0,right:0,width:0,height:0};this.eventDist={move:!1,startDist:0,startZ:0,endDist:0,endZ:0,startPos:{x:0,y:0},drawOffset:{x:0,y:0}}},setInitParam:function(a,b,c){this.setSize(a,b);this.setBaseLine();this.dist=parseFloat(c)},setSize:function(a,b){this.width=a;this.height=b},setBaseLine:function(){this.baseLine.left=parseFloat(this.offset.left);this.baseLine.bottom=parseFloat(this.height-this.offset.bottom);this.baseLine.right=parseFloat(this.width-this.offset.right);this.baseLine.top=
parseFloat(this.offset.top);this.baseLine.width=parseFloat(this.width-(this.offset.left+this.offset.right));this.baseLine.height=parseFloat(this.height-(this.offset.bottom+this.offset.top))},setResInit:function(){this.setMaxZ();this.setPos()},setMaxZ:function(){for(var a=0,b=this.posList.length;a<b;a++)this.posList[a].z>this.maxZ&&(this.maxZ=parseFloat(this.posList[a].z))},setPos:function(){this.posWidth=this.baseLine.width/(this.dist-1);this.posHeight=this.baseLine.height/this.maxZ},draw:function(a,
b){var c;c=""+this.drawBase();c+=this.drawPosZList();c+=this.drawLattice();c+=this.drawEvent();$(a).html(c)},drawBase:function(){var a;a=""+('<v:line id="leftLine" from="'+this.baseLine.left+","+this.baseLine.top+'" to="'+this.baseLine.left+","+(this.baseLine.bottom+5)+'" strokecolor="black" strokeweight="1pt" />');a+='<v:line id="startText" from="'+(this.baseLine.left-5)+","+this.baseLine.top/2+'" to="'+(this.baseLine.left+5)+","+(this.baseLine.top/2+.1)+'">';a+='<v:fill on="true" color="black" /><v:path textpathok="true" />';
a+='<v:textpath on="true" fitpath="false" string="A" style="font-size:12pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';a+="</v:line>";a+='<v:line id="bottomLine" from="'+this.baseLine.left+","+this.baseLine.bottom+'" to="'+this.baseLine.right+","+this.baseLine.bottom+'" strokecolor="black" strokeweight="1pt" />';a+='<v:line id="bottomLine" from="'+this.baseLine.left+","+this.baseLine.top+'" to="'+this.baseLine.right+","+this.baseLine.top+'" strokecolor="black" strokeweight="1pt" />';a+=
'<v:line id="rightLine" from="'+this.baseLine.right+","+this.baseLine.top+'" to="'+this.baseLine.right+","+(this.baseLine.bottom+5)+'" strokecolor="black" strokeweight="1pt" />';a+='<v:line id="endText" from="'+(this.baseLine.right-5)+","+this.baseLine.top/2+'" to="'+(this.baseLine.right+5)+","+(this.baseLine.top/2+.1)+'">';a+='<v:fill on="true" color="black" />';a+='<v:path textpathok="true" />';a+='<v:textpath on="true" fitpath="false" string="B" style="font-size:12pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />';
return a+="</v:line>"},drawLattice:function(){for(var a="",b=Math.floor(this.posList.length/10),c=[500,100,10,5],d=0,e=c.length;d<e;d++)if(b>c[d]){for(;b--,0!=b%c[d];);break}d=b;for(e=this.posList.length;d<e;d+=b)var f=GUtil.fn_fmt_fix(this.posWidth*d,2)+this.baseLine.left,a=a+('<v:line id="latticeRow'+d+'" from="'+f+","+this.baseLine.top+'" to="'+f+","+this.baseLine.bottom+'" strokecolor="black" strokeweight="1pt">'),a=a+'<v:stroke dashstyle="dash" />',a=a+"</v:line>",a=a+('<v:line id="latticeText" from="'+
(f-3)+","+(this.baseLine.top-7)+'" to="'+(f+3)+","+(this.baseLine.top-7+.1)+'">'),a=a+'<v:fill on="true" color="black" />',a=a+'<v:path textpathok="true" />',a=a+('<v:textpath on="true" fitpath="false" string="'+d+'m" style="font-size:8pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />'),a=a+"</v:line>";b=Math.floor(this.maxZ/4);d=0;for(e=c.length;d<e;d++)if(b>c[d]){for(;b--,0!=b%c[d];);break}for(d=0;d<this.maxZ;d+=b)c=this.baseLine.bottom-this.posHeight*d,a+='<v:line id="latticeCell'+d+'" from="'+
this.baseLine.left+","+c+'" to="'+this.baseLine.right+","+c+'" strokecolor="black" strokeweight="1pt">',a+='<v:stroke dashstyle="dash" />',a+="</v:line>",a+='<v:line id="latticeText" from="'+(this.baseLine.left-20)+","+c+'" to="'+(this.baseLine.left-10)+","+(c+.1)+'">',a+='<v:fill on="true" color="black" />',a+='<v:path textpathok="true" />',a+='<v:textpath on="true" fitpath="false" string="'+d+'m" style="font-size:8pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal" />',a+="</v:line>";return a},
drawPosZList:function(){var a;a=""+("<v:shape style='position:absolute;top:0px;left:0px;width:"+this.width+"px;height:"+this.height+"px' stroke='true' strokecolor='black' strokeweight='1' file='true' fillcolor='#08FF08' coordorigin='0 0' coordsize='"+this.width+", "+this.height+"' >");a+="<v:path v='m ";for(var b=0,c=this.posList.length;b<c;b++)1==b?a+=" l ":0!=b&&(a+=","),a+=this.drawPosZ(this.posList[b],b);a+=","+this.baseLine.right+","+this.baseLine.bottom+","+this.baseLine.left+","+this.baseLine.bottom;
a+=" x e' /></v:shape>";$("#txtTest").val(a);return a},drawPosZ:function(a,b){return Math.floor(this.posWidth*b,2)+this.baseLine.left+","+Math.floor(this.baseLine.bottom-a.z*this.baseLine.height/this.maxZ)},drawEvent:function(){var a;a='<v:line id="eventDistLine" from="0,0" to="0,0" strokecolor="red" strokeweight="1pt" /><v:line id="eventDistStr" from="0,0" to="0,0">';a+='<v:fill on="true" color="red" />';a+='<v:stroke color="red" />';a+='<v:path textpathok="true" />';a+='<v:textpath on="true" string="" style="font-size:8pt;font-family:dotum,\ub3cb\uc6c0;font-weight:normal;" />';
return a+="</v:line>"}},initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.EVENT_TYPES=GAcss.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);this.callbacks=OpenLayers.Util.extend({done:this.getFeature},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new GPath(this,this.callbacks,this.handlerOptions)},getFeature:function(a){this.res.clear();var b="";if(2<=a.components.length){for(var c=
0,d=a.getVertices().length;c<d;c++)0!=c&&(b+=","),b+=a.getVertices()[c].x+","+a.getVertices()[c].y;this.insertLabel(a);c=new OpenLayers.Geometry.Point(a.getVertices()[a.getVertices().length-1].x,a.getVertices()[a.getVertices().length-1].y);this.feature=new OpenLayers.Feature.Vector(c);this.handler.layer.addFeatures(this.feature);this.res.setInitParam(this.width,this.height,a.getLength());a=GUtil.fn_convert_objToStr({SERVICE:"WPS",VERSION:this.version,REQUEST:"Execute",IDENTIFIER:"Profile",DATAINPUTS:"[LAYER="+
this.layer+";CLIP_LINE="+b+";INTERVAL="+this.interval+"]",RESPONSEDOCUMENT:"PROFILE_OUTPUT"});$("#txtTest").val(a);var e=this;GMapUtil.sendProxyGet(this.serviceUrl,a,function(a){e.parseRes(a,e)})}},insertLabel:function(a){var b,c;b=0>a.getVertices()[0].x-a.getVertices()[1].x?-2:2;c=0>a.getVertices()[0].y-a.getVertices()[1].y?-2:2;var d=new OpenLayers.Geometry.Point(a.getVertices()[0].x+b,a.getVertices()[0].y+c);b=0>a.getVertices()[a.getVertices().length-1].x-a.getVertices()[a.getVertices().length-
2].x?-2:2;c=0>a.getVertices()[a.getVertices().length-1].y-a.getVertices()[a.getVertices().length-2].y?-2:2;a=new OpenLayers.Geometry.Point(a.getVertices()[a.getVertices().length-1].x+b,a.getVertices()[a.getVertices().length-1].y+c);d=new OpenLayers.Feature.Vector(d,null,{label:"A",fontSize:20,fontWeight:"bold"});a=new OpenLayers.Feature.Vector(a,null,{label:"B",fontSize:20,fontWeight:"bold"});this.handler.layer.addFeatures(d);this.handler.layer.addFeatures(a)},parseRes:function(a,b){var c=a.getElementsByTagName("prof:MeasurePoint");
if(0<=c.length){for(var c=c[0].getElementsByTagName("prof:Point"),d=0,e=c.length;d<e;d++){var f=c[d].getElementsByTagName("prof:X"),g=c[d].getElementsByTagName("prof:Y"),h=c[d].getElementsByTagName("prof:Z"),f={x:parseFloat($(f[0]).text()),y:parseFloat($(g[0]).text()),z:parseFloat($(h[0]).text())};b.res.posList.push(f)}b.res.dist=c.length}b.res.setResInit();b.events.triggerEvent(b.EVENT_TYPES[0])},CLASS_NAME:"GProfile"});GSelectFeature=OpenLayers.Class(OpenLayers.Control.SelectFeature,{initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);null===this.scope&&(this.scope=this);this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};
this.box&&(this.handlers.box=new GBox(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},clickFeature:function(a){this.hover?this.onHoverClick&&this.onHoverClick.call(this.scope,a):-1<OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a))},onUnselectAll:function(){},unselectAll:function(a){for(var b=this.layers||[this.layer],
c,d,e=0;e<b.length;++e){c=b[e];for(var f=c.selectedFeatures.length-1;0<=f;--f)d=c.selectedFeatures[f],a&&a.except==d||this.unselect(d)}$(".olControlDrawText").each(function(){$(this).removeClass("on");$(this).addClass("off")});this.onUnselectAll()},selectTextPopup:function(a){},CLASS_NAME:"GSelectFeature"});GZoomBoxIndex=OpenLayers.Class(OpenLayers.Control.ZoomBox,{baseMap:null,draw:function(){this.handler=new GBox(this,{done:this.zoomBox},{indexMap:!0})},initialize:function(a,b){this.baseMap=a;OpenLayers.Control.prototype.initialize.apply(this,[b])},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){if(this.out){var b=Math.abs(a.right-a.left),c=Math.abs(a.top-a.bottom),b=Math.min(this.map.size.h/c,this.map.size.w/b),c=this.map.getExtent(),d=this.map.getLonLatFromPixel(a.getCenterPixel());a=d.lon-
c.getWidth()/2*b;var e=d.lon+c.getWidth()/2*b,f=d.lat-c.getHeight()/2*b,b=d.lat+c.getHeight()/2*b,b=new OpenLayers.Bounds(a,f,e,b)}else b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom)),c=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top)),b=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.baseMap.zoomToExtent(b,!0)}else this.baseMap.setCenter(this.map.getLonLatFromPixel(a),this.baseMap.numZoomLevels-1)},CLASS_NAME:"GZoomBoxIndex"});GZoomIn=OpenLayers.Class(OpenLayers.Control.ZoomBox,{draw:function(){this.handler=new GBox(this,{done:this.zoomBox},{keyMask:this.keyMask})},CLASS_NAME:"GZoomIn"});GZoomOut=OpenLayers.Class(OpenLayers.Control.ZoomBox,{out:!0,draw:function(){this.handler=new GBox(this,{done:this.zoomBox},{keyMask:this.keyMask})},CLASS_NAME:"GZoomOut"});GPanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoomBar,{imgUrl:"/images/GMap/PanZoomBar/",imgZoomIn:"zoom-plus-mini.png",imgZoomOut:"zoom-minus-mini.png",imgZoomBasic:"",imgZoomBarOn:"zoombar.png",imgZoomBar:"slider.png",size:new GSize(18,18),sliderSize:new GSize(20,6),flow:"right",zoomPosition:"lefttop",offsetPixel:new GPixel(0,0),initialize:function(a){a.apiServerHost&&(this.imgUrl=apiServerHost+this.imgUrl);this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);
OpenLayers.Control.prototype.initialize.apply(this,arguments)},setDivSize:function(){var a,b;a=this.sliderSize.w>=this.size.w?this.sliderSize.w:this.size.w;b=2*this.size.h+this.zoomStopHeight*this.map.getNumZoomLevels();$(".GPanZoomBar").css("width",a+this.position.x);$(".GPanZoomBar").css("height",b+this.position.y);this.setPositionZoomBar(this.zoomPosition)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b=this.size,c=new OpenLayers.Pixel(a.x+
b.w/2,a.y);this._addButton("zoomin",this.imgUrl+this.imgZoomIn,a,b);c=this._addZoomBar(a.add(0,b.h));this._addButton("zoomout",this.imgUrl+this.imgZoomOut,c,b);this.setDivSize();return this.div},moveToZoomBar:function(){"right"==this.flow&&(this.offsetPixel.x=$("#map").width()-this.offsetPixel.x);this.moveTo(this.offsetPixel)},setPositionZoomBar:function(a){this.zoomPosition=a;"LEFTTOP"==a.toUpperCase()?($(".GPanZoomBar").css("top","0%"),$(".GPanZoomBar").css("left","0%"),$(".GPanZoomBar").css("bottom",
""),$(".GPanZoomBar").css("right",""),$(".GPanZoomBar").css("margin","10px 0px 0px 10px")):"LEFTBOTTOM"==a.toUpperCase()?($(".GPanZoomBar").css("top",""),$(".GPanZoomBar").css("left","0%"),$(".GPanZoomBar").css("bottom","0%"),$(".GPanZoomBar").css("right",""),$(".GPanZoomBar").css("margin","0px 0px 10px 10px")):"RIGHTTOP"==a.toUpperCase()?($(".GPanZoomBar").css("top","0%"),$(".GPanZoomBar").css("left",""),$(".GPanZoomBar").css("bottom",""),$(".GPanZoomBar").css("right","0%"),$(".GPanZoomBar").css("margin",
"10px 10px 0px 0px")):"RIGHTBOTTOM"==a.toUpperCase()&&($(".GPanZoomBar").css("top",""),$(".GPanZoomBar").css("left",""),$(".GPanZoomBar").css("bottom","0%"),$(".GPanZoomBar").css("right","0%"),$(".GPanZoomBar").css("margin","0px 10px 10px 0px"))},_addZoomBar:function(a){var b=this.imgUrl,c=this.id+"_"+this.map.id,d=this.map.getNumZoomLevels()-1-this.map.getZoom();this.slider=d=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),this.sliderSize,b+this.imgZoomBar,"absolute");this.sliderEvents=
new OpenLayers.Events(this,d,null,!0,{includeXY:!0});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var e=new OpenLayers.Size;e.h=this.zoomStopHeight*this.map.getNumZoomLevels();e.w=this.zoomStopWidth;c=null;OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a,new OpenLayers.Size(e.w,this.zoomStopHeight),b+this.imgZoomBarOn,"absolute",null,"crop"),c.style.height=
e.h+"px"):c=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,e,b+this.imgZoomBarOn);this.zoombarDiv=c;this.divEvents=new OpenLayers.Events(this,c,null,!0,{includeXY:!0});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(c);var f=this.zoomStopHeight*(this.map.getNumZoomLevels()-this.map.getZoom()-1);0>f&&(f*=-1);this.zoomBasicDiv=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_ZoombarBasic"+
this.map.id,a,new OpenLayers.Size(e.w,f),b+this.imgZoomBasic);this.divEvents=new OpenLayers.Events(this,this.zoomBasicDiv,null,!0,{includeXY:!0});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(this.zoomBasicDiv);this.startTop=parseInt(c.style.top);this.div.appendChild(d);this.map.events.register("zoomend",this,this.moveZoomBar);return a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},zoomBarUp:function(a){if(OpenLayers.Event.isLeftClick(a)&&
this.mouseDragStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.zoomStart.y-a.xy.y,c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=b/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)):c+=Math.round(b/this.zoomStopHeight);c>this.map.getNumZoomLevels()-1?c=this.map.getNumZoomLevels()-1:0>c&&(c=0);this.map.zoomTo(c);this.zoomStart=this.mouseDragStart=null;OpenLayers.Event.stop(a)}},
moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px";this.zoomBasicDiv.style.height=this.zoomStopHeight*(this.map.getNumZoomLevels()-this.map.getZoom()-1)+"px"},setImg:function(a){OpenLayers.Util.extend(this,a);this.redraw()},show:function(){$(this.div).show()},hide:function(){$(this.div).hide()},CLASS_NAME:"GPanZoomBar"});OpenLayers.Control.PanZoom.X=0;OpenLayers.Control.PanZoom.Y=0;GSLD=OpenLayers.Class(OpenLayers.Format.SLD,{CLASS_NAME:"GSLD"});GBox=OpenLayers.Class(OpenLayers.Handler.Box,{indexMap:!1,startBox:function(a){this.indexMap&&this.zoomBox&&this.removeBox();this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.border="2px solid #000000";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},applyBox:function(a){this.indexMap&&this.zoomBox&&
this.removeBox();this.dragHandler.start=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a.left,a.top));var b=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a.right,a.bottom));a=b.x-this.dragHandler.start.x;b=b.y-this.dragHandler.start.y;this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.zoomBox.style.width=a+"px";this.zoomBox.style.height=
b+"px"},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px";this.zoomBox.style.height=e+f.height+1+"px";this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px";this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(5<Math.abs(this.dragHandler.start.x-a.x)||5<Math.abs(this.dragHandler.start.y-a.y)){var c=this.dragHandler.start;b=Math.min(c.y,a.y);
var d=Math.max(c.y,a.y),e=Math.min(c.x,a.x);a=Math.max(c.x,a.x);b=new OpenLayers.Bounds(e,d,a,b)}else b=this.dragHandler.start.clone();this.indexMap||this.removeBox();this.callback("done",[b])},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler&&this.dragHandler.deactivate&&this.dragHandler.deactivate(),!0):!1},CLASS_NAME:"GBox"});GPath=OpenLayers.Class(OpenLayers.Handler.Path,{attributes:null,finalize:function(a){this.mouseDown=this.drawing=!1;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone(),this.attributes]);!a&&this.persist||this.destroyFeature()},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy))return!1;null==this.lastDown?(this.persist&&this.destroyFeature(),this.createFeature(a.xy)):null!=this.lastUp&&this.lastUp.equals(a.xy)||this.addPoint(a.xy);this.mouseDown=!0;
this.lastDown=a.xy;this.drawing=!0;this.callback("mousedown",[this.point.geometry,this.getGeometry()]);return"2"==a.button?(this.rightclick(a),!0):!1},rightclick:function(a){this.dblclick(a);return!1},mouseup:function(a){this.mouseDown=!1;if(this.drawing)return this.freehandMode(a)?(this.removePoint(),this.finalize()):(null==this.lastUp&&this.addPoint(a.xy),this.lastUp=a.xy),this.callback("mouseup",[this.point.geometry,this.getGeometry()]),!1;this.point&&this.point.geometry&&this.getGeometry()&&this.callback("mouseup",
[this.point.geometry,this.getGeometry()]);return!0},finish:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize();return!1},CLASS_NAME:"GPath"});GPathMeasure=OpenLayers.Class(OpenLayers.Handler.Path,{popup:null,movePopup:!0,partDist:[],measureDistance:function(a){a=a.getLength();var b;b="";b=OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.km*a;1<b?(a=b.toFixed(2),b="km"):(a=a.toFixed(2),b="m");return[a,b]},measureDistancePart:function(){var a=this.geometryClone().getVertices(),a=[new OpenLayers.Geometry.Point(a[a.length-2].x,a[a.length-2].y),new OpenLayers.Geometry.Point(a[a.length-1].x,a[a.length-1].y)],a=new OpenLayers.Geometry.LineString(a);
return this.measureDistance(a)},measureDistanceAll:function(){var a=this.geometryClone();return this.measureDistance(a)},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy))return!1;null==this.lastDown?(this.multiLine||(this.persist&&this.destroyFeature(),this.removePopup()),this.createFeature(a.xy)):null!=this.lastUp&&this.lastUp.equals(a.xy)||this.addPoint(a.xy);this.lastDown=a.xy;this.drawing=!0;this.freehandMode(a)?(this.removePoint(),this.finalize()):(null==this.lastUp&&this.addPoint(a.xy),
this.lastUp=a.xy);var b=this.map.getLonLatFromPixel(a.xy),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));c.type="measure"+GPathMeasureINDEX;c.attributes.featureType="Point";this.layer.addFeatures(c);this.count?(c="<div class='olControlMeasurePopup olControlMeasurePopupDefault'><span class='MeasureColor'>"+this.partDist[0]+"</span> "+this.partDist[1]+"</div>",c=new GPopup("measurePopup",b,null,c,new OpenLayers.Pixel(5,5)),c.attributes={featureType:"Text",fontSize:"12",
fontColor:"#000000",text:this.partDist[0]+this.partDist[1],print:!0},this.count+=1):(c=new GPopup("measurePopup",b,null,"<div id='measureStart' class='olControlMeasurePopup olControlMeasurePopupStart'><span class='MeasureColor'>\uc2dc\uc791</span></div>",new OpenLayers.Pixel(5,5)),c.attributes={featureType:"Text",fontSize:"12",fontColor:"#000000",text:"\uc2dc\uc791",print:!0},this.movePopup&&(this.popup=new GPopup("measurePopup",b,null,'<div class="olControlMeasureContent"><div class="measureDist" ><span class="measureResTit">\uc0c1\ub300\uac70\ub9ac</span><span class="measureResCon"></span><span class="measureResUnit"></span></div><div class="MeasureAllDist" ><span class="measureResTit">\ucd1d\uac70\ub9ac</span><span class="measureResCon"></span><span class="measureResUnit"></span></div><div class="MeasureEndDescript">\ub9c8\uc6b0\uc2a4 \uc624\ub978\ucabd \ubc84\ud2bc\uc744 \ub204\ub974\uc2dc\uba74 \ub05d\ub9c8\uce69\ub2c8\ub2e4</div></div>',
new OpenLayers.Pixel(10,10)),this.map.addPopup(this.popup),this.popup.updateSize(),this.popup.type="measure"+GPathMeasureINDEX),this.count=1);c&&(this.map.addPopup(c),c.type="measure"+GPathMeasureINDEX,c.updateSize());return"2"==a.button?(this.rightclick(a),!0):!1},addPoint:function(a){this.layer.removeFeatures([this.point]);a=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat));this.line.geometry.addComponent(this.point.geometry,
this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.line.type="measure"+GPathMeasureINDEX;this.drawFeature()},mousemove:function(a){if(this.drawing)if(this.mouseDown&&this.freehandMode(a))this.addPoint(a.xy);else if(this.modifyFeature(a.xy),this.popup){var b=this.measureDistancePart(),c=this.measureDistanceAll();$(this.popup.contentDiv).find(".measureDist .measureResCon").text(b[0]);
$(this.popup.contentDiv).find(".measureDist .measureResUnit").text(" "+b[1]);$(this.popup.contentDiv).find(".MeasureAllDist .measureResCon").text(c[0]);$(this.popup.contentDiv).find(".MeasureAllDist .measureResUnit").text(" "+c[1]);this.partDist=this.measureDistancePart();this.popup.updateSize();a.xy.x-=$(this.popup.div).parent().offset().left;a.xy.y-=$(this.popup.div).parent().offset().top;this.popup.moveTo(a.xy)}return!0},rightclick:function(a){this.dblclick(a);return!1},dblclick:function(a){"measure"==
this.map.popups[this.map.popups.length-1].type&&this.map.removePopup(this.map.popups[this.map.popups.length-1]);var b=this.map.getLonLatFromPixel(a.xy),c=this.measureDistanceAll(),b=new GPopup("measurePopup",b,null,"<div class='olControlMeasurePopup olControlMeasurePopupEnd'>\ucd1d\uac70\ub9ac : <span class='MeasureColor'>"+c[0]+"</span> "+c[1]+"</div>",new OpenLayers.Pixel(5,5));b.attributes={featureType:"Text",fontSize:"12",fontColor:"#000000",text:"\ucd1d\uac70\ub9ac : "+c[0]+c[1],print:!0};this.map.addPopup(b);
b.type="measure"+GPathMeasureINDEX;b.updateSize();var d=this.layer.map;$(".olControlMeasureClose").click(function(){for(var a=$(this).find("input").val(),b=d.popups,c=d.layers.length-1;0<=c;c--)if("measure"==d.layers[c].type)for(var h=d.layers[c].features.length-1;0<=h;h--)d.layers[c].features[h].type==a&&d.layers[c].removeFeatures(d.layers[c].features[h]);for(c=b.length-1;0<=c;c--)b[c].type==a&&d.removePopup(b[c])});GPathMeasureINDEX++;this.count=0;this.freehandMode(a)||(this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-
1]),this.removePoint(),this.finalize());this.popup&&(this.map.removePopup(this.popup),this.popup=null);return this.drawing=!1},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new GVector(this.CLASS_NAME,a);this.layer.type="measure";this.map.addLayer(this.layer);return!0},deactivate:function(){if(this.drawing||!OpenLayers.Handler.prototype.deactivate.apply(this,
arguments))return!1;this.drawing&&this.cancel();this.persistControl||(this.layer.destroy(!1),this.removePopup());this.layer=null;return!0},removePopup:function(){for(var a=this.map.popups.length-1;0<=a;a--)"measure"==this.map.popups[a].type&&this.map.removePopup(this.map.popups[a])},CLASS_NAME:"GPathMeasure"});GPathMeasureINDEX=0;GPoint=OpenLayers.Class(OpenLayers.Handler.Point,{attributes:null,finalize:function(a){this.mouseDown=this.drawing=!1;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone(),this.attributes]);!a&&this.persist||this.destroyFeature()},CLASS_NAME:"GPoint"});GPolygon=OpenLayers.Class(OpenLayers.Handler.Polygon,{attributes:null,finalize:function(a){this.mouseDown=this.drawing=!1;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone(),this.attributes]);!a&&this.persist||this.destroyFeature()},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy))return!1;null==this.lastDown?(this.persist&&this.destroyFeature(),this.createFeature(a.xy)):null!=this.lastUp&&this.lastUp.equals(a.xy)||this.addPoint(a.xy);this.mouseDown=
!0;this.lastDown=a.xy;this.drawing=!0;this.callback("mousedown",[this.point.geometry,this.getGeometry()]);return!1},mouseup:function(a){this.mouseDown=!1;if(this.drawing)return this.freehandMode(a)?(this.removePoint(),this.finalize()):(null==this.lastUp&&this.addPoint(a.xy),this.lastUp=a.xy),this.callback("mouseup",[this.point.geometry,this.getGeometry()]),!1;this.callback("mouseup",[this.point.geometry,this.getGeometry()]);return!0},CLASS_NAME:"GPolygon"});GPolygonDraw=OpenLayers.Class(OpenLayers.Handler.Polygon,{attributes:null,finalize:function(a){this.mouseDown=this.drawing=!1;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone(),this.attributes]);this.destroyFeature(a)},CLASS_NAME:"GPolygonDraw"});GPolygonMeasure=OpenLayers.Class(OpenLayers.Handler.Polygon,{popup:null,measureArea:function(){var a=this.geometryClone().getArea(),b;b=a*Math.pow(OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.km,2);return a=1<b?b.toFixed(2)+"\u33a2":a.toFixed(2)+"\u33a1"},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy))return!1;null==this.lastDown?(this.multiLine||(this.persist&&this.destroyFeature(),this.removePopup()),this.createFeature(a.xy)):null!=this.lastUp&&this.lastUp.equals(a.xy)||
this.addPoint(a.xy);this.lastDown=a.xy;this.drawing=!0;this.freehandMode(a)?(this.removePoint(),this.finalize()):(null==this.lastUp&&this.addPoint(a.xy),this.lastUp=a.xy);var b=this.map.getLonLatFromPixel(a.xy),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));c.attributes.featureType="Point";this.layer.addFeatures(c);var d;this.count?(1<this.count&&(c="<div class='olControlMeasurePopup olControlMeasurePopupDefaultPoly'><span class='MeasureColor'>"+this.measureArea()+"</span></div>",
d=new GPopup("measurePopup",b,null,c,new OpenLayers.Pixel(5,5)),d.attributes={featureType:"Text",text:this.measureArea(),print:!0}),this.count+=1):(d=new GPopup("measurePopup",b,null,"<div id='measureStart' class='olControlMeasurePopup olControlMeasurePopupStart'><span class='MeasureColor'>\uc2dc\uc791</span></div>",new OpenLayers.Pixel(5,5)),d.attributes={featureType:"Text",text:"\uc2dc\uc791",print:!0},c="<div class='olControlMeasurePopup olControlMeasurePopupMovePoly'>\ucd1d\uba74\uc801 : <span class='MeasureColor'>"+
this.measureArea()+"</span></div>",this.popup=new GPopup("measurePopup",b,null,c,new OpenLayers.Pixel(5,5)),b="\ucd1d\uba74\uc801 : "+this.measureArea(),this.popup.attributes={featureType:"Text",text:b,print:!0},this.map.addPopup(this.popup),this.popup.updateSize(),this.popup.type="measure",this.count=1);d&&(this.map.addPopup(d),d.type="measure",d.updateSize());return"2"==a.button?(this.rightclick(a),!0):!1},mousemove:function(a){if(this.drawing)if(this.mouseDown&&this.freehandMode(a))this.addPoint(a.xy);
else if(this.modifyFeature(a.xy),this.popup){var b="<div class='olControlMeasurePopup olControlMeasurePopupMovePoly' >\ucd1d\uba74\uc801 : <span class='MeasureColor'>"+this.measureArea()+"</span></div>";this.popup.setContentHTML(b);this.popup.updateSize();this.popup.moveTo(a.xy)}return!0},rightclick:function(a){this.dblclick(a);return!1},dblclick:function(a){if(3>this.count)return alert("\uba74\uc801\uc740 3\uac1c \uc774\uc0c1\uc758 \uc9c0\uc810\uc744 \uc120\ud0dd\ud574\uc57c \ud569\ub2c8\ub2e4."),
!1;"measure"==this.map.popups[this.map.popups.length-1].type&&this.map.removePopup(this.map.popups[this.map.popups.length-1]);var b=this.map.getLonLatFromPixel(a.xy),c="<div class='olControlMeasurePopup olControlMeasurePopupMovePoly' >\ucd1d\uba74\uc801 : <span class='MeasureColor'>"+this.measureArea()+"</span></div>",b=new GPopup("measurePopup",b,null,c,new OpenLayers.Pixel(5,5)),c="\ucd1d\uba74\uc801 : "+this.measureArea();b.attributes={featureType:"Text",text:c,print:!0};this.map.addPopup(b);b.type=
"measure";b.updateSize();this.count=0;this.freehandMode(a)||(this.removePoint(),this.finalize());this.popup&&(this.map.removePopup(this.popup),this.popup=null);return this.drawing=!1},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.drawing&&this.cancel();this.persistControl||(this.layer.destroy(!1),this.removePopup());this.layer.prevLayer=!0;this.layer=null;return!0},removePopup:function(){for(var a=this.map.popups.length-1;0<=a;a--)"measure"==
this.map.popups[a].type&&this.map.removePopup(this.map.popups[a])},CLASS_NAME:"GPolygonMeasure"});GRegularPolygonDraw=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{attributes:null,callback:function(a,b){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone(),this.attributes]);this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"GRegularPolygonDraw"});GRegularPolygonDrawAttr=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{attributes:null,dragStartX:0,dragStartY:0,down:function(a){this.fixedRadius=!!this.radius;var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular)this.radius=this.map.getResolution();this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],
{silent:!0});this.layer.drawFeature(this.feature,this.style);a=this.map.getLonLatFromPixel(a.xy);this.dragStartX=a.lon;this.dragStartY=a.lat;this.popup=new GPopup("measurePopup",a,null,"<div class='olControlMeasurePopup olControlCircleAttr'><span class='MeasureColor'>0.0m</span></div>",new OpenLayers.Pixel(5,5));this.removePrevPopup();this.map.addPopup(this.popup);this.popup.updateSize();this.popup.type="attrCircle"},removePrevPopup:function(){for(var a in this.map.popups)"measurePopup"==this.map.popups[a].id&&
this.map.removePopup(this.map.popups[a])},deactivate:function(){this.removePrevPopup();var a=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,a=!0);return a},move:function(a){var b=this.map.getLonLatFromPixel(a.xy),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.irregular?(b=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/
2,b)):this.fixedRadius?this.origin=c:(this.calculateAngle(c,a),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular){var b=c.x-this.origin.x,c=c.y-this.origin.y,d;d=0==c?b/(this.radius*Math.sqrt(2)):b/c;this.feature.geometry.resize(1,this.origin,d);this.feature.geometry.move(b/2,c/2)}this.layer.drawFeature(this.feature,this.style);this.popup&&(c=this.map.getLonLatFromPixel(a.xy),b=Math.abs(c.lon),c=Math.abs(c.lat),this.radiusDist=GUtil.fn_fmt_fix(Math.sqrt(Math.pow(b-
this.dragStartX,2)+Math.pow(c-this.dragStartY,2)),1),contentHtml="<div class='olControlMeasurePopup olControlCircleAttr'><span class='MeasureColor'>"+this.measureDistance(this.radiusDist)+"</span></div>",this.popup.setContentHTML(contentHtml),this.popup.updateSize(),this.popup.moveTo(a.xy))},measureDistance:function(a){var b;b=OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.km*a;return a=1<b?b.toFixed(2)+"km":a.toFixed(2)+"m"},up:function(a){this.finalize();this.start==this.last&&this.callback("done",
[a.xy])},callback:function(a,b){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone(),this.attributes]);this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"GRegularPolygonDrawAttr"});GTextDraw=OpenLayers.Class(OpenLayers.Handler.Point,{attributes:null,mousedown:function(a){if(!this.checkModifiers(a)||this.lastDown&&this.lastDown.equals(a.xy))return!0;this.drawing=!0;null==this.lastDown?(this.persist&&this.destroyFeature(),this.createFeature(a.xy)):this.modifyFeature(a.xy);this.lastDown=a.xy;return!1},mousedown:function(a){drawObject.closeTextAddPopup();a=this.map.getLonLatFromPixel(a.xy);drawObject.textAddFeature=new OpenLayers.Feature.Vector(this.geometryClone(),{featureType:"labelPoint"});
drawObject.layer.addFeatures(drawObject.textAddFeature);var b=new OpenLayers.Size(376,75),c;c="<div style='width:360px;border:1px solid #768349;position:relative;padding:7px;background:#ffffff;z-index:99997'><label for='keyword' class='blind'>\uae00\uc528\uc785\ub825</label><textarea name='keyword' id='keyword' style='width:310px;height:50px'></textarea><a href='#' style='position:absolute;bottom:8px;right:7px;'><img src='/gg_pb/images/btn/btn_ly_confirm.gif' alt='\ud655\uc778' class='vam' onclick='drawObject.addTextPopup()' /></a>";
c+="<p style='position:absolute;top:11px;right:7px;'><a href='#' onclick='drawObject.closeTextAddPopup();'><img src='/gg_pb/images/btn/btn_close2.gif' alt='\ub2eb\uae30'  /></a></p></div>";drawObject.textAddPopup=new OpenLayers.Popup.AnchoredBubbleCustom("text",a,b,c);drawObject.textAddPopup.setBackgroundColor("");map.addPopup(drawObject.textAddPopup);return!1},finalize:function(a){this.mouseDown=this.drawing=!1;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone(),
this.attributes]);!a&&this.persist||this.destroyFeature()},CLASS_NAME:"GTextDraw"});GTileCache=OpenLayers.Class(OpenLayers.Layer.TileCache,{version:null,transitionEffect:"resize",buffer:0,initialize:function(a,b,c,d){GError.debug&&this.chkParams(a,b,c,d);this.layername=c;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]);this.extension=this.format.split("/")[1].toLowerCase()},getURL:function(a){function b(a,b){a=String(a);for(var c=[],d=0;d<b;++d)c.push("0");return c.join("").substring(0,b-a.length)+a}var c=this.map.getResolution(),d=a.bottom;a=a.left;c=null!=this.serverResolutions?
OpenLayers.Util.indexOf(this.serverResolutions,c):this.map.getZoom();d=[this.layername,b(c,2),b(parseInt(d/1E6),3),b(parseInt(d/1E3)%1E3,3),b(parseInt(d)%1E3,3),b(parseInt(a/1E6),3),b(parseInt(a/1E3)%1E3,3),b(parseInt(a)%1E3,3)+"."+this.extension].join("/");this.version&&(d+="?v="+this.version);c=this.url;c instanceof Array&&(c=this.selectUrl(d,c));c="/"==c.charAt(c.length-1)?c:c+"/";return c+d},chkParams:function(a,b,c,d){a||GError.create_obj(this,"Layer Name(\ub808\uc774\uc5b4 \uba85)");b||GError.create_obj(this,
"Url (\uc11c\ube44\uc2a4 \uc8fc\uc18c)");c||GError.create_obj(this,"TileCache Layer Name (\ud0c0\uc77c \uc11c\ube44\uc2a4 \uc774\ub984)")},CLASS_NAME:"GTileCache"});GVector=OpenLayers.Class(OpenLayers.Layer.Vector,{redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();b&&this.inRange&&this.visibility&&(this.moveTo(b,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),a=!0)}if(this.map.paddingForPopups)for(var c in this.map.popups)(b=this.map.popups[c])&&b.attributes&&b.attributes.featureType&&"Text"==b.attributes.featureType&&"draw"==b.type&&(b.attributes["font-family"]&&$("#"+b.id).css("font-family",b.attributes["font-family"]),
b.attributes["font-size"]&&$("#"+b.id).css("font-size",b.attributes["font-size"]),b.attributes.color&&$("#"+b.id).css("color",b.attributes.color)),b.updateSize();return a},parseStyle:function(a,b){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))}return b},addPoint:function(a,b,c){a=new OpenLayers.Geometry.Point(a,b);c=new OpenLayers.Feature.Vector(a,c);this.addFeatures(c);return c},getGML:function(){return(new OpenLayers.Format.GML).write(this.features)},
setGML:function(a){(a=(new OpenLayers.Format.GML).read(a))&&a.length&&this.addFeatures(a)},CLASS_NAME:"GVector"});GWMS=OpenLayers.Class(OpenLayers.Layer.WMS,{DEFAULT_PARAMS:{service:"WMS",version:"1.3.0",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg",crs:"SR_ORG:6640",transparent:!0},singleTile:!0,ratio:1,buffer:0,transitionEffect:"resize",initialize:function(a,b,c,d){GError.debug&&this.chkParams(a,b,c,d);var e=[];c=OpenLayers.Util.upperCaseObject(c);1.3<=parseFloat(c.VERSION)&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE");e.push(a,b,c,d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,
e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));""==this.params.STYLES&&(this.params.STYLES=this.params.LAYERS)},getParam:function(a){if(a){for(var b in this.params)if(b.toUpperCase()==a.toUpperCase())return this.params[b];
return!1}},getParams:function(){return this.params},chkParams:function(a,b,c,d){a?b?c&&c.layers||GError.create_obj(this,"Parameter layers (\uc694\uccad \ub808\uc774\uc5b4 \uba85 \ub9ac\uc2a4\ud2b8)"):GError.create_obj(this,"Url (\uc11c\ube44\uc2a4 \uc8fc\uc18c)"):GError.create_obj(this,"Layer Name(\ub808\uc774\uc5b4 \uba85)")},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d);c.WIDTH=b.w;c.HEIGHT=
b.h;this.projection.equals(this.map.getProjectionObject())||(d=new OpenLayers.Geometry.Point(a.left,a.bottom),b=OpenLayers.Projection.transform(d,this.map.projection,this.projection),d=new OpenLayers.Geometry.Point(a.right,a.top),a=OpenLayers.Projection.transform(d,this.map.projection,this.projection),c.BBOX=[b.x,b.y,a.x,a.y]);return this.getFullRequestString(c)},CLASS_NAME:"GWMS"});GWMSPost=OpenLayers.Class(OpenLayers.Layer.WMS,{tileClass:null,unsupportedBrowsers:["mozilla","firefox","opera"],SUPPORTED_TRANSITIONS:[],initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c);1.3<=parseFloat(c.VERSION)&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE");e.push(a,b,c,d);OpenLayers.Layer.WMS.prototype.initialize.apply(this,e);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&
(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"));""==this.params.STYLES&&(this.params.STYLES=this.params.LAYERS);this.tileClass=-1!=OpenLayers.Util.indexOf(this.unsupportedBrowsers,OpenLayers.Util.getBrowserName())?OpenLayers.Tile.Image:OpenLayers.Tile.Image.IFrame},addTile:function(a,b){return new this.tileClass(this,b,a,null,this.tileSize)},getParam:function(a){if(a){for(var b in this.params)if(b.toUpperCase()==
a.toUpperCase())return this.params[b];return!1}},getParams:function(){return this.params},chkParams:function(a,b,c,d){a?b?c&&c.layers||GError.create_obj(this,"Parameter layers (\uc694\uccad \ub808\uc774\uc5b4 \uba85 \ub9ac\uc2a4\ud2b8)"):GError.create_obj(this,"Url (\uc11c\ube44\uc2a4 \uc8fc\uc18c)"):GError.create_obj(this,"Layer Name(\ub808\uc774\uc5b4 \uba85)")},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,
d):a.toArray(d);c.WIDTH=b.w;c.HEIGHT=b.h;this.projection.equals(this.map.getProjectionObject())||(d=new OpenLayers.Geometry.Point(a.left,a.bottom),b=OpenLayers.Projection.transform(d,this.map.projection,this.projection),d=new OpenLayers.Geometry.Point(a.right,a.top),a=OpenLayers.Projection.transform(d,this.map.projection,this.projection),c.BBOX=[b.x,b.y,a.x,a.y]);return this.getFullRequestString(c)},CLASS_NAME:"GWMSPost"});GPopup=OpenLayers.Class(OpenLayers.Popup,{offsetPixel:null,initialize:function(a,b,c,d,e){e&&(this.offsetPixel=e);null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=a;this.lonlat=b;this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=d&&(this.contentHTML=d);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,
null,null,"hidden");this.div.className=this.displayClass;this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);this.registerEvents();this.events.register("mousedown",this,this.mouseDown);this.events.register("mouseup",
this,this.mouseUp);this.events.register("mousemove",this,this.mouseMove);this.docMouseUpProxy=OpenLayers.Function.bind(this.mouseUp,this)},getLonLat:function(){return this.lonlat},moveTo:function(a){null!=a&&null!=this.div&&(this.offsetPixel&&(a=a.add(this.offsetPixel.x,this.offsetPixel.y)),this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},down:!1,popPnt:null,mapPnt:null,popup:null,docMouseUpProxy:null,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,[a]);this.map.events.register("mousemove",
this,this.mouseMove)},mouseDown:function(a){this.down=!0;this.popPnt=this.events.getMousePosition(a);OpenLayers.Event.observe(document,"mouseup",this.docMouseUpProxy);OpenLayers.Event.stop(a)},mouseUp:function(a){this.down=!1;OpenLayers.Event.stopObserving(document,"mouseup",this.docMouseUpProxy);OpenLayers.Event.stop(a)},mouseOut:function(a){this.down=!1;OpenLayers.Event.stop(a)},mouseMove:function(a){if(this.down){var b=this.map.events.getMousePosition(a),b=b.add(-1*this.popPnt.x,-1*this.popPnt.y);
this.lonlat=this.map.getLonLatFromViewPortPx(b);this.updatePosition()}OpenLayers.Event.stop(a)},destroy:function(){this.events.unregister("mousedown",this,this.mouseDown);this.events.unregister("mouseup",this,this.mouseUp);this.events.unregister("mousemove",this,this.mouseMove);this.map.events.unregister("mousemove",this,this.mouseMove);this.popPnt=null;OpenLayers.Control.prototype.destroy.apply(this,[])},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:"GPopup"});OpenLayers.Tile.Image.IFrame=OpenLayers.Class(OpenLayers.Tile.Image,{initialize:function(a,b,c,d,e){OpenLayers.Tile.Image.prototype.initialize.apply(this,arguments);this.layerAlphaHack=!1},destroy:function(){null!=this.imgDiv&&this.imgDiv.firstChild&&OpenLayers.Event.stopObservingElement(this.imgDiv.firstChild);OpenLayers.Tile.Image.prototype.destroy.apply(this,arguments)},clear:function(){this.imgDiv&&this.imgDiv.firstChild&&OpenLayers.Event.stopObservingElement(this.imgDiv.firstChild)},clone:function(a){null==
a&&(a=new OpenLayers.Tile.Image.IFrame(this.layer,this.position,this.bounds,this.url,this.size));return a=OpenLayers.Tile.Image.prototype.clone.apply(this,[a])},renderTile:function(){if(OpenLayers.Tile.Image.prototype.renderTile.apply(this,arguments)){var a=this.createRequestForm();this.imgDiv.appendChild(a);a.submit();this.imgDiv.removeChild(a)}},initImgDiv:function(){this.imgDiv=this.createImgDiv();OpenLayers.Util.modifyDOMElement(this.imgDiv,this.id,null,this.layer.getImageSize(),"relative");this.imgDiv.className=
"olTileImage";this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);null!=this.layer.opacity&&OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity);this.imgDiv.map=this.layer.map},createImgDiv:function(){var a=document.createElement("div");"msie"==OpenLayers.Util.getBrowserName()&&(a.style.backgroundColor="#FFFFFF",a.style.filter="chroma(color=#FFFFFF)");OpenLayers.Util.modifyDOMElement(a,null,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),
"absolute");var b=document.createElement("div");b.appendChild(a);return b},createIFrame:function(){var a=this.id+"_iFrame",b;"msie"==OpenLayers.Util.getBrowserName()&&0>navigator.userAgent.toLowerCase().indexOf("9.0")?(b=document.createElement('<iframe name="'+a+'">'),b.allowTransparency="true"):(b=document.createElement("iframe"),b.style.backgroundColor="transparent",b.name=a);b.id=a;b.scrolling="no";b.marginWidth="0px";b.marginHeight="0px";b.frameBorder="0";OpenLayers.Util.modifyDOMElement(b,a,
new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");OpenLayers.Event.observe(b,"load",OpenLayers.Function.bind(function(){for(var a=this.imgDiv.getElementsByTagName("iframe"),b=a.length-1;0<b;b--)this.imgDiv.removeChild(a[b]);this.layer.map.zoomChanged||this.positionImage();this.show();this.isLoading&&(this.isLoading=!1,this.layer.events.unregister("loadend",this,this.resetBackBuffer),this.events.triggerEvent("loadend"))},this));return b},createRequestForm:function(){var a=document.createElement("form");
a.method="POST";var b=this.layer.params._OLSALT,b=(b?b+"_":"")+this.bounds.toBBOX();a.action=OpenLayers.Util.urlAppend(this.layer.url,b);this.imgDiv.insertBefore(this.createIFrame(),this.imgDiv.firstChild);a.target=this.id+"_iFrame";var b=this.layer.getImageSize(),b=OpenLayers.Util.extend({BBOX:this.encodeBBOX?this.bounds.toBBOX():this.bounds.toArray(),WIDTH:b.w,HEIGHT:b.h},this.layer.params),c;for(c in b){var d=document.createElement("input");d.type="hidden";d.name=c;d.value=b[c];a.appendChild(d)}return a},
CLASS_NAME:"OpenLayers.Tile.Image.IFrame"});GDrawTool=OpenLayers.Class({map:null,layer:null,controls:null,defaultStyle:{Point:{featureType:"Point",pointRadius:6,graphicName:"circle",fillColor:"#ffffff",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333",oriStrokeColor:"#333333",oriFillColor:"#ffffff"},Line:{featureType:"Line",strokeColor:"#000000",strokeWidth:2,strokeOpacity:1,strokeDashstyle:"solid",strokeLinecap:"butt",oriStrokeColor:"#000000"},Polygon:{featureType:"Polygon",fillColor:"#ffffff",fillOpacity:0,strokeColor:"#000000",
strokeWidth:2,strokeOpacity:1,strokeDashstyle:"solid",oriStrokeColor:"#000000",oriFillColor:"#ffffff"},Image:{featureType:"Image",graphicOpacity:1,externalGraphic:"/images/GMap/DrawText/symbol.png",graphicWidth:32,graphicHeight:32},Text:{featureType:"Text",pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333",oriStrokeColor:"#333333"}},initialize:function(a,b){this.map=a;this.layer=new GVector("GDrawToolLayer",{styleMap:this.getStyleMap()});
this.layer.events.on({featureselected:function(a){a.feature.attributes.oriStrokeColor=a.feature.attributes.strokeColor;a.feature.attributes.oriFillColor=a.feature.attributes.fillColor;a.feature.attributes.strokeColor="#0000ff";a.feature.attributes.fillColor="#DFE4F5";this.redraw()},featureunselected:function(a){"#0000ff"==a.feature.attributes.strokeColor&&(a.feature.attributes.strokeColor=a.feature.attributes.oriStrokeColor);"#DFE4F5"==a.feature.attributes.fillColor&&(a.feature.attributes.fillColor=
a.feature.attributes.oriFillColor);this.redraw()}});OpenLayers.Util.extend(this,b);a.addLayer(this.layer);this.controls=[new GSelectFeature(this.layer,{id:"drawSelect"}),new GSelectFeature(this.layer,{id:"drawMultiSelect",toggleKey:"ctrlKey",multipleKey:"shiftKey",box:!0}),new GModifyFeature(this.layer,{id:"drawEdit",mode:OpenLayers.Control.ModifyFeature.DRAG|OpenLayers.Control.ModifyFeature.RESIZE|OpenLayers.Control.ModifyFeature.ROTATE}),new GModifyFeature(this.layer,{id:"drawEditPoint",mode:OpenLayers.Control.ModifyFeature.RESHAPE}),
new GDrawFeature(this.layer,GPoint,{id:"drawPoint",handlerOptions:{attributes:this.defaultStyle.Point}}),new GDrawFeature(this.layer,GPoint,{id:"drawSymbol",handlerOptions:{attributes:this.defaultStyle.Image}}),new GDrawFeature(this.layer,GPath,{id:"drawLine",handlerOptions:{attributes:this.defaultStyle.Line}}),new GDrawFeature(this.layer,GRegularPolygonDraw,{id:"drawRect",handlerOptions:{irregular:!0,attributes:this.defaultStyle.Polygon}}),new GDrawFeature(this.layer,GRegularPolygonDraw,{id:"drawCircle",
handlerOptions:{sides:100,irregular:!0,attributes:this.defaultStyle.Polygon}}),new GDrawFeature(this.layer,GRegularPolygonDraw,{id:"drawEllipse",handlerOptions:{sides:100,attributes:this.defaultStyle.Polygon}}),new GDrawFeature(this.layer,GPolygonDraw,{id:"drawPolygon",handlerOptions:{attributes:this.defaultStyle.Polygon}}),new GDrawFeature(this.layer,GPoint,{id:"drawText",handlerOptions:{attributes:this.defaultStyle.Text}})];a.addControls(this.controls);b&&(b.onFeatureAdded&&this.layer.events.register("featureadded",
this,b.onFeatureAdded),b.onModificationStart&&(a.getControl("drawEdit").onModificationStart=b.onModificationStart,a.getControl("drawEditPoint").onModificationStart=b.onModificationStart),b.onDeactivate&&(a.getControl("drawEdit").onDeactivate=b.onDeactivate,a.getControl("drawEditPoint").onDeactivate=b.onDeactivate),b.onUnselectAll&&(a.getControl("drawEdit").onUnselectAll=b.onUnselectAll,a.getControl("drawEditPoint").onUnselectAll=b.onUnselectAll),b.onSelect&&(a.getControl("drawSelect").onSelect=b.onSelect,
a.getControl("drawMultiSelect").onSelect=b.onSelect))},selectedFeatureId:function(){var a=this.layer.features,b=-1,c;for(c in a)"string"==typeof a[c]._lastHighlighter&&(b=c);return 1*b},maxFeatureId:function(){var a=this.layer.features,b=0,c;for(c in a)a[c]._sketch||b++;return b-1},upFeature:function(){var a=this.selectedFeatureId(),b=this.maxFeatureId(),c=this.layer.features;a<b&&GUtil.Array.fn_swap_element(c,a,a+1);this.redrawFeature(c)},downFeature:function(){var a=this.selectedFeatureId(),b=this.layer.features;
0<a&&GUtil.Array.fn_swap_element(b,a,a-1);this.redrawFeature(b)},topFeature:function(){var a=this.selectedFeatureId(),b=this.maxFeatureId(),c=this.layer.features;if(a<b)for(;a<b;a++)GUtil.Array.fn_swap_element(c,a,a+1);this.redrawFeature(c)},bottomFeature:function(){var a=this.selectedFeatureId(),b=this.layer.features;if(0<a)for(;0<a;a--)GUtil.Array.fn_swap_element(b,a,a-1);this.redrawFeature(b)},redrawFeature:function(a){this.layer.eraseFeatures(a);for(var b=0,c=a.length;b<c;b++)this.layer.drawFeature(a[b])},
getStyleMap:function(){var a=new OpenLayers.Style(null);a.addRules([new OpenLayers.Rule({symbolizer:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3}}),
new OpenLayers.Rule({symbolizer:{pointRadius:"${pointRadius}",graphicName:"${graphicName}",fillColor:"${fillColor}",fillOpacity:"${fillOpacity}",strokeWidth:"${strokeWidth}",strokeOpacity:"${strokeOpacity}",strokeColor:"${strokeColor}"},filter:new OpenLayers.Filter.Comparison({type:"==",property:"featureType",value:"Point"})}),new OpenLayers.Rule({symbolizer:{strokeColor:"${strokeColor}",strokeWidth:"${strokeWidth}",strokeOpacity:"${strokeOpacity}",strokeDashstyle:"${strokeDashstyle}",strokeLinecap:"${strokeLinecap}"},
filter:new OpenLayers.Filter.Comparison({type:"==",property:"featureType",value:"Line"})}),new OpenLayers.Rule({symbolizer:{fillColor:"${fillColor}",fillOpacity:"${fillOpacity}",strokeColor:"${strokeColor}",strokeWidth:"${strokeWidth}",strokeOpacity:"${strokeOpacity}",strokeDashstyle:"${strokeDashstyle}"},filter:new OpenLayers.Filter.Comparison({type:"==",property:"featureType",value:"Polygon"})}),new OpenLayers.Rule({symbolizer:{pointRadius:"${pointRadius}",graphicName:"${graphicName}",fillColor:"${fillColor}",
fillOpacity:"${fillOpacity}",strokeWidth:"${strokeWidth}",strokeOpacity:"${strokeOpacity}",strokeColor:"${strokeColor}"},filter:new OpenLayers.Filter.Comparison({type:"==",property:"featureType",value:"Text"})}),new OpenLayers.Rule({symbolizer:{graphicOpacity:"${graphicOpacity}",externalGraphic:"${externalGraphic}",graphicWidth:"${graphicWidth}",graphicHeight:"${graphicHeight}"},filter:new OpenLayers.Filter.Comparison({type:"==",property:"featureType",value:"Image"})})]);return new OpenLayers.StyleMap({"default":a,
select:a})},deleteFeature:function(){this.removeTextPopup();var a=[];if(0<this.layer.selectedFeatures.length)for(var b in this.layer.selectedFeatures)a.push(this.layer.selectedFeatures[b]);for(b in this.map.controls)this.map.getControl("drawSelect")&&this.map.getControl("drawSelect").active?this.map.activeControls("drawSelect"):this.map.getControl("drawEdit")&&this.map.getControl("drawEdit").active?this.map.activeControls("drawEdit"):this.map.getControl("drawEditPoint")&&this.map.getControl("drawEditPoint").active&&
this.map.activeControls("drawEditPoint");0<a.length&&this.layer.removeFeatures(a)},removeTextPopup:function(){var a="";$(".olControlDrawText").each(function(){$(this).hasClass("on")&&(a=$(this).parent().parent().parent().attr("id"))});for(var b=this.map.popups.length-1;0<=b;b--)this.map.popups[b].id==a&&this.map.removePopup(this.map.popups[b])},getSelectFeature:function(){var a="";if(this.map.getLayerByName("GDrawToolLayer")&&this.map.getLayerByName("GDrawToolLayer").selectedFeatures&&0<this.map.getLayerByName("GDrawToolLayer").selectedFeatures.length)return this.map.getLayerByName("GDrawToolLayer").selectedFeatures[0];
$(".olControlDrawText").each(function(){$(this).hasClass("on")&&(a=$(this).attr("id"))});for(var b in this.map.popups)if(this.map.popups[b].attributes.seq==a.replace("drawText",""))return this.map.popups[b];return!1},setTextAttr:function(a){var b=a.attributes.seq;$("#drawText"+b).css("font-family",a.attributes.fontFamily);$("#drawText"+b).css("font-size",a.attributes.fontSize);$("#drawText"+b).css("color",a.attributes.fontColor);a.updateSize()},addTextPopup:function(a){var b=a.attributes.seq,c=a.attributes.text,
c=c.replace(/\x20/gi,"&nbsp;"),c=c.replace(/\x0D\x0A/gi,"<br/>"),c=c.replace(/\x0D/gi,"<br/>"),c=c.replace(/\n/gi,"<br/>"),c=""+("<div class='olControlDrawText off' id='drawText"+b+"'>"+c+"</div>"),b=new GPopup("drawPopup"+b,a.getLonLat(),null,c,new OpenLayers.Pixel(0,0));this.map.addPopup(b);b.type="draw";b.attributes=a.attributes;this.setTextAttr(b)},removeAllFeatures:function(){this.layer.removeAllFeatures();for(var a=this.map.popups.length-1;0<=a;a--)"draw"==this.map.popups[a].type&&this.map.removePopup(this.map.popups[a])},
redraw:function(){gMap.getLayerByName("GDrawToolLayer").redraw()},setOnModificationStart:function(a){this.map.getControl("drawEdit").onModificationStart=a;this.map.getControl("drawEditPoint").onModificationStart=a},setOnSelect:function(a){this.map.getControl("drawSelect").onSelect=a;this.map.getControl("drawMultiSelect").onSelect=a},getSelectAttributes:function(){var a=null;this.map.getLayerByName("GDrawToolLayer")&&this.map.getLayerByName("GDrawToolLayer").selectedFeatures&&0<this.map.getLayerByName("GDrawToolLayer").selectedFeatures.length&&
(a=this.map.getLayerByName("GDrawToolLayer").selectedFeatures);return a},CLASS_NAME:"GDrawTool"});GLegendTool=OpenLayers.Class({map:null,layers:null,callback:null,sld:{},allList:!0,initialize:function(a,b,c,d){this.map=a;this.layer=b?this.map.getLayerByName(b):this.map.baseLayer;a=[];a=c?c:this.layer.params.LAYERS;this.callback=d;var e=this;GRequest.WMS.getStyles(this.layer.url,a+",",function(a){e.sld=a;e.parseStyle()});this.map.events.register("zoomend",this,function(){this.parseStyle()})},parseStyle:function(){var a=[],b={};if(!this.allList)for(var c=this.layer.params.LAYERS.split(","),d=0,
e=c.length;d<e;d++)b[c[d]]=!0;c=this.sld.data.namedLayers;for(d in c){var e=c[d].userStyle,f;for(f in e){var g=e[f].rules,h;for(h in g)if(!g[h].symbolizer.text){if(!this.allList){var k=parseInt(this.map.getScale()),l=g[h].maxScale;0==l&&(l=parseInt(OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(0),this.map.units)))}if(b[c[d].name]&&l>=k&&k>=g[h].minScale||this.allList)g[h].symbolizer.text||a.push({layer:c[d].name,style:e[f].name,rule:g[h].name,type:g[h].symbolizer,count:0})}}}this.callback(a)},
showFullList:function(){this.allList=!0;this.parseStyle()},showCurrentList:function(){this.allList=!1;this.parseStyle()},CLASS_NAME:"GLegendTool"});GSaveTool=OpenLayers.Class({map:null,xml:null,style:null,initialize:function(a){this.map=a},getXML:function(){this.xml="<LAYERS>";this.parseMap();this.parseLayer();this.parseVector();this.parsePopup();return this.xml+="</LAYERS>"},parseMap:function(){this.xml+="<MAP>";var a={left:this.map.getExtent().left,bottom:this.map.getExtent().bottom,right:this.map.getExtent().right,top:this.map.getExtent().top,width:this.map.getSize().w,height:this.map.getSize().h,resolution:this.map.getResolution()};this.write(a);
this.xml+="</MAP>"},parseLayer:function(){for(var a=0;a<this.map.layers.length;a++)if(("GWMS"==this.map.layers[a].CLASS_NAME||"GWMSPost"==this.map.layers[a].CLASS_NAME)&&this.map.layers[a].visibility){this.xml+='<LAYER type="wms">';var b={url:this.map.layers[a].url,layers:this.map.layers[a].params.LAYERS,styles:this.map.layers[a].params.STYLES,format:this.map.layers[a].params.FORMAT,version:this.map.layers[a].params.VERSION,crs:this.map.layers[a].params.CRS,service:this.map.layers[a].params.SERVICE,
request:this.map.layers[a].params.REQUEST,exceptions:this.map.layers[a].params.EXCEPTIONS};this.map.layers[a].params.SLD_BODY&&(b.sldbody=this.map.layers[a].params.SLD_BODY);this.write(b);this.xml+="</LAYER>"}else if("GTileCache"==this.map.layers[a].CLASS_NAME&&this.map.layers[a].visibility)this.xml+='<LAYER type="tilecache">',b={url:this.map.layers[a].url,layername:this.map.layers[a].layername,scaleLevel:this.map.getZoom()+2,maxLeft:this.map.layers[a].maxExtent.left,maxBottom:this.map.layers[a].maxExtent.bottom,
maxRight:this.map.layers[a].maxExtent.right,maxTop:this.map.layers[a].maxExtent.top,extension:"."+this.map.layers[a].format.split("/")[1].toLowerCase()},this.write(b),this.xml+="</LAYER>";else if("OpenLayers.Layer.ArcGISCache"==this.map.layers[a].CLASS_NAME&&this.map.layers[a].visibility){this.xml+='<LAYER type="ArcGISCache">';var c=this.map.layers[a].getResolution(),b=this.map.layers[a].getUpperLeftTileCoord(c),c=this.map.layers[a].getLowerRightTileCoord(c),b={url:this.map.layers[a].url,tileOriginLon:this.map.layers[a].tileOrigin.lon,
tileOriginLat:this.map.layers[a].tileOrigin.lat,minRows:c.y-b.y+1,minCols:c.x-b.x+1,centerX:this.map.getExtent().getCenterLonLat().lon,centerY:this.map.getExtent().getCenterLonLat().lat,scaleLevel:this.map.getZoom(),maxLeft:this.map.layers[a].maxExtent.left,maxBottom:this.map.layers[a].maxExtent.bottom,maxRight:this.map.layers[a].maxExtent.right,maxTop:this.map.layers[a].maxExtent.top};this.write(b);this.xml+="</LAYER>"}},parseVector:function(){for(var a=0;a<this.map.layers.length;a++)if("OpenLayers.Layer.Vector"==
this.map.layers[a].CLASS_NAME||"GVector"==this.map.layers[a].CLASS_NAME&&this.map.layers[a].visibility){this.xml+="<VECTORLAYER>";for(var b=0;b<this.map.layers[a].features.length;b++)if("OpenLayers.Geometry.Point"==this.map.layers[a].features[b].geometry.CLASS_NAME||"GPoint"==this.map.layers[a].features[b].geometry.CLASS_NAME){if(this.map.layers[a].features[b].attributes.featureType){var c,d=this.parseStyle(this.map.layers[a],this.map.layers[a].features[b]);"Image"==this.map.layers[a].features[b].attributes.featureType?
c={x:this.map.layers[a].features[b].geometry.x,y:this.map.layers[a].features[b].geometry.y,featureType:this.map.layers[a].features[b].attributes.featureType,opacity:d.graphicOpacity,width:d.graphicWidth,height:d.graphicHeight,image:d.externalGraphic}:"Point"==this.map.layers[a].features[b].attributes.featureType&&("circle"!=d.graphicName&&"square"!=d.graphicName&&"circle"==d.graphicName,c={x:this.map.layers[a].features[b].geometry.x,y:this.map.layers[a].features[b].geometry.y,featureType:this.map.layers[a].features[b].attributes.featureType,
radius:d.pointRadius,graphicName:d.graphicName,stroke:d.strokeWidth,color:d.strokeColor,opacity:d.strokeOpacity,fillColor:d.fillColor,fillOpacity:d.fillOpacity});this.xml+='<FEATURE type="point">';this.write(c);this.xml+="</FEATURE>"}}else if("OpenLayers.Geometry.LineString"==this.map.layers[a].features[b].geometry.CLASS_NAME){d=this.parseStyle(this.map.layers[a],this.map.layers[a].features[b]);this.xml="arrow"==this.map.layers[a].features[b].attributes.featureType?this.xml+'<FEATURE type="arrow">':
this.xml+'<FEATURE type="lineString">';c=[];for(var e=[],f=0;f<this.map.layers[a].features[b].geometry.components.length;f++)c.push(this.map.layers[a].features[b].geometry.components[f].x),e.push(this.map.layers[a].features[b].geometry.components[f].y);c={x:c,y:e,color:d.strokeColor,opacity:d.strokeOpacity,stroke:d.strokeWidth,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap};this.write(c);this.xml+="</FEATURE>"}else if("OpenLayers.Geometry.Polygon"==this.map.layers[a].features[b].geometry.CLASS_NAME){d=
this.parseStyle(this.map.layers[a],this.map.layers[a].features[b]);this.xml+='<FEATURE type="polygon">';c=[];e=[];for(f=0;f<this.map.layers[a].features[b].geometry.components[0].components.length;f++)c.push(this.map.layers[a].features[b].geometry.components[0].components[f].x),e.push(this.map.layers[a].features[b].geometry.components[0].components[f].y);c={x:c,y:e,color:d.strokeColor,opacity:d.strokeOpacity,stroke:d.strokeWidth,fillColor:d.fillColor,fillOpacity:d.fillOpacity,label:d.label,fontColor:d.fontColor,
centerX:this.map.layers[a].features[b].geometry.getCentroid().x,centerY:this.map.layers[a].features[b].geometry.getCentroid().y,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap};this.write(c);this.xml+="</FEATURE>"}else if("OpenLayers.Geometry.MultiPolygon"==this.map.layers[a].features[b].geometry.CLASS_NAME)for(var d=this.parseStyle(this.map.layers[a],this.map.layers[a].features[b]),g=this.map.layers[a].features[b],f=0;f<g.geometry.components.length;f++){this.xml+='<FEATURE type="polygon">';
c=[];for(var e=[],h=g.geometry.components[f],k=0;k<h.components[0].components.length;k++)c.push(h.components[0].components[k].x),e.push(h.components[0].components[k].y);c={x:c,y:e,color:d.strokeColor,opacity:d.strokeOpacity,stroke:d.strokeWidth,fillColor:d.fillColor,fillOpacity:d.fillOpacity,label:d.label,fontColor:d.fontColor,centerX:this.map.layers[a].features[b].geometry.getCentroid().x,centerY:this.map.layers[a].features[b].geometry.getCentroid().y,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap};
this.write(c);this.xml+="</FEATURE>"}this.xml+="</VECTORLAYER>"}},parseStyle:function(a,b,c){if("object"!=typeof c){c||b.state!==OpenLayers.State.DELETE||(c="delete");var d=c||b.renderIntent;(c=b.style||a.style)||(c=a.styleMap.createSymbolizer(b,d))}return c},parsePopup:function(){0<this.map.popups.length&&(this.xml+="<POPUPS>");for(var a=0;a<this.map.popups.length;a++)if(this.map.popups[a].attributes&&this.map.popups[a].attributes.print){this.xml+="<POPUP>";this.map.popups[a].attributes.fontFamily||
(this.map.popups[a].attributes.fontFamily="\uad74\ub9bc");this.map.popups[a].attributes.fontSize||(this.map.popups[a].attributes.fontSize="12");this.map.popups[a].attributes.fontColor||(this.map.popups[a].attributes.fontColor="#000000");var b={x:this.map.popups[a].lonlat.lon,y:this.map.popups[a].lonlat.lat,width:$(this.map.popups[a].contentDiv).css("width").replace("px",""),height:$(this.map.popups[a].contentDiv).css("height").replace("px",""),text:this.map.popups[a].attributes.text,fontFamily:this.map.popups[a].attributes.fontFamily,
fontSize:this.map.popups[a].attributes.fontSize.replace("px",""),fontColor:this.map.popups[a].attributes.fontColor};this.write(b);this.xml+="</POPUP>"}0<this.map.popups.length&&(this.xml+="</POPUPS>")},write:function(a){for(var b in a)this.xml+="<"+b+">"+encodeURIComponent(a[b])+"</"+b+">"},CLASS_NAME:"GSaveTool"});GSLDTool=OpenLayers.Class({xml:null,data:null,tagNameList:{NamedLayer:"sld:NamedLayer",UserStyle:"sld:UserStyle",Rule:"se:Rule",Name:"se:Name",Description:"se:Description",Title:"se:Title",LayerFeatureConstraints:"sld:LayerFeatureConstraints",FeatureTypeName:"se:FeatureTypeName",FeatureTypeStyle:"se:FeatureTypeStyle",Filter:"ogc:Filter",PropertyIsEqualTo:"PropertyIsEqualTo",PropertyName:"ogc:PropertyName",Literal:"Literal",PropertyIsGreaterThanOrEqualTo:"PropertyIsGreaterThanOrEqualTo",PropertyIsLessThan:"PropertyIsLessThan",
PropertyIsGreaterThan:"PropertyIsGreaterThan",MinScaleDenominator:"se:MinScaleDenominator",MaxScaleDenominator:"se:MaxScaleDenominator",PointSymbolizer:"se:PointSymbolizer",LineSymbolizer:"se:LineSymbolizer",PolygonSymbolizer:"se:PolygonSymbolizer",TextSymbolizer:"se:TextSymbolizer",Size:"se:Size",Opacity:"se:Opacity",Rotation:"se:Rotation",Displacement:"se:Displacement",DisplacementX:"se:DisplacementX",DisplacementY:"se:DisplacementY",ExternalGraphic:"se:ExternalGraphic",InlineContent:"se:InlineContent",
Format:"se:Format",Graphic:"se:Graphic",Mark:"se:Mark",VendorOption:"sld:VendorOption",SvgParameter:"se:SvgParameter",Font:"se:Font",LabelPlacement:"se:LabelPlacement",PointPlacement:"se:PointPlacement",LinePlacement:"se:LinePlacement",Halo:"se:Halo",Radius:"se:Radius",Fill:"se:Fill",And:"ogc:And",Or:"ogc:Or"},browserName:GUtil.getBrowserName(),defaultLayers:[],initialize:function(a,b){if("msie"!=this.browserName&&"firefox"!=this.browserName)for(var c in this.tagNameList){var d=this.tagNameList[c].split(":");
1<d.length&&(this.tagNameList[c]=d[1])}"xml"==b?(this.xml=a,this.data=this.getSLDObj(a)):"obj"==b&&(this.xml=this.getSLDXML(a),this.data=a.data)},getData:function(){return this.data},getSLDObj:function(a){var b,c,d,e,f,g;b=this.readMapTopic(a);e=a.getElementsByTagName(this.tagNameList.NamedLayer);for(var h=0,k=e.length;h<k;h++){a=this.readNamedLayer(e[h]);f=e[h].getElementsByTagName(this.tagNameList.UserStyle);for(var l=0,m=f.length;l<m;l++){c=this.readUserStyle(f[l]);g=f[l].getElementsByTagName(this.tagNameList.Rule);
for(var n=0,q=g.length;n<q;n++)d=this.readRule(g[n]),c.rules.push(d);a.userStyle.push(c)}b.namedLayers.push(a)}return b},readMapTopic:function(a){var b={name:"",title:"",namedLayers:[]},c=a.getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(a.getElementsByTagName(this.tagNameList.Name)[0]).text());c=a.getElementsByTagName(this.tagNameList.Description);0<c.length&&(a=c[0].getElementsByTagName(this.tagNameList.Title),0<a.length&&(b.title=$(a[0]).text()));return b},readNamedLayer:function(a){var b=
{name:"",title:"",featureTypeName:"",userStyle:[]},c=a.getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());c=a.getElementsByTagName(this.tagNameList.Description);0<c.length&&(c=c[0].getElementsByTagName("se:Title"),0<c.length&&(b.title=$(c[0]).text()));c=a.getElementsByTagName(this.tagNameList.LayerFeatureConstraints);0<c.length&&(c=c[0].getElementsByTagName(this.tagNameList.FeatureTypeName),0<c.length&&(b.featureTypeName=$(c[0]).text()));return b},readUserStyle:function(a){var b=
{name:"",title:"",featureTypeName:"",rules:[]},c=a.getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());c=a.getElementsByTagName(this.tagNameList.Description);0<c.length&&(subElement=c[0].getElementsByTagName(this.tagNameList.Title),0<subElement.length&&(b.title=$(subElement[0]).text()));c=a.getElementsByTagName(this.tagNameList.FeatureTypeStyle);0<c.length&&(subElement=c[0].getElementsByTagName(this.tagNameList.FeatureTypeName),0<subElement.length&&(b.featureTypeName=$(subElement[0]).text()));
return b},readRule:function(a){var b={name:"",filterName:"",filterLiteral:"",minScale:"",maxScale:"",symbolizer:{}},c=a.getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());c=a.getElementsByTagName(this.tagNameList.Filter);if(0<c.length){subElement=c[0].getElementsByTagName(this.tagNameList.PropertyIsEqualTo);0<subElement.length&&(b.filterName_equal=$(subElement[0].getElementsByTagName(this.tagNameList.PropertyName)[0]).text(),b.filterLiteral_equal=$(subElement[0].getElementsByTagName(this.tagNameList.Literal)[0]).text());
subElement=c[0].getElementsByTagName(this.tagNameList.PropertyIsGreaterThanOrEqualTo);if(0<subElement.length){b.filterName_more=[];b.more=[];for(var d=0,e=subElement.length;d<e;d++)b.filterName_more.push($(subElement[d].getElementsByTagName(this.tagNameList.PropertyName)[0]).text()),b.more.push($(subElement[d].getElementsByTagName(this.tagNameList.Literal)[0]).text())}subElement=c[0].getElementsByTagName(this.tagNameList.PropertyIsLessThan);if(0<subElement.length)for(b.filterName_less=[],b.less=[],
d=0,e=subElement.length;d<e;d++)b.filterName_less.push($(subElement[d].getElementsByTagName(this.tagNameList.PropertyName)[0]).text()),b.less.push($(subElement[d].getElementsByTagName(this.tagNameList.Literal)[0]).text());subElement=c[0].getElementsByTagName(this.tagNameList.PropertyIsGreaterThan);0<subElement.length&&(b.filterName_greater=$(subElement[0].getElementsByTagName(this.tagNameList.PropertyName)[0]).text(),b.filterLiteral_greater=$(subElement[0].getElementsByTagName(this.tagNameList.Literal)[0]).text())}c=
a.getElementsByTagName(this.tagNameList.MinScaleDenominator);0<c.length&&(b.minScale=$(c[0]).text());c=a.getElementsByTagName(this.tagNameList.MaxScaleDenominator);0<c.length&&(b.maxScale=$(c[0]).text());c=a.getElementsByTagName(this.tagNameList.PointSymbolizer);d=a.getElementsByTagName(this.tagNameList.LineSymbolizer);e=a.getElementsByTagName(this.tagNameList.PolygonSymbolizer);a=a.getElementsByTagName(this.tagNameList.TextSymbolizer);0<c.length&&(b.symbolizer.point=this.readPointSym(c));0<d.length&&
(b.symbolizer.line=this.readLineSym(d));0<e.length&&(b.symbolizer.polygon=this.readPolySym(e));0<a.length&&(b.symbolizer.text=this.readTextSym(a));return b},readPointSym:function(a){var b={type:"point"};b.version=a[0].getAttribute("version");var c=a[0].getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());c=a[0].getElementsByTagName(this.tagNameList.Size);0<c.length&&(b.size=$(c[0]).text());c=a[0].getElementsByTagName(this.tagNameList.Opacity);0<c.length&&(b.opacity="1.0");
c=a[0].getElementsByTagName(this.tagNameList.Rotation);0<c.length&&(c=c[0].getElementsByTagName(this.tagNameList.PropertyName),0<c.length&&(b.rotation=$(c[0]).text()));c=a[0].getElementsByTagName(this.tagNameList.Displacement);if(0<c.length){var d=c[0].getElementsByTagName(this.tagNameList.DisplacementX);0<d.length&&(b.displacementX=$(d[0]).text(0));c=c[0].getElementsByTagName(this.tagNameList.DisplacementY);0<c.length&&(b.displacementY=$(c[0]).text())}c=a[0].getElementsByTagName(this.tagNameList.ExternalGraphic);
0<c.length&&(d=c[0].getElementsByTagName(this.tagNameList.InlineContent),0<d.length&&(b.externalGraphic=$(d[0]).text(),b.encoding=d[0].getAttribute("encoding")),c=c[0].getElementsByTagName(this.tagNameList.Format),0<c.length&&(b.format=$(c[0]).text()));a=a[0].getElementsByTagName(this.tagNameList.Graphic);if(0<a.length&&(a=a[0].getElementsByTagName(this.tagNameList.Mark),0<a.length))for(a=a[0].getElementsByTagName(this.tagNameList.VendorOption),c=0,d=a.length;c<d;c++)"font-family"==a[c].getAttribute("name")?
b.markFont=$(a[c]).text():"char-code"==a[c].getAttribute("name")?b.markCharCode=$(a[c]).text():"fill"==a[c].getAttribute("name")&&(b.markFill=$(a[c]).text());return b},readLineSym:function(a){var b={type:"line"};b.version=a[0].getAttribute("version");var c=a[0].getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());"CompositeLineCap"==b.name&&(b.arrow=!0);"CompositeLineMarker"==b.name&&(b.marker=!0);for(var c=a[0].getElementsByTagName(this.tagNameList.SvgParameter),d=0,e=
c.length;d<e;d++){"stroke"==c[d].getAttribute("name")&&(b.stroke=$(c[d]).text());"stroke-width"==c[d].getAttribute("name")&&(b.strokeWidth=$(c[d]).text());"stroke-opacity"==c[d].getAttribute("name")&&(b.strokeOpacity=$(c[d]).text());"stroke-linecap"==c[d].getAttribute("name")&&(b.strokeLinecap=$(c[d]).text());if("stroke-dasharray"==c[d].getAttribute("name")){var f=0,f=$(c[d]).text().split(","),f=2==parseInt(f[0])?"dot":7==parseInt(f[0])?"dash":10==parseInt(f[0])?"dashdot":"solid";b.strokeDashArray=
f}"stroke-linejoin"==c[d].getAttribute("name")&&(b.strokeLinejoin=$(c[d]).text())}c=a[0].getElementsByTagName(this.tagNameList.VendorOption);0<c.length&&(b.cap_style=[],b.cap_size=[],b.cap_color=[],b.cap_fill=[],b.cap_position=[]);d=0;for(e=c.length;d<e;d++)"cap_direction"==c[d].getAttribute("name")&&(b.cap_direction=$(c[d]).text()),"cap_angle"==c[d].getAttribute("name")&&(b.cap_angle=$(c[d]).text()),"start_cap"==c[d].getAttribute("name")&&(b.start_cap=$(c[d]).text()),"end_cap"==c[d].getAttribute("name")&&
(b.end_cap=$(c[d]).text()),"cap_style"==c[d].getAttribute("name")&&b.cap_style.push($(c[d]).text()),"cap_marker"==c[d].getAttribute("name")&&b.cap_marker.push($(c[d]).text()),"cap_size"==c[d].getAttribute("name")&&b.cap_size.push($(c[d]).text()),"cap_color"==c[d].getAttribute("name")&&b.cap_color.push($(c[d]).text()),"cap_fill"==c[d].getAttribute("name")&&b.cap_fill.push($(c[d]).text()),"cap_position"==c[d].getAttribute("name")&&b.cap_position.push($(c[d]).text());return b},readPolySym:function(a){var b=
{type:"polygon"};b.version=a[0].getAttribute("version");var c=a[0].getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());svgParam=a[0].getElementsByTagName(this.tagNameList.SvgParameter);a=0;for(c=svgParam.length;a<c;a++)"fill"==svgParam[a].getAttribute("name")&&(b.fillColor=$(svgParam[a]).text()),"fill-opacity"==svgParam[a].getAttribute("name")&&(b.fillOpacity=$(svgParam[a]).text());return b},readTextSym:function(a){var b={type:"text"};b.version=a[0].getAttribute("version");
var c=a[0].getElementsByTagName(this.tagNameList.Name);0<c.length&&(b.name=$(c[0]).text());element=a[0].getElementsByTagName(this.tagNameList.Label);0<element.length&&(subElement=element[0].getElementsByTagName(this.tagNameList.PropertyName),0<subElement.length&&(b.label=$(subElement[0]).text()));c=a[0].getElementsByTagName(this.tagNameList.Font);if(0<c.length){svgParam=c[0].getElementsByTagName(this.tagNameList.SvgParameter);for(var c=0,d=svgParam.length;c<d;c++)"font-family"==svgParam[c].getAttribute("name")?
b.fontFamily=$(svgParam[c]).text():"font-size"==svgParam[c].getAttribute("name")?b.fontSize=$(svgParam[c]).text():"font-style"==svgParam[c].getAttribute("name")?b.fontStyle=$(svgParam[c]).text():"font-weight"==svgParam[c].getAttribute("name")&&(b.fontWeight=$(svgParam[c]).text())}c=a[0].getElementsByTagName(this.tagNameList.LabelPlacement);if(0<c.length){d=c[0].getElementsByTagName(this.tagNameList.PointPlacement);c=c[0].getElementsByTagName(this.tagNameList.LinePlacement);if(0<d.length&&(d=d[0].getElementsByTagName(this.tagNameList.Displacement),
0<d.length)){var e=d[0].getElementsByTagName(this.tagNameList.DisplacementX);0<e.length&&(b.displacementX=$(e[0]).text());d=d[0].getElementsByTagName(this.tagNameList.DisplacementY);0<d.length&&(b.displacementY=$(d[0]).text())}if(0<c.length)for(c=c[0].getElementsByTagName(this.tagNameList.VendorOption),d=0,e=c.length;d<e;d++)"text_arrange_pos"==c[d].getAttribute("name")?b.text_arrange_pos=$(c[d]).text():"text_arrange_line"==c[d].getAttribute("name")?b.text_arrange_line=$(c[d]).text():"text_arrange_gap"==
c[d].getAttribute("name")?b.text_arrange_gap=$(c[d]).text():"text_arrange_gap_value"==c[d].getAttribute("name")&&(b.text_arrange_gap_value=$(c[d]).text())}c=a[0].getElementsByTagName(this.tagNameList.Halo);if(0<c.length&&(d=c[0].getElementsByTagName(this.tagNameList.Radius),0<d.length&&(b.radius=$(d[0]).text()),c=c[0].getElementsByTagName(this.tagNameList.Fill),0<c.length&&(svgParam=c[0].getElementsByTagName(this.tagNameList.SvgParameter),0<svgParam.length)))for(d=0,e=svgParam.length;d<e;d++)"fill"==
svgParam[d].getAttribute("name")?b.haloColor=$(svgParam[d]).text():"fill-opacity"==svgParam[d].getAttribute("name")&&(b.haloOpacity=$(svgParam[d]).text());a=a[0].getElementsByTagName(this.tagNameList.Fill);for(c=0;c<a.length;c++)if(svgParam=a[c].getElementsByTagName(this.tagNameList.SvgParameter),0<svgParam.length)for(d=0,e=svgParam.length;d<e;d++)"fill"==svgParam[d].getAttribute("name")?b.fillColor=$(svgParam[d]).text():"fill-opacity"==svgParam[d].getAttribute("name")&&(b.fillOpacity=$(svgParam[d]).text());
return b},getSLDXML:function(a,b,c){b&&(this.defaultLayers=b.split(","));b='<?xml version="1.0" encoding="UTF-8" ?>';return b=a?b+this.writeMapTopic(c.data,a):b+this.writeMapTopic(this.data)},writeMapTopic:function(a,b){var c=a.namedLayers,d;d="<"+this.tagNameList.StyledLayerDescriptor+' xsi:schemaLocation="" version="1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:se="http://www.opengis.net/se" xmlns:ogc="http://www.opengis.net/ogc" xmlns:sld="http://www.opengis.net/sld">';
d+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";d+="<"+this.tagNameList.Description+"><"+this.tagNameList.Title+">"+a.title+"</"+this.tagNameList.Title+"></"+this.tagNameList.Description+">";if("default"==b)for(var e=0,f=c.length;e<f;e++)for(var g=0,h=this.defaultLayers.length;g<h;g++)c[e].name==this.defaultLayers[g]&&(d+=this.writeNamedLayer(c[e]));else{e=0;for(f=layerTool.layers.length;e<f;e++)for(g=0,h=c.length;g<h;g++)layerTool.layers[e].alias==c[g].name&&(c[g].show="1"==
layerTool.layers[e].show?"1":"0");if("print"==b)for(g=layerTool.layers.length-1;0<=g;g--)for(e=0,f=c.length;e<f;e++)layerTool.layers[g].alias==c[e].name&&"1"==c[e].show&&(d+=this.writeNamedLayer(c[e]));else for(g=0,h=layerTool.layers.length;g<h;g++)for(e=0,f=c.length;e<f;e++)layerTool.layers[g].alias==c[e].name&&"1"==c[e].show&&(d+=this.writeNamedLayer(c[e]))}return d+="</"+this.tagNameList.StyledLayerDescriptor+">"},writeNamedLayer:function(a){var b=a.userStyle,c;c="<"+this.tagNameList.NamedLayer+
">";c+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";c+="<"+this.tagNameList.Description+"><"+this.tagNameList.Title+">"+a.title+"</"+this.tagNameList.Title+"></"+this.tagNameList.Description+">";c+="<"+this.tagNameList.LayerFeatureConstraints+"><"+this.tagNameList.FeatureTypeConstraint+"><"+this.tagNameList.FeatureTypeName+">";c+=a.featureTypeName;c+="</"+this.tagNameList.FeatureTypeName+"></"+this.tagNameList.FeatureTypeConstraint+"></"+this.tagNameList.LayerFeatureConstraints+
">";a=0;for(var d=b.length;a<d;a++)c+=this.writeUserStyle(b[a]);return c+="</"+this.tagNameList.NamedLayer+">"},writeUserStyle:function(a){var b=a.rules,c;c="<"+this.tagNameList.UserStyle+">";c+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";c+="<"+this.tagNameList.Description+"><"+this.tagNameList.Title+">"+a.title+"</"+this.tagNameList.Title+"></"+this.tagNameList.Description+">";c+="<"+this.tagNameList.FeatureTypeStyle+">";c+="<"+this.tagNameList.FeatureTypeName+">"+a.featureTypeName+
"</"+this.tagNameList.FeatureTypeName+">";a=0;for(var d=b.length;a<d;a++)null!=b[a].hidden&&b[a].hidden||(c+=this.writeRule(b[a]));c+="</"+this.tagNameList.FeatureTypeStyle+">";return c+="</"+this.tagNameList.UserStyle+">"},writeRule:function(a,b){var c,d;d="<"+this.tagNameList.Rule+">";d+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";if("\uadf8\uc678\uad00\ub85c_\uc8fc\uc11d"==a.name||"\uadf8\uc678\uad00\ub85c"==a.name)d+="<"+this.tagNameList.Filter+">",d+="<"+this.tagNameList.And+
' xmlns="http://www.opengis.net/ogc">',d+="<"+this.tagNameList.And+">",d+="<"+this.tagNameList.And+">",d+="<"+this.tagNameList.And+">",d+="<"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyName+">",d=d+"PLINE_KND_SE"+("</"+this.tagNameList.PropertyName+">"),d+="<"+this.tagNameList.Literal+">",d+="SAA006",d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyIsLessThan+">",d+="<"+this.tagNameList.PropertyName+
">",d+="PLINE_KND_SE",d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+="SAA009",d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsLessThan+">",d+="</"+this.tagNameList.And+">",d+="<"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyName+">",d+="PLINE_KND_SE",d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+="SAA011",d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+
">",d+="</"+this.tagNameList.And+">",d+="<"+this.tagNameList.PropertyIsLessThan+">",d+="<"+this.tagNameList.PropertyName+">",d+="PLINE_KND_SE",d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+="SAA030",d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsLessThan+">",d+="</"+this.tagNameList.And+">",d+="<"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyName+">",d+="PLINE_ET",d+="</"+this.tagNameList.PropertyName+
">",d+="<"+this.tagNameList.Literal+">",d+="20.0",d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="</"+this.tagNameList.And+">",d+="</"+this.tagNameList.Filter+">";else if(a.filterName_equal||a.filterLiteral_equal||a.more||a.less){d+="<"+this.tagNameList.Filter+">";if(a.filterName_equal&&a.filterName_greater||a.filterName_equal&&a.more)d+="<"+this.tagNameList.And+">";a.filterName_equal&&a.filterLiteral_equal&&(d+="<"+this.tagNameList.PropertyIsEqualTo+
' xmlns="http://www.opengis.net/ogc"><ogc:PropertyName>',d+=a.filterName_equal+"</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">"+a.filterLiteral_equal+"</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsEqualTo+">");a.filterName_greater&&a.filterLiteral_greater&&(d+="<"+this.tagNameList.PropertyIsGreaterThan+">",d+="<"+this.tagNameList.PropertyName+">",d+=a.filterName_greater,d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">"+a.filterLiteral_greater+
"</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsGreaterThan+">");if(a.more&&a.less){c=0;d+="<"+this.tagNameList.And+' xmlns="http://www.opengis.net/ogc">';for(var e in a.more)c++;for(var f=0;f<c;f++)2<=c&&(d+="<"+this.tagNameList.And+">"),d+="<"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyName+">",d+=a.filterName_more[f],d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+=a.more[f],d+="</"+this.tagNameList.Literal+
">",d+="</"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">",d+="<"+this.tagNameList.PropertyIsLessThan+">",d+="<"+this.tagNameList.PropertyName+">",d+=a.filterName_less[f],d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+=a.less[f],d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsLessThan+">",2<=c&&(d+="</"+this.tagNameList.And+">");d+="</"+this.tagNameList.And+">"}else if(a.more)for(f in a.more)d+="<"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+
">",d+="<"+this.tagNameList.PropertyName+">",d+=a.filterName_more[f],d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+=a.more[f],d+="</"+this.tagNameList.Literal+">",d+="</"+this.tagNameList.PropertyIsGreaterThanOrEqualTo+">";else if(a.less)for(f in a.less)d+="<"+this.tagNameList.PropertyIsLessThan+">",d+="<"+this.tagNameList.PropertyName+">",d+=a.filterName_less[f],d+="</"+this.tagNameList.PropertyName+">",d+="<"+this.tagNameList.Literal+">",d+=a.less[f],d+="</"+this.tagNameList.Literal+
">",d+="</"+this.tagNameList.PropertyIsLessThan+">";if(a.filterName_equal&&a.filterName_greater||a.filterName_equal&&a.more)d+="</"+this.tagNameList.And+">";d+="</"+this.tagNameList.Filter+">"}d+="<"+this.tagNameList.MinScaleDenominator+">"+a.minScale+"</"+this.tagNameList.MinScaleDenominator+">";d+="<"+this.tagNameList.MaxScaleDenominator+">"+a.maxScale+"</"+this.tagNameList.MaxScaleDenominator+">";a.symbolizer.polygon&&(c=a.symbolizer.polygon,d+=this.writePolySym(c));a.symbolizer.line&&(c=a.symbolizer.line,
d+=this.writeLineSym(c));a.symbolizer.point&&(c=a.symbolizer.point,d+=this.writePointSym(c));a.symbolizer.text&&(c=a.symbolizer.text,d+=this.writeTextSym(c));return d+="</se:Rule>"},writePointSym:function(a){var b;b="<"+this.tagNameList.PointSymbolizer+' version="'+a.version+'">';b+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";"CharMarker"==a.name||"CharMarkerAngle"==a.name?(b+="<"+this.tagNameList.Graphic+">",b+="<"+this.tagNameList.Mark+">",b+="<"+this.tagNameList.VendorOption+
' name="font-family">'+a.markFont+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="char-code">'+a.markCharCode+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="fill">'+a.markFill+"</"+this.tagNameList.VendorOption+">",b+="</"+this.tagNameList.Mark+">",b+="<"+this.tagNameList.Opacity+">"+a.opacity+"</"+this.tagNameList.Opacity+">",b+="<"+this.tagNameList.Size+">"+a.size+"</"+this.tagNameList.Size+">","CharMarkerAngle"==a.name&&(b+=
"<"+this.tagNameList.Rotation+">",b+="<"+this.tagNameList.PropertyName+">",b+=a.rotation,b+="</"+this.tagNameList.PropertyName+">",b+="</"+this.tagNameList.Rotation+">"),b+="<"+this.tagNameList.Displacement+">",b+="<"+this.tagNameList.DisplacementX+">"+a.displacementX+"</"+this.tagNameList.DisplacementX+">",b+="<"+this.tagNameList.DisplacementY+">"+a.displacementY+"</"+this.tagNameList.DisplacementY+">",b+="</"+this.tagNameList.Displacement+">"):(b+="<"+this.tagNameList.Graphic+"><"+this.tagNameList.ExternalGraphic+
"><"+this.tagNameList.InlineContent+' encoding="'+a.encoding+'">'+a.externalGraphic+"</"+this.tagNameList.InlineContent+">",b+="<"+this.tagNameList.Format+">"+a.format+"</"+this.tagNameList.Format+">",b+="</"+this.tagNameList.ExternalGraphic+">",b+="<"+this.tagNameList.Opacity+">"+a.opacity+"</"+this.tagNameList.Opacity+">",b+="<"+this.tagNameList.Size+">"+a.size+"</"+this.tagNameList.Size+">",b+="<"+this.tagNameList.Rotation+">"+a.rotation+"</se:Rotation>",b+="<"+this.tagNameList.Displacement+"><"+
this.tagNameList.DisplacementX+">"+a.displacementX+"</"+this.tagNameList.DisplacementX+">",b+="<"+this.tagNameList.DisplacementY+">"+a.displacementY+"</"+this.tagNameList.DisplacementY+"></"+this.tagNameList.Displacement+">");return b+="</"+this.tagNameList.Graphic+"></"+this.tagNameList.PointSymbolizer+">"},writeLineSym:function(a){var b;b="<"+this.tagNameList.LineSymbolizer+' version="'+a.version+'">';b+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";b+="<"+this.tagNameList.Stroke+
">";a.stroke&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke">'+a.stroke+"</"+this.tagNameList.SvgParameter+">");a.strokeOpacity&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke-opacity">'+a.strokeOpacity+"</"+this.tagNameList.SvgParameter+">");a.strokeWidth&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke-width">'+a.strokeWidth+"</"+this.tagNameList.SvgParameter+">");a.strokeLinejoin&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke-linejoin">'+a.strokeLinejoin+"</"+this.tagNameList.SvgParameter+
">");a.strokeLinecap&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke-linecap">'+a.strokeLinecap+"</"+this.tagNameList.SvgParameter+">");a.strokeDashArray&&"solid"!=a.strokeDashArray&&(b+="<"+this.tagNameList.SvgParameter+' name="stroke-dasharray">'+a.strokeDashArray+"</"+this.tagNameList.SvgParameter+">");b+="</"+this.tagNameList.Stroke+">";a.cap_direction&&a.cap_angle&&(b+="<"+this.tagNameList.VendorOption+' name="cap_direction">'+a.cap_direction+"</"+this.tagNameList.VendorOption+">",b+="<"+
this.tagNameList.VendorOption+' name="cap_angle">'+a.cap_angle+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="start_cap">'+a.start_cap+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_style">'+a.cap_style[0]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_size">'+a.cap_size[0]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_color">'+a.cap_color[0]+
"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_fill">'+a.cap_fill[0]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_position">'+a.cap_position[0]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="end_cap">'+a.end_cap+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_style">'+a.cap_style[1]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+
' name="cap_size">'+a.cap_size[1]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_color">'+a.cap_color[1]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_fill">'+a.cap_fill[1]+"</"+this.tagNameList.VendorOption+">",b+="<"+this.tagNameList.VendorOption+' name="cap_position">'+a.cap_position[1]+"</"+this.tagNameList.VendorOption+">");return b+="</"+this.tagNameList.LineSymbolizer+">"},writePolySym:function(a){var b;b="<"+
this.tagNameList.PolygonSymbolizer+' version="'+a.version+'">';b+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";b+="<"+this.tagNameList.Fill+">";a.fillColor&&(b+="<"+this.tagNameList.SvgParameter+' name="fill">'+a.fillColor+"</"+this.tagNameList.SvgParameter+">");a.fillOpacity&&(b+="<"+this.tagNameList.SvgParameter+' name="fill-opacity">'+a.fillOpacity+"</"+this.tagNameList.SvgParameter+">");b+="</"+this.tagNameList.Fill+">";return b+="</"+this.tagNameList.PolygonSymbolizer+
">"},writeTextSym:function(a){var b;b="<"+this.tagNameList.TextSymbolizer+' version="'+a.version+'">';b+="<"+this.tagNameList.Name+">"+a.name+"</"+this.tagNameList.Name+">";b=a.label?b+("<"+this.tagNameList.Label+"><"+this.tagNameList.PropertyName+">"+a.label+"</ogc:PropertyName></"+this.tagNameList.Label+">"):b+("<"+this.tagNameList.Label+"/>");b+="<"+this.tagNameList.Font+">";a.fontSize&&(b+="<"+this.tagNameList.SvgParameter+' name="font-size">'+a.fontSize+"</"+this.tagNameList.SvgParameter+">");
a.fontWeight&&(b+="<"+this.tagNameList.SvgParameter+' name="font-weight">'+a.fontWeight+"</"+this.tagNameList.SvgParameter+">");a.fontFamily&&(b+="<"+this.tagNameList.SvgParameter+' name="font-family">'+a.fontFamily+"</"+this.tagNameList.SvgParameter+">");a.fontStyle&&(b+="<"+this.tagNameList.SvgParameter+' name="font-style">'+a.fontStyle+"</"+this.tagNameList.SvgParameter+">");b+="</"+this.tagNameList.Font+">";b+="<"+this.tagNameList.LabelPlacement+">";if(a.displacementX||a.displacementY)b+="<"+
this.tagNameList.PointPlacement+"><"+this.tagNameList.Displacement+">",a.displacementX&&(b+="<"+this.tagNameList.DisplacementX+">"+a.displacementX+"</"+this.tagNameList.DisplacementX+">"),a.displacementY&&(b+="<"+this.tagNameList.DisplacementY+">"+a.displacementY+"</"+this.tagNameList.DisplacementY+">"),b+="</"+this.tagNameList.Displacement+"></"+this.tagNameList.PointPlacement+">";if(a.text_arrange_pos||a.text_arrange_line||a.text_arrange_gap)b+="<"+this.tagNameList.LinePlacement+">",a.text_arrange_pos&&
(b+="<"+this.tagNameList.VendorOption+' name="text_arrange_pos">'+a.text_arrange_pos+"</"+this.tagNameList.VendorOption+">"),a.text_arrange_line&&(b+="<"+this.tagNameList.VendorOption+' name="text_arrange_line">'+a.text_arrange_line+"</"+this.tagNameList.VendorOption+">"),a.text_arrange_gap&&(b+="<"+this.tagNameList.VendorOption+' name="text_arrange_gap">'+a.text_arrange_gap+"</"+this.tagNameList.VendorOption+">"),a.text_arrange_gap_value&&(b+="<"+this.tagNameList.VendorOption+' name="text_arrange_gap_value">'+
a.text_arrange_gap_value+"</"+this.tagNameList.VendorOption+">"),b+="</"+this.tagNameList.LinePlacement+">";b+="</"+this.tagNameList.LabelPlacement+">";a.radius&&(b+="<"+this.tagNameList.Halo+">",b+="<"+this.tagNameList.Radius+">"+a.radius+"</"+this.tagNameList.Radius+">",b+="<"+this.tagNameList.Fill+">",a.haloColor&&(b+="<"+this.tagNameList.SvgParameter+' name="fill">'+a.haloColor+"</"+this.tagNameList.SvgParameter+">"),a.haloOpacity&&(b+="<"+this.tagNameList.SvgParameter+' name="fill-opacity">'+
a.haloOpacity+"</"+this.tagNameList.SvgParameter+">"),b+="</"+this.tagNameList.Fill+">",b+="</"+this.tagNameList.Halo+">");a.fillColor&&(b+="<"+this.tagNameList.Fill+">",a.fillColor&&(b+="<"+this.tagNameList.SvgParameter+' name="fill">'+a.fillColor+"</"+this.tagNameList.SvgParameter+">"),a.fillOpacity&&(b+="<"+this.tagNameList.SvgParameter+' name="fill-opacity">'+a.fillOpacity+"</"+this.tagNameList.SvgParameter+">"),b+="</"+this.tagNameList.Fill+">");return b+="</"+this.tagNameList.TextSymbolizer+
">"},searchNamedLayer:function(a){for(var b=this.data.namedLayers,c=0,d=b.length;c<d;c++)if(b[c].name==a)return b[c]},searchRule:function(a,b){var c=this.data.namedLayers;if(b){for(var d=[],e=0,f=0,g=c.length;f<g;f++)for(var h=c[f].userStyle,k=0,l=h.length;k<l;k++)for(var m=h[k].rules,n=0,q=m.length;n<q;n++)m[n].name==a&&(d.push(m[n]),d.push(f),e++);if(1<e)for(f=0,g=d.length;f<g;f+=2){if(c[d[f+1]].name==b)return d[f]}else if(1==e)return d[0]}else for(f=0,g=c.length;f<g;f++)for(h=c[f].userStyle,k=
0,l=h.length;k<l;k++)for(m=h[k].rules,n=0,q=m.length;n<q;n++)if(m[n].name==a)return m[n]},regNamedLayers:function(a,b){a.namedLayers.push(b);return a},regUserStyle:function(a,b){a.userStyle.push(b);return a},regRules:function(a,b){a.rules.push(b);return a},regSymbolizer:function(a,b){"point"==b.type?a.symbolizer.point=b:"line"==b.type?a.symbolizer.line=b:"polygon"==b.type?a.symbolizer.polygon=b:"text"==b.type&&(a.symbolizer.text=b);return a},createMapTopic:function(a){return{xml:a.xml,name:a.name,
namedLayers:[]}},createNamedLayer:function(a){return{name:a.name,title:a.title,featureTypeName:a.featureTypeName,userStyle:[]}},createUserStyle:function(a){return{name:a.name,title:a.title,rules:[]}},createRule:function(a,b){return{name:a.name,filterName:a.filterName,filterLiteral:a.Literal,minScale:a.minScale,maxScale:a.maxScale,symbolizer:b}},createSymbolizer:function(a,b){var c;c=null;"point"==b?c="CharMarker"==a.name||"CharMarkerAngle"==a.name?{markFill:a.markFill,markFont:a.markFont,markCharCode:a.markCharCode,
type:"point",version:a.version,name:a.name,size:a.size,opacity:a.opacity,rotation:a.rotation,displacementX:a.displacementX,displacementY:a.displacementY}:{type:"point",version:a.version,name:a.name,size:a.size,opacity:a.opacity,rotation:a.rotation,displacementX:a.displacementX,displacementY:a.displacementY,externalGraphic:a.externalGraphic,encoding:a.encoding,format:a.format}:"line"==b?c={type:"line",version:a.version,name:a.name,stroke:a.stroke,strokeWidth:a.strokeWidth,strokeOpacity:a.strokeOpacity,
strokeLinecap:a.strokeLinecap,strokeDashArrayarray:a.strokeDashArray,strokeLinejoin:a.strokeLinejoin}:"polygon"==b?c={type:"polygon",version:a.version,name:a.name,fillColor:a.fillColor,fillOpacity:a.fillOpacity}:"text"==b&&(c={type:"text",version:a.version,name:a.name,label:a.label,fontFamily:a.fontFamily,fontSize:a.fontSize,fontStyle:a.fontStyle,fontWeight:a.fontWeight,displacementX:a.displacementX,displacementY:a.displacementY,text_arrange_pos:a.text_arrange_pos,text_arrange_line:a.text_arrange_line,
text_arrange_gap:a.text_arrange_gap,radius:a.radius,haloColor:a.haloColor,haloOpacity:a.haloOpacity,fillColor:a.fillColor,fillOpacity:a.fillOpacity});return c},updateNamedLayer:function(a){for(var b=!1,c=this.data.namedLayers,d=0,e=c.length;d<e;d++)c[d].name==a.name&&(c[d]=a,b=!0);b||c.push(a)},delNamedLayer:function(a){for(var b=!1,c=this.data.namedLayers,d=0,e=c.length;d<e;d++)c[d].name==a&&(b=!0,c.splice(d,1),alert("\ud574\ub2f9 NamedLayer\ub97c \uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."));b||
alert("\ud574\ub2f9 NamedLayer\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")},delRule:function(a){for(var b=!1,c=this.data.namedLayers,d=0,e=c.length;d<e;d++)for(var f=c[d].userStyle,g=0,h=f.length;g<h;g++)for(var k=f[g].rules,l=0,m=k.length;l<m;l++)k[l].name==a&&(b=!0,k.splice(l,1),alert("\ud574\ub2f9 Rule\uc744 \uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."));b||alert("\ud574\ub2f9  Rule\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.")},delSymbolizer:function(a){for(var b=!1,c=this.data.namedLayers,d=0,e=c.length;d<e;d++)for(var f=
c[d].userStyle,g=0,h=f.length;g<h;g++)for(var k=f[g].rules,l=0,m=k.length;l<m;l++){var n=k[l].symbolizer;n.point&&n.point.name==a?(delete n.point,b=!0):n.line&&n.line.name==a?(delete n.line,b=!0):n.polygon&&n.polygon.name==a?(delete n.polygon,b=!0):n.text&&n.text.name==a&&(delete n.text,b=!0)}b?alert("\ud574\ub2f9 Symbolizer\ub97c \uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."):alert("\ud574\ub2f9 Symbolizer\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")},CLASS_NAME:"GSLDTool"});GTMapLayerTool=OpenLayers.Class({groups:[],tMaps:[],layers:[],cloneLayers:[],layerGroups:[],cloneLayerGroups:[],tMapId:null,defaultSld:null,sld:null,initialize:function(a,b,c,d,e){this.layers=a;this.cloneLayers=this.getCloneLayers(a);b&&(this.tMaps=b);c&&(this.groups=c);d&&(this.layerGroups=d,this.cloneLayerGroups=this.getCloneLayerGroups(d));this.changeNull(this.layers);this.changeNull(this.tMaps);this.changeNull(this.groups);e&&e.tMapId?this.tMapId=e.tMapId:b&&b[0]&&b[0].id&&(this.tMapId=b[0].id);
control=this;e&&e.serviceUrl&&e.callback&&GRequest.WMS.getStyles(e.serviceUrl,this.getLayers({retAttr:"theme"})+",",function(a){control.sld=a;var b=encodeURIComponent(JSON.stringify(a,replacer)),b=JSON.parse(decodeURIComponent(b.replace("/+/g","%20")),reviver);control.defaultSld=b;b=0;e.userStyle&&(b=1);e.callback(a,b)})},setUserStyle:function(a,b){for(var c=new OpenLayers.Format.XML,d=decodeURIComponent(a),c=c.read(d).getElementsByTagName("sld:StyledLayerDescriptor")[0].getElementsByTagName("sld:NamedLayer"),
d=b.xml.getElementsByTagName("sld:StyledLayerDescriptor"),e=d[0].getElementsByTagName("sld:NamedLayer"),f=0,g=c.length;f<g;f++){var h;element=c[f].getElementsByTagName("se:Name");0<element.length&&(h=$(element[0]).text());for(var k=0,l=e.length;k<l;k++){var m;element=e[k].getElementsByTagName("se:Name");0<element.length&&(m=$(element[0]).text());h==m&&(d[0].removeChild(e[k]),d[0].appendChild(c[f]))}}this.sld=GRequest.WMS.parseGetStyles(b.xml)},setLayers:function(a,b){this.layers=a;control=this;b&&
b.serviceUrl&&b.callback&&GRequest.WMS.getStyles(b.serviceUrl,this.getLayers({retAttr:"theme"})+",",function(a){control.sld=a;var d=encodeURIComponent(JSON.stringify(a,replacer)),d=JSON.parse(decodeURIComponent(d.replace("/+/g","%20")),reviver);control.defaultSld=d;d=0;b.userStyle&&(d=1);b.callback(a,d)})},setLayerGroups:function(){var a=this.getThemeShowList("asc"),b=[],c;for(c in a)for(var d in this.layers)a[c]==this.layers[d].theme&&(0==b.length||0<b.length&&b[b.length-1]!=this.layers[d].layerGroup)&&
b.push(this.layers[d].layerGroup)},getLayerGroups:function(){return this.layerGroups},getTMapName:function(){for(var a in this.tMaps)if(this.tMaps[a].id==this.tMapId)return this.tMaps[a].name;return!1},setTMapByName:function(a){for(var b in this.tMaps)if(this.tMaps[b].name==a)return tMapId=this.tMaps[b].id,!0;return!1},setTMapbyId:function(a){for(var b in this.tMaps)if(this.tMaps[b].id==a)return this.tMapId=a,!0;return!1},getTMapId:function(){return this.tMapId},getLayerGroups:function(a){if(!a)return this.layerGroups;
var b=[],c=[];if(a.con)if(a.conVal)for(var d in this.layerGroups)a.reverse?this.layerGroups[d][a.con]!=a.conVal&&c.push(this.layerGroups[d]):this.layerGroups[d][a.con]==a.conVal&&c.push(this.layerGroups[d]);else for(d in this.layerGroups)a.reverse?this.layerGroups[d][a.con]||c.push(this.layerGroups[d]):this.layerGroups[d][a.con]&&c.push(this.layerGroups[d]);else for(d in this.layerGroups)c.push(this.layerGroups[d]);a.order&&this.orderBySeq(c,"seq",a.order);if(a.retAttr){var e=[],e=a.retAttr instanceof
Array?a.retAttr:[a.retAttr];for(d in c)for(var f in e)b.push(c[d][e[f]])}else b=c;return b},getLayers:function(a){if(!a)return this.layers;var b=[],c=[];if(a.con)if(a.conVal)for(var d in this.layers)a.reverse?this.layers[d][a.con]!=a.conVal&&c.push(this.layers[d]):this.layers[d][a.con]==a.conVal&&c.push(this.layers[d]);else for(d in this.layers)a.reverse?this.layers[d][a.con]||c.push(this.layers[d]):this.layers[d][a.con]&&c.push(this.layers[d]);else for(d in this.layers)c.push(this.layers[d]);a.order&&
this.orderBySeq(c,"seq",a.order);if(a.retAttr){var e=[],e=a.retAttr instanceof Array?a.retAttr:[a.retAttr];for(d in c)for(var f in e)b.push(c[d][e[f]])}else b=c;return b},getThemeList:function(a){a={con:"tmapid",conVal:this.getTMapId(),order:a,retAttr:"theme"};return this.getLayers(a)},getThemeShowList:function(a){return this.getLayers({con:"show",order:a,retAttr:"theme"})},getAliasList:function(a){a={con:"tmapid",conVal:this.getTMapId(),order:a,retAttr:"alias"};return this.getLayers(a)},getTableList:function(a){a=
{con:"tmapid",conVal:this.getTMapId(),order:a,retAttr:"table"};return this.getLayers(a)},getLayersSize:function(){return this.layers.length},setLayerAttr:function(a){if(a&&a.con&&a.conVal&&a.attr){var b=[],c=[],b=a.attr instanceof Array?a.attr:[a.attr],c=a.value instanceof Array?a.value:[a.value],d;for(d in this.layers)if(this.layers[d][a.con]==a.conVal){a=0;for(var e=b.length;a<e;a++)this.layers[d][b[a]]=c[a];return!0}}else return!1},orderBySeq:function(a,b,c){for(var d=a.length-1;0<d;d--)for(var e=
0;e<d;e++)"desc"==c.toLowerCase()?a[e][b]<a[e+1][b]&&GUtil.Array.fn_swap_element(a,e,e+1):a[e][b]>a[e+1][b]&&GUtil.Array.fn_swap_element(a,e,e+1)},changeNull:function(a){for(var b in a)for(var c in a[b])-1==a[b][c]&&(a[b][c]=null)},setSld:function(a){this.sld=a},getSld:function(){return this.sld},getSld_body:function(a,b){var c=this.sld.xml.cloneNode(!0),d=c.getElementsByTagName("sld:StyledLayerDescriptor"),e=d[0].getElementsByTagName("sld:NamedLayer"),f=[],g;for(g in this.layers)1!=this.layers[g].show&&
f.push(this.layers[g].theme);if(b)for(g=f.length-1;0<=g;g--)f[g]==b&&f.splice(g,1);g=0;for(var h=e.length;g<h;g++){var k;element=e[g].getElementsByTagName("se:Name");0<element.length&&(k=$(element[0]).text());for(var l in f)f[l]==k&&d[0].removeChild(e[g])}if(a)for(g in this.sld.namedLayers)for(l in this.sld.namedLayers[g].userStyle)for(var m in this.sld.namedLayers[g].userStyle[l].rules)if(b&&(this.sld.namedLayers[g].userStyle[l].rules[m].hidden=!1),this.sld.namedLayers[g].userStyle[l].rules[m].hidden)for(d=
e[g].getElementsByTagName("sld:UserStyle")[l].getElementsByTagName("se:FeatureTypeStyle")[0],f=d.getElementsByTagName("se:Rule"),h=0,k=f.length;h<k;h++){var n=$(f[h].getElementsByTagName("se:Name")[0]).text();if(this.sld.namedLayers[g].userStyle[l].rules[m].name==n){d.removeChild(f[h]);break}}return c.xml},getDefaultSld:function(){return this.defaultSld},getModifyStr:function(){var a=this.sld.xml.cloneNode(!0),b=a.getElementsByTagName("sld:StyledLayerDescriptor"),c=b[0].getElementsByTagName("sld:NamedLayer"),
d=[],e;for(e in this.sld.namedLayers);e=0;for(var f=c.length;e<f;e++){var g;element=c[e].getElementsByTagName("se:Name");0<element.length&&(g=$(element[0]).text());for(var h in d)d[h]==g&&b[0].removeChild(c[e])}return a.xml},backSld:function(a){},updateSld:function(a){a.modify=!0;for(var b=0,c=this.sld.data.namedLayers.length;b<c;b++)if(a.name==this.sld.data.namedLayers[b].name)for(var d=this.sld.data.namedLayers[b].userStyle,e=0,f=d.length;e<f;e++)for(var g=d[e].rules,h=0,k=g.length;h<k;h++){g[h].symbolizer.point&&
(g[h].symbolizer.point.externalGraphic=a.userStyle[e].rules[h].symbolizer.point.externalGraphic,g[h].symbolizer.point.size=a.userStyle[e].rules[h].symbolizer.point.size);if(g[h].symbolizer.line&&(g[h].symbolizer.line.stroke=a.userStyle[e].rules[h].symbolizer.line.stroke,g[h].symbolizer.line.strokeWidth=a.userStyle[e].rules[h].symbolizer.line.strokeWidth,g[h].symbolizer.line.strokeOpacity=a.userStyle[e].rules[h].symbolizer.line.strokeOpacity,g[h].symbolizer.line.strokeLinecap=a.userStyle[e].rules[h].symbolizer.line.strokeLinecap,
g[h].symbolizer.line.strokeDashArray)){var l=a.userStyle[e].rules[h].symbolizer.line.strokeDashArray;"dot"==l?g[h].symbolizer.line.strokeDashArray="2.0,2.0":"dash"==l?g[h].symbolizer.line.strokeDashArray="7.0,3.0":"dashdot"==l&&(g[h].symbolizer.line.strokeDashArray="10.0,2.0,2.0,2.0")}g[h].symbolizer.polygon&&(g[h].symbolizer.polygon.fillColor=a.userStyle[e].rules[h].symbolizer.polygon.fillColor,g[h].symbolizer.polygon.fillOpacity=a.userStyle[e].rules[h].symbolizer.polygon.fillOpacity);g[h].symbolizer.text&&
(g[h].symbolizer.text.fontFamily=a.userStyle[e].rules[h].symbolizer.text.fontFamily,g[h].symbolizer.text.fontSize=a.userStyle[e].rules[h].symbolizer.text.fontSize,g[h].symbolizer.text.fontStyle=a.userStyle[e].rules[h].symbolizer.text.fontStyle,g[h].symbolizer.text.fontWeight=a.userStyle[e].rules[h].symbolizer.text.fontWeight,g[h].symbolizer.text.haloColor=a.userStyle[e].rules[h].symbolizer.text.haloColor,g[h].symbolizer.text.haloOpacity=a.userStyle[e].rules[h].symbolizer.text.haloOpacity,g[h].symbolizer.text.fillColor=
a.userStyle[e].rules[h].symbolizer.text.fillColor,g[h].symbolizer.text.fillOpacity=a.userStyle[e].rules[h].symbolizer.text.fillOpacity)}},getTMapGroup:function(){return this.groups},getTMap:function(){return this.tMaps},addTMap:function(a){this.tMaps.push(a)},insertGroup:function(a,b){a=parseInt(a);b=parseInt(b);this.orderBySeq(this.layerGroups,"seq","asc");var c,d,e;for(e in this.layerGroups)this.layerGroups[e].id==a&&(c=e),this.layerGroups[e].id==b&&(d=e);if(0<c-d)for(this.layerGroups[c].seq=this.layerGroups[d].seq,
e=d;e<c;e++)this.layerGroups[e].seq+=1;else for(this.layerGroups[c].seq=this.layerGroups[d].seq,e=d;e>c;e--)this.layerGroups[e].seq-=1;this.setLayerSeq(this.layerGroups)},setLayerSeq:function(a){var b=1;this.orderBySeq(a,"seq","asc");for(var c in a)for(var d in this.layers)a[c].id==this.layers[d].layerGroup&&(this.layers[d].seq=b++)},insertLayer:function(a,b){this.orderBySeq(this.layers,"seq","asc");var c,d,e;for(e in this.layers)this.layers[e].id==a&&(c=e),this.layers[e].id==b&&(d=e);if(0<c-d)for(this.layers[c].seq=
this.layers[d].seq,e=d;e<c;e++)this.layers[e].seq+=1;else for(this.layers[c].seq=this.layers[d].seq,e=d;e>c;e--)this.layers[e].seq-=1;this.orderBySeq(this.layers,"seq","asc")},getCloneLayerGroups:function(a){var b=[];if(a)for(var c=0,d=a.length;c<d;c++)b.push(this.cloneObj(a[c]));else for(c=0,d=this.layerGroups.length;c<d;c++)b.push(this.cloneObj(this.layerGroups[c]));return b},getCloneLayers:function(a){var b=[];if(a)for(var c=0,d=a.length;c<d;c++)b.push(this.cloneObj(a[c]));else for(c=0,d=this.layers.length;c<
d;c++)b.push(this.cloneObj(this.layers[c]));return b},cloneObj:function(a){var b={},c;for(c in a)b[c]=a[c];return b},CLASS_NAME:"GTMapLayerTool"});ginnoToc=OpenLayers.Class({data:null,initialize:function(a,b){$("#"+a).jstree({plugins:["types","checkbox","dnd","state","contextmenu"],core:{data:ginnoToc.prototype.fn_create_treeJson(b)},types:{valid_children:["tmap"],types:{style:{valid_children:"none",start_drag:!1},layer:{valid_children:"style"},group:{valid_children:"layer"},root:{valid_children:"group",rename:!1,start_drag:!1,move_node:!1,delete_node:!1,remove:!1},tmap:{valid_children:["layer"],rename:!1,start_drag:!1,move_node:!1,delete_node:!1,
remove:!1}}}})},fn_create_treeJson:function(a){for(var b in a)-1==b.indexOf("root")&&-1==b.indexOf("group")&&-1==b.indexOf("layer")&&b.indexOf("style");GRequest.WMS.getLegendGraphic(g2WebServiceUrl,{layer:"\ubc95\uc815\uc74d\uba74\ub3d9",style:"\ubc95\uc815\uc74d\uba74\ub3d9",rule:"\ubc95\uc815\uc74d\uba74\ub3d9_\uc2a4\ud0c0\uc77c"})},CLASS_NAME:"ginnoToc"});var gMap,indexMap,legendTool;
ginnoMap=OpenLayers.Class({drawTool:null,saveTool:null,initialize:function(a,b){if(1>1*$("#"+a).css("width").split("px")[0]||1>1*$("#"+a).css("height").split("px")[0])alert("mapDiv\uc758 width, height \uac12\uc774 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc544 \uae30\ubcf8\uac12\uc73c\ub85c \uc790\ub3d9 \uc124\uc815\ud569\ub2c8\ub2e4."),$("#"+a).css("width","100%"),$("#"+a).css("height","100%"),$("#"+a).css("border","1px solid #000000");var c=new GBounds(gMapParams.maxExtent[0],gMapParams.maxExtent[1],gMapParams.maxExtent[2],
gMapParams.maxExtent[3]);gMapParams.maxExtent=c;gMap=new GMap(a,gMapParams);switch(b){case "WMS":c=new GWMSPost(WMSParams.layerName,WMSParams.serviceURL,WMSParams,WMSOptions);gMap.addLayer(c);break;case "TileCache":c=new GTileCache(TileCacheParams.layerName,TileCacheParams.serviceURL,TileCacheParams,TileCacheOptions),gMap.addLayer(c)}c=new GVector("vectorLayer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:16,fillColor:"#0000ff",
strokeColor:"#ff0000",fillOpacity:.5},Line:{strokeWidth:10,strokeColor:"#ff0000",strokeDashstyle:"solid",strokeLinecap:"round"},Polygon:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000",fillColor:"#0000ff",strokeDashstyle:"dash",fillOpacity:.5}}})]})})});gMap.addLayer(c);c=new OpenLayers.Layer.Markers("markersLayer");gMap.addLayer(c);gMap.zoomToMaxExtent();indexMap=new GIndexMap(gMap,gIndexMapParams);var c={point:new GGetFeature(GPoint,pointParams),circle:new GGetFeature(GRegularPolygonDrawAttr,
circleParams),polygon:new GGetFeature(GPolygonDraw,polygonParams)},d;for(d in c)gMap.addControl(c[d]);gMap.drawTool=new GDrawTool(gMap,{onModificationStart:ginnoMap.prototype.fn_select_feature,onSelect:ginnoMap.prototype.fn_multiSelect_feature,onUnselectAll:function(){ginnoMap.prototype.fn_switch_show("None")},onDeactivate:function(){ginnoMap.prototype.fn_switch_show("None")}});gMap.saveTool=new GSaveTool(gMap);apiServerHost&&(gMap.getControl("drawSymbol").handler.attributes.externalGraphic=apiServerHost+
gMap.getControl("drawSymbol").handler.attributes.externalGraphic);legendTool=new GLegendTool(gMap,WMSParams.layerName,gMap.getLayerByName(WMSParams.layerName).params.LAYERS,ginnoMap.prototype.fn_create_legendList)},fn_create_legendList:function(a){var b="",c;for(c in a){var d=a[c].type;if(d.point)b+="<li>",b+="<span class='legendGraphic' style='background:url("+GRequest.WMS.getLegendGraphic(g2WebServiceUrl,{layer:a[c].layer,style:a[c].style,rule:a[c].rule})+") no-repeat; background-position 0 0;' ></span>";
else{var e={width:16,height:16};d.polygon?(e.strFillColor=d.polygon.fillColor.replace("#",""),d.line&&(e.strColor=d.line.stroke.replace("#","")),imgUrl=apiServerHost?apiServerHost+"/gmap/getPolygonSymbol.do?"+GUtil.fn_convert_objToStr(e):"/gmap/getPolygonSymbol.do?"+GUtil.fn_convert_objToStr(e)):d.line&&(e.strColor=d.line.stroke.replace("#",""),imgUrl=apiServerHost?apiServerHost+"/gmap/getLineSymbol.do?"+GUtil.fn_convert_objToStr(e):"/gmap/getLineSymbol.do?"+GUtil.fn_convert_objToStr(e));b+="<li>";
b+="<span class='legendGraphic' style='background:url("+imgUrl+") no-repeat;' ></span>"}b+=a[c].rule;b+="</li>"}$("#legendMng ul").html(b)},fn_select_feature:function(a){a=a.attributes;ginnoMap.prototype.fn_switch_show(a.featureType);ginnoMap.prototype.fn_bind_drawAttr(a)},fn_switch_show:function(a){$("#attrMng li").hide();switch(a){case "None":$("#liNone").show();$("#attrMng .totMenu strong").text("\uc18d\uc131 \uc124\uc815");break;case "Point":$("#attrMng .totMenu strong").text("\uc810");$("#liType").show();
$("#liSize").show();$("#liThickness").show();$("#liColor").show();$("#liOpa").show();$("#liColorPoly").show();$("#liOpaPoly").show();$("#liSubmit .btnBack").hide();$("#liSubmit").show();$("#liIndex").show();break;case "Line":$("#attrMng .totMenu strong").text("\uc120\ud615");$("#liColor").show();$("#liThickness").show();$("#liOpa").show();$("#liStyle").show();$("#liCap").show();$("#liSubmit .btnBack").hide();$("#liSubmit").show();$("#liIndex").show();break;case "Image":$("#attrMng .totMenu strong").text("\uc774\ubbf8\uc9c0");
$("#liWidth").show();$("#liHeight").show();$("#liOpa").show();$("#liSubmit .btnBack").hide();$("#liSubmit").show();$("#liIndex").show();break;case "Polygon":$("#attrMng .totMenu strong").text("\ub2e4\uac01\ud615");$("#liColor").show();$("#liThickness").show();$("#liOpa").show();$("#liStyle").show();$("#liColorPoly").show();$("#liOpaPoly").show();$("#liSubmit .btnBack").hide();$("#liSubmit").show();$("#liIndex").show();break;case "Text":$("#attrMng .totMenu strong").text("\uae00\uc790");$("#liFont").show();
$("#liSize").show();$("#liColor").show();$("#liSubmit .btnBack").hide();$("#liSubmit").show();$("#liIndex").show();$("#liBackFillColor").show();$("#liBackFillOpa").show();$("#liBackLineColor").show();$("#liBackLineOpa").show();break;case "Multi":$("#attrMng .totMenu strong").text("\ub2e4\uc911 \uc120\ud0dd"),$("#liColor").show(),$("#liThickness").show(),$("#liOpa").show(),$("#liStyle").show(),$("#liColorPoly").show(),$("#liOpaPoly").show(),$("#liSubmit .btnBack").hide(),$("#liSubmit").show(),$("#liIndex").show()}},
fn_bind_drawAttr:function(a){switch(a.featureType){case "Point":$("#selType").val(a.graphicName);$("#txtSize").val(a.pointRadius);$("#txtThickness").val(a.strokeWidth);$("#colorAttr").val(a.strokeColor);$("#colorAttr").css("background-color",a.strokeColor);var b=Math.ceil(100*(1-a.strokeOpacity));$("#txtOpa").val(b);$("#sliderOpa").val(b);$("#colorAttrPoly").val(a.fillColor);$("#colorAttrPoly").css("background-color",a.fillColor);a=Math.ceil(100*(1-a.fillOpacity));$("#txtOpaPoly").val(a);$("#sliderOpaPoly").val(a);
break;case "Line":$("#colorAttr").val(a.strokeColor);$("#colorAttr").css("background-color",a.strokeColor);$("#txtThickness").val(a.strokeWidth);b=Math.ceil(100*(1-a.strokeOpacity));$("#txtOpa").val(b);$("#sliderOpa").val(b);break;case "Image":$("#txtWidth").val(a.graphicWidth);$("#txtHeight").val(a.graphicHeight);a=Math.ceil(100*(1-a.graphicOpacity));$("#txtOpa").val(a);$("#sliderOpa").val(a);break;case "Polygon":$("#colorAttr").val(a.strokeColor);$("#colorAttr").css("background-color",a.strokeColor);
$("#txtThickness").val(a.strokeWidth);b=Math.ceil(100*(1-a.strokeOpacity));$("#txtOpa").val(b);$("#colorAttrPoly").val(a.fillColor);$("#colorAttrPoly").css("background-color",a.fillColor);a=Math.ceil(100*(1-a.fillOpacity));$("#txtOpaPoly").val(a);break;case "Text":$("#selFont").val(a.fontFamily),$("#txtSize").val(a.fontSize.replace("px","")),$("#colorAttr").val(a.fontColor),$("#colorAttr").css("background-color",a.fontColor),b=GUtil.fn_convert_color(a.background_fill),$("#colorAttrBack").val(b[1]),
$("#colorAttrBack").css("background-color",b[1]),$("#txtOpaBack").val(b[0]),b=GUtil.fn_convert_color(a.background_line),$("#colorAttrBackLine").val(b[1]),$("#colorAttrBackLine").css("background-color",b[1]),$("#txtOpaBackLine").val(b[0])}$("#sliderOpa .ui-slider-range").css("height",$("#sliderOpa .ui-slider-range").parent().innerHeight());$("#sliderOpaPoly .ui-slider-range").css("height",$("#sliderOpaPoly .ui-slider-range").parent().innerHeight());$("#liSubmit .btnApply").click(function(){ginnoMap.prototype.fn_apply_attr()})},
fn_apply_attr:function(){var a=gMap.drawTool.getSelectFeature(),b=a.attributes;switch(b.featureType){case "Point":b.graphicName=$("#selType").val();b.pointRadius=$("#txtSize").val();b.strokeWidth=$("#txtThickness").val();b.strokeColor=$("#colorAttr").val();b.strokeOpacity=1-$("#txtOpa").val()/100;b.fillColor=$("#colorAttrPoly").val();b.fillOpacity=1-$("#txtOpaPoly").val()/100;break;case "Line":b.strokeColor=$("#colorAttr").val();b.strokeWidth=$("#txtThickness").val();b.strokeOpacity=1-$("#txtOpa").val()/
100;b.strokeDashstyle=$("#selStyle").val();b.strokeLinecap=$("#selCap").val();break;case "Image":b.graphicWidth=$("#txtWidth").val();b.graphicHeight=$("#txtHeight").val();b.graphicOpacity=1-$("#txtOpa").val()/100;break;case "Polygon":b.strokeColor=$("#colorAttr").val();b.strokeWidth=$("#txtThickness").val();b.strokeOpacity=1-$("#txtOpa").val()/100;b.strokeDashstyle=$("#selStyle").val();b.fillColor=$("#colorAttrPoly").val();b.fillOpacity=1-$("#txtOpaPoly").val()/100;break;case "Text":b.fontFamily=
$("#selFont").val(),b.fontSize=$("#txtSize").val()+"px",b.fontColor=$("#colorAttr").val(),b.background_fill=GUtil.fn_convert_color([$("#txtOpaBack").val(),$("#colorAttrBack").val()]),b.background_line=GUtil.fn_convert_color([$("#txtOpaBackLine").val(),$("#colorAttrBackLine").val()]),gMap.drawTool.setTextAttr(a)}gMap.drawTool.redraw()},fn_multiSelect_feature:function(a){a=gMap.drawTool.map.getLayerByName("GDrawToolLayer").selectedFeatures;for(var b in a){var c=a[b].attributes;ginnoMap.prototype.fn_switch_show("Multi");
$("#colorAttr").val(c.strokeColor);$("#colorAttr").css("background-color",c.strokeColor);$("#txtThickness").val(c.strokeWidth);var d=Math.ceil(100*(1-c.strokeOpacity));$("#txtOpa").val(d);$("#colorAttrPoly").val(c.fillColor);$("#colorAttrPoly").css("background-color",c.fillColor);c=Math.ceil(100*(1-c.fillOpacity));$("#txtOpaPoly").val(c);$("#sliderOpa .ui-slider-range").css("height",$("#sliderOpa .ui-slider-range").parent().innerHeight());$("#sliderOpaPoly .ui-slider-range").css("height",$("#sliderOpaPoly .ui-slider-range").parent().innerHeight());
$("#liSubmit .btnApply").click(function(){ginnoMap.prototype.fn_multiApply_attr()})}},fn_multiApply_attr:function(){var a=gMap.drawTool.map.getLayerByName("GDrawToolLayer").selectedFeatures,b;for(b in a){var c=a[b].attributes;c.strokeColor=$("#colorAttr").val();c.strokeWidth=$("#txtThickness").val();c.strokeOpacity=1-$("#txtOpa").val()/100;c.strokeDashstyle=$("#selStyle").val();c.fillColor=$("#colorAttrPoly").val();c.fillOpacity=1-$("#txtOpaPoly").val()/100;c.originStrokeColor=$("#colorAttr").val();
c.originFillColor=$("#colorAttrPoly").val()}gMap.drawTool.redraw()},CLASS_NAME:"ginnoMap"});